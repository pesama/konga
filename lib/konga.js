/* konga v1.2.0 - Released under MIT license - http://konga.io/ */angular.module("konga",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","ui.bootstrap.datetimepicker","mgcrea.ngStrap.popover","mgcrea.ngStrap.select","pascalprecht.translate","dialogs.main","config","ui.calendar","ngFileUpload"]).config(["$httpProvider",function($httpProvider){$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"]}]).config(["$locationProvider","$routeProvider",function($locationProvider,$routeProvider){$routeProvider.when("/entity/:entityType/search/",{templateUrl:"/konga/views/entity-search.html",controller:"EntitySearchController"}).when("/entity/:entityType/:entityId/",{templateUrl:"/konga/views/entity-update.html",controller:"EntityUpdateController"})}]).config(["$translateProvider","i18n",function($translateProvider,i18n){for(var lang in i18n)$translateProvider.translations(lang,i18n[lang]);$translateProvider.preferredLanguage("en")}]).run(["$location","util","$rootScope","$timeout",function($location,util,$rootScope,$timeout){function loadPermalinks(){var entity=path.split("/")[2];if(path.match(searchPath))$rootScope.operations.openEntitySearch(entity);else if(path.match(createPath))$rootScope.operations.openEntityCreate(entity);else if(path.match(updatePath)){var metadata=util.getMetadata(entity),idField=util.getEntityId(metadata,null,!0),obj={};obj[idField]=path.split("/")[3],$rootScope.operations.openEntityCreate(entity,obj)}else $location.path(path)}var path=$location.path(),searchPath=/^\/?(entity)\/(.*)\/(search)\/?$/,createPath=/^\/?(entity)\/(.*)\/(new)\/?$/,updatePath=/^\/?(entity)\/(.*)\/(.*)\/?$/;"/"!==path&&($location.path("/"),$rootScope.$on("metadata-ready",function(evt,data){$rootScope.operations?loadPermalinks():$timeout(function(){loadPermalinks()},50)}))}]);var constants={ALERT_TYPE_ERROR:"danger",ALERT_TYPE_SUCCESS:"success",ALERT_TYPE_DEFAULT:"default",ALERT_TYPE_WARNING:"warning",ENTITY_ID_PREFFIX:"entity_",SEARCH_SUFFIX:"_search",STRING_SEPARATOR:"_",NEW_ENTITY_ID:"new",REFRESH_SEARCH_KEY:"refreshSearchKey_",SCOPE_SEARCH:"search",SCOPE_RESULTS:"results",SCOPE_UPDATE:"update",FIELD_STRING:"STRING",FIELD_NUMBER:"NUMBER",FIELD_PLAIN:"PLAIN",FIELD_PASSWORD:"PASSWORD",FIELD_BOOLEAN:"BOOLEAN",FIELD_CHECKBOX:"CHECKBOX",FIELD_COMBOBOX:"COMBOBOX",FIELD_DATE:"DATE",FIELD_DATETIME:"DATETIME",FIELD_DATESEARCH:"DATE-SEARCH",FIELD_TEXT:"TEXT",FIELD_TEXTAREA:"TEXTAREA",FIELD_COMPLEX:"COMPLEX",FIELD_LIST:"LIST",FIELD_PICK_LIST:"PICK_LIST",FIELD_SELECT:"SELECT",FIELD_FILTERED_SELECT:"FILTERED_SELECT",FIELD_TICS:"TICS",FIELD_COLOR:"COLOR",FIELD_CSS:"CSS",FIELD_FILE:"FILE",FIELD_IMAGE:"IMAGE",FIELD_PRICE:"PRICE",FIELD_CUSTOM:"CUSTOM",FIELD_PLAIN_FILTERED:"PLAIN_FILTERED",FIELD_TABLE:"TABLE",DATE_DEFAULT_NOW:"now",MULTIPLICITY_ONE:"ONE",MULTIPLICITY_MANY:"MANY",TRIGGER_MOMENT_IMMEDIATE:"IMMEDIATE",TRIGGER_MOMENT_COMMIT:"COMMIT",TRIGGER_TYPE_CONFIRM:"CONFIRM",TRIGGER_TYPE_ALERT:"ALERT",TRIGGER_PARAM_LABEL:"label",TRIGGER_MATCH_VALUE:"VALUE",TRIGGER_MATCH_LENGTH:"LENGTH",TRIGGER_MATCH_TYPE_EXACT:"EXACT_MATCH",TRIGGER_MATCH_TYPE_RANGE:"RANGE",CASCADE_FORM:"CASCADE",TABBED_FORM:"TABBED",CUSTOM_TABBED_FORM:"CUSTOM_TABBED",CUSTOM_FORM:"CUSTOM",CATEGORIZED_CASCADE_FORM:"CATEGORIZED_CASCADE",LANGUAGE_MESSAGE_PREFFIX:"message.languages.",DATE_COMPARATOR_LOWER_THAN:"LOWER_THAN",DATE_COMPARATOR_LOWER_EQUALS:"LOWER_EQUALS",DATE_COMPARATOR_EQUALS:"EQUALS",DATE_COMPARATOR_GREATER_EQUALS:"GREATER_EQUALS",DATE_COMPARATOR_GREATER_THAN:"GREATER_THAN",DATE_COMPARATOR_BETWEEN:"BETWEEN",NUMBER_COMPARATOR_LOWER_THAN:"LOWER_THAN",NUMBER_COMPARATOR_LOWER_EQUALS:"LOWER_EQUALS",NUMBER_COMPARATOR_EQUALS:"EQUALS",NUMBER_COMPARATOR_GREATER_EQUALS:"GREATER_EQUALS",NUMBER_COMPARATOR_GREATER_THAN:"GREATER_THAN",NUMBER_COMPARATOR_BETWEEN:"BETWEEN",VALIDATOR_EXACT_MATCH:"EXACT_MATCH",VALIDATOR_RANGE:"RANGE",MAXLEN_FILTER_NAME:30,ACTION_TYPE_MODAL:"modal",ACTION_TYPE_NOTIFY:"notify",ACTION_TYPE_CONFIRM:"confirm",ACTION_TYPE_TAB:"tab",ACTION_TYPE_FUNCTION:"function",ACTION_RESTRICTION_POLICY_ALL:"all",USER_ID:"userId",COMBO_NATURE_TIERS:"natTiers",CONFIGURATION_IGNORE_PARENT_FIELD:"IGNORE_PARENT_FIELD",CONFIGURATION_USE_VIEW:"USE_VIEW",TAB_TYPE_SEARCH:"glyphicon glyphicon-search",TAB_TYPE_UPDATE:"glyphicon glyphicon-pencil",TAB_TYPE_HOME:"glyphicon glyphicon-home",TAB_TYPE_TASKS:"glyphicon glyphicon-tasks",TAB_TYPE_GRID:"glyphicon glyphicon-th",TAB_TYPE_GRID_LARGE:"glyphicon glyphicon-th-large",TAB_TYPE_STORE:"glyphicon glyphicon-shopping-cart",TAB_TYPE_CONFIG:"glyphicon glyphicon-cog",FORM_STYLE_HORIZONTAL:"HORIZONTAL",USE_SHORT_LABEL:"USE_SHORT_LABEL",FILE_TYPE_PDF:"application/pdf",FILE_TYPE_PNG:"image/png",FILE_TYPE_JPG:"image/jpeg",FILE_TYPE_GIF:"image/gif",FILE_EXT_PNG:".png",FILE_EXT_JPG:".jpg",FILE_EXT_GIF:".gif",CASCADE_UPDATE:"CASCADE_UPDATE",PROPAGATE_UPDATE:"PROPAGATE_UPDATE",DISABLE_COMPLEX_FIELD:"DISABLE_FIELD",SELF_FIELD:"$self",COMPLEX_FIELD_AS:"as",UPDATE_CUSTOM_VIEW:"UPDATE_CUSTOM_VIEW",SEARCH_CUSTOM_VIEW:"SEARCH_CUSTOM_VIEW",UPDATE_HIDE_BUTTONS:"UPDATE_HIDE_BUTTONS",WEEKDAYS:["day.sunday","day.monday","day.tuesday","day.wednesday","day.thursday","day.friday","day.saturday"],WEEKEND_DAYS:["day.saturday","day.sunday"],MONTHS:["month.january","month.february","month.march","month.april","month.may","month.june","month.july","month.august","month.september","month.october","month.november","month.december"],SEARCH_USE_CATEGORY:"USE_SEARCH_CATEGORY",RESULTS_USE_CATEGORY:"USE_RESULTS_CATEGORY",HIDE_CATEGORY_HEADER:"HIDE_CATEGORY_HEADER",QUERY_PARAM_REGEXP:/^{\w+}$/,QUERY_COMPLEX_PARAM_REGEXP:/^{(\w+\.\w+)*}$/,SHOW_PAGINATION:"SHOW_PAGINATION",TABLE_CELL_RENDERER:"TABLE_CELL_RENDERER",TABLE_CELL_FILTER:"TABLE_CELL_FILTER",READ_ONLY:"READ_ONLY",TABLE_CONF_X_AXIS_PROPERTY:"X_AXIS_PROPERTY",TABLE_CONF_Y_AXIS_PROPERTY:"Y_AXIS_PROPERTY",TABLE_CONF_X_AXIS_MIN:"X_AXIS_MIN",TABLE_CONF_Y_AXIS_MIN:"Y_AXIS_MIN",TABLE_CONF_X_AXIS_MAX:"X_AXIS_MAX",TABLE_CONF_Y_AXIS_MAX:"Y_AXIS_MAX",TABLE_CONF_X_AXIS_STEP:"X_AXIS_STEP",TABLE_CONF_Y_AXIS_STEP:"Y_AXIS_STEP",LOOK_AND_FEEL_PLAIN:"plain",LOOK_AND_FEEL_TABS:"tabs",CONFIG_LOOK_AND_FEEL:"look-and-feel",HIDE_WHEN_CREATING:"hide-when-creation",HIDE_WHEN_UPDATING:"hide-when-updating"};angular.module("konga").controller("EntityDetailsController",function($scope){}),angular.module("konga").controller("EntitySearchController",["$scope","api","$routeParams","common","$rootScope","$filter","scaffold","$timeout","permissionManager","util",function($scope,api,$routeParams,common,$rootScope,$filter,scaffold,$timeout,permissionManager,util){function rootifyQuery(query,obj,metadata,fields){function getField(fields,name){var field=$filter("filter")(fields,{name:name},!0)[0];return field||(field=$filter("filter")(fields,{apiName:name},!0)[0]),field}metadata||(metadata=$scope.entityMetadata),fields||(fields=util.getEntityFields(metadata));for(var i in obj){var value=obj[i],field=getField(fields,i);if("object"==typeof value){if(field.type.type===util.constants.FIELD_COMPLEX){var complexMetadata=util.getMetadata(field.type.complexType);if(field.fieldType.search===util.constants.FIELD_COMPLEX){var complexFields=util.getEntityFields(complexMetadata),nestFields=field.searchable.fields,selectedFields=$filter("selectedFields")(complexFields,nestFields,field);rootifyQuery(query,value,complexMetadata,selectedFields);continue}rootifyQuery(query,value,complexMetadata);continue}field.searchConf.multiplicity===util.constants.MULTIPLICITY_MANY?(!value instanceof Array,value=value.join(",")):field.searchConf.policy===util.constants.VALIDATOR_RANGE}(value||value===!1||null===value||0===value)&&(query[i]=value)}}var entityType=$scope.entityType=$routeParams.entityType,localEndpoint=api.getLocalEndpoint(entityType),pageData=$rootScope.pageData;$scope.searchResults=[],$scope.pageItems=[];var pageData=$rootScope.pageData;$rootScope.paginationData||($rootScope.paginationData={}),$rootScope.paginationData[entityType]||($rootScope.paginationData[entityType]={},$rootScope.paginationData[entityType].count=0,$rootScope.paginationData[entityType].limit=20,$rootScope.paginationData[entityType].offset=1),$scope.paginationCount=$rootScope.paginationData[entityType].limit+"";var metadata=$scope.entityMetadata=common.getMetadata(entityType);$scope.isCreateable=null!==metadata.createable&&permissionManager.isAllowed(metadata.createable),pageData.init?($scope.searchResults=pageData.searchResults,$scope.query=pageData.query,$scope.filterOpened=pageData.filterOpened,$scope.filterClass=pageData.filterClass,$scope.resultTableWidth=pageData.resultTableWidth,$scope.quickSearchEnabled=pageData.quickSearchEnabled):(pageData.searchResults=$scope.searchResults,$scope.quickSearchEnabled=pageData.quickSearchEnabled=!1,$scope.query=pageData.query=scaffold.newQuery($scope.entityMetadata),$scope.filterOpened=pageData.filterOpened=!0),$scope.init=function(){null===$scope.entityMetadata.searchable?$scope.hideFilter():$scope.showFilter()};var quickSearchFields=$scope.quickSearch=$filter("quickSearch")(metadata),allFields=$filter("orderBy")(util.getEntityFields($scope.entityMetadata),"+priority.search");if($scope.fieldsShowInResult=$filter("resultParams")(allFields,$scope.entityMetadata),$scope.operations=$rootScope.operations,$scope.resetPaginationData=function(pagingOnly){$rootScope.paginationData[entityType].count=0,$rootScope.paginationData[entityType].offset=1,pagingOnly||($rootScope.paginationData[entityType].limit=20)},$scope.submit=function(query,sorting){$rootScope.operations.requestLoading("search_"+entityType);var paging=$rootScope.paginationData;if(void 0===query&&(query=angular.copy($scope.query)),query.resetPaging&&($scope.resetPaginationData(!0),query.resetPaging=void 0),query.resetSorting&&($scope.fieldsShowInResult=$filter("resultParams")($scope.fieldsShowInResult,$scope.entityMetadata),query.resetSorting=void 0),$scope.query=query,query.limit=paging[entityType].limit,query.offset=(paging[entityType].offset-1)*paging[entityType].limit,sorting){var apiName=sorting.field.apiName;apiName||(apiName=sorting.field.name),query.sortBy=apiName,query.sortAs=sorting.type}console.log(query);var sendQuery=$scope.oldQuery={};rootifyQuery(sendQuery,query);var path=metadata.apiPath;sendQuery.path=path,pageData.searchResults=$scope.searchResults=localEndpoint.search(sendQuery,function(){$rootScope.paginationData[entityType].count=$routeParams.count;$scope.currentItems(),$rootScope.operations.freeLoading("search_"+entityType)},function(error){var exceptionCode=error.data&&error.data.length?error.data[0].exceptionCode:"GENERIC_TECHNICAL_ERROR";$rootScope.operations.freeLoading("search_"+entityType),$rootScope.operations.addAlert(util.constants.ALERT_TYPE_ERROR,exceptionCode)})},$scope.submitSorting=function(field,type){$scope.submit($scope.query,{field:field,type:type})},$scope.timeout=1,$scope.executeQuickSearch=function(){$timeout.cancel($scope.timeout),$scope.timeout=$timeout(function(){$scope.quickSearchEnabled=pageData.quickSearchEnabled=!1;for(var quickSearchQuery=angular.copy($scope.query),i=0;i<quickSearchFields.length;i++){var field=quickSearchFields[i],name=field.metadata.apiName?field.metadata.apiName:field.metadata.name;quickSearchQuery[name]=field.value,quickSearchQuery[name].length?$scope.quickSearchEnabled=pageData.quickSearchEnabled=!0:delete quickSearchQuery[name]}var matchingActions=$filter("filter")(scope.entityMetadata.overrideDefaults,{overrides:"quick-search"},!0);if(matchingActions&&matchingActions.length)for(var i=0;i<matchingActions.length;i++)scope.dispatchSearchAction(matchingActions[i],{query:quickSearchQuery});else scope.dispatchSearchAction({name:"quick-search"},{query:quickSearchQuery})},1e3)},pageData.init){var refreshSearchKey=util.constants.REFRESH_SEARCH_KEY+entityType;console.log(common.read(refreshSearchKey)),common.read(refreshSearchKey)&&($scope.submit($scope.query),common.deleteKey(refreshSearchKey))}else{var query=rootifyQuery($scope.query);$scope.submit(query),pageData.init=!0}$scope.toggleFilter=function(){null!==$scope.entityMetadata.searchable&&($scope.filterOpened?$scope.hideFilter():$scope.showFilter())},$scope.hideFilter=function(){$scope.filterOpened=pageData.filterOpened=!1,$scope.filterClass=pageData.filterClass="filterHide",$scope.resultTableWidth=pageData.resultTableWidth="widthUp"},$scope.showFilter=function(){$scope.filterOpened=pageData.filterOpened=!0,$scope.filterClass=pageData.filterClass="filterShow",$scope.resultTableWidth=pageData.resultTableWidth="widthDown"},$scope.currentItems=function(){if($rootScope.paginationData[entityType].count>0){var items=$rootScope.paginationData[entityType].offset*$rootScope.paginationData[entityType].limit;$rootScope.paginationData[entityType].currentItems=items>$rootScope.paginationData[entityType].count?$rootScope.paginationData[entityType].count:items,$rootScope.paginationData[entityType].startingItem=($rootScope.paginationData[entityType].offset-1)*$rootScope.paginationData[entityType].limit+1;var endingItem=$rootScope.paginationData[entityType].startingItem+parseInt($rootScope.paginationData[entityType].limit)-1;$rootScope.paginationData[entityType].endingItem=endingItem>$rootScope.paginationData[entityType].count?$rootScope.paginationData[entityType].count:endingItem}else $rootScope.paginationData[entityType].currentItems=0},$scope.paginationSubmit=function(){$scope.paginationData[entityType].limit=parseInt($scope.paginationCount),$scope.submit($scope.oldQuery)},$scope.paginationUpdate=function(){$scope.currentItems()},$scope.$on("entity-search",function(conf,data){entityType==data.type&&$scope.submit()}),$scope.dispatchSearchAction=function(action,actionParams){var queryObj={};rootifyQuery(queryObj,$scope.query);var parameters={query:queryObj,metadata:$scope.entityMetadata,results:$scope.searchResults,self:$scope};if(actionParams)for(var item in actionParams)parameters[item]=actionParams[item];$scope.operations.dispatchAction(action,parameters)},$scope.$on("entity-search",function(evt,data){data.entityType===entityType&&$scope.submit()})}]),angular.module("konga").controller("EntityUpdateController",["$scope","api","$routeParams","common","$rootScope","$filter","fieldMapper","scaffold","$timeout","permissionManager","util",function($scope,api,$routeParams,common,$rootScope,$filter,fieldMapper,scaffold,$timeout,permissionManager,util){function updateChanges(){var hasChanges=!1;$scope.changes.length>0&&(hasChanges=!0),$scope.$emit("changes",{pageId:pageData.pageId,hasChanges:hasChanges}),$scope.$emit("changesCtrOperat",{type:entityType,hasChanges:hasChanges})}function verifyMatchType(matchType,fieldValue,triggerValue){var matches=!1;switch(matchType){case util.constants.TRIGGER_MATCH_TYPE_EXACT:matches=fieldValue+""===triggerValue;break;case util.constants.TRIGGER_MATCH_TYPE_RANGE:matches=fieldValue>=triggerValue}return matches}function verifyTrigger(trigger,value,okHandler,koHandler){var matchType=trigger.matchType,matches=!1;switch(trigger.match){case util.constants.TRIGGER_MATCH_VALUE:matches=verifyMatchType(matchType,value,trigger.value);break;case util.constants.TRIGGER_MATCH_LENGTH:var length=0;null!=value&&(length=value.length),matches=verifyMatchType(matchType,length,trigger.value)}if(matches){for(var params=[],f=0;f<trigger.parameters.length;f++){var strParam=trigger.parameters[f],arrParam=strParam.split("#"),param=null;switch(arrParam[0]){case util.constants.TRIGGER_PARAM_LABEL:param=arrParam[1]}params.push(param)}switch(trigger.type){case util.constants.TRIGGER_TYPE_CONFIRM:if(trigger.moment==util.constants.TRIGGER_MOMENT_IMMEDIATE&&"disable-entity"==trigger.name){if(void 0==$scope.creating||null==$scope.creating||0==$scope.creating){if($scope.entityUpdate.$invalid||$scope.invalid){var actionDefinition={name:"action-form-invalid"};return void $rootScope.operations.dispatchAction(actionDefinition)}$rootScope.operations.confirm(params[0],params[1],okHandler,koHandler)}}else $rootScope.operations.confirm(params[0],params[1],okHandler,koHandler);break;case util.constants.TRIGGER_TYPE_ALERT:$rootScope.operations.notify(params[0],params[1])}}}function verifyTriggers(moment,metadata,value,okHandler,koHandler){switch(moment){case util.constants.TRIGGER_MOMENT_IMMEDIATE:for(var triggers=$filter("filter")(metadata.triggers,{moment:moment}),i=0;i<triggers.length;i++)verifyTrigger(triggers[i],value,okHandler,koHandler);break;case util.constants.TRIGGER_MOMENT_COMMIT:angular.forEach(metadata.fields,function(field){for(var triggers=$filter("filter")(field.triggers,{moment:moment}),fieldValue=value[field.name],i=0;i<triggers.length;i++)verifyTrigger(triggers[i],fieldValue)})}}function waitEntityResolve(escaped,path,extraPath){var resolveWatcher=$scope.$watch("entity."+path+extraPath+".$resolved",function(){if(escaped.$resolved){for(var fields=util.getEntityFields($scope.entityMetadata),i=0;i<fields.length;i++){var field=fields[i],fieldPath=field.fieldPath,fieldRelated=0===fieldPath.indexOf(path);if(fieldRelated){var message={value:$filter("mapField")($scope.entity,fieldPath)};$scope.$broadcast("update_"+fieldPath,message)}}resolveWatcher()}})}function hasPermission(permission){var isAllowed=!1;return permissionManager.isAllowed(permission)&&(isAllowed=!0),isAllowed||$rootScope.operations.dispatchAction({name:"action-forbidden"},{}),isAllowed}function controlValidation(){$scope.invalid=!1;for(var field in validationData)if(validationData[field].length){$scope.invalid=!0;break}}var entityType=$routeParams.entityType,entityId=$routeParams.entityId;$scope.alreadyValidated=!1;var metadata=$scope.entityMetadata=common.getMetadata(entityType),localEndpoint=api.getLocalEndpoint(metadata.name);switch($scope.entity={},$scope.params={},$scope.formStyle="",$scope.metadata.updateStyle){case util.constants.FORM_STYLE_HORIZONTAL:$scope.formStyle="form-horizontal"}$scope.deletable=null!=$scope.entityMetadata.deleteable&&entityId!==util.constants.NEW_ENTITY_ID,$scope.disabledDelete=!1;var allFields=util.getEntityFields($scope.entityMetadata);$scope.fields=$filter("filter")(allFields,{editable:!0}),$scope.showActions=!0;var configuration=$scope.entityMetadata.configuration,buttonConfiguration=$filter("filter")(configuration,{key:util.constants.UPDATE_HIDE_BUTTONS},!0)[0];buttonConfiguration&&"true"===buttonConfiguration.value&&($scope.showActions=!1);var pageData=$rootScope.pageData,validationData=null;if($scope.invalid=!1,$scope.customDisableValider=!1,pageData.init)$scope.entity=pageData.entity,$scope.changes=pageData.changes,validationData=pageData.validationData,$rootScope.pageData.creating&&($scope.creating=$rootScope.pageData.creating),updateChanges();else{if(validationData=pageData.validationData={},entityId!=util.constants.NEW_ENTITY_ID){$rootScope.operations.requestLoading("update_"+entityId);var path=metadata.apiPath,entity=common.read(entityId);entity?($scope.entity=pageData.entity=entity,entityId=util.getEntityId(metadata,entity)):$scope.entity=pageData.entity=localEndpoint.get({path:path,id:entityId},function(data){pageData.original=angular.copy($scope.entity),$rootScope.operations.freeLoading("update_"+entityId)})}else{$scope.creating=!0,$rootScope.pageData.creating=$scope.creating;var newEntity=scaffold.newEntity($scope.entityMetadata,localEndpoint);$scope.entity=pageData.entity=newEntity,pageData.original=angular.copy($scope.entity)}$scope.changes=pageData.changes=[],pageData.init=!0}$scope.operations={dispatchEntityAction:function(name){$scope.alreadyValidated=!0,$timeout(function(){$scope.alreadyValidated=!1},3e3);var overrideDefaults=$scope.entityMetadata.overrideDefaults,matchingActions=null;overrideDefaults.length&&(matchingActions=$filter("filter")(overrideDefaults,{overrides:name}));var actionParams={id:entityId,entityType:entityType,self:$scope,item:$scope.entity,data:$scope.params};switch(name){case"save":var permission=$scope.entityMetadata.editable;if(hasPermission(permission)){matchingActions&&matchingActions.length?$rootScope.operations.dispatchActionBatch(matchingActions,actionParams):$scope.operations.saveEntity();var refreshSearchKey=util.constants.REFRESH_SEARCH_KEY+entityType;common.store(refreshSearchKey,!0)}break;case"delete":}},updateChanges:function(){updateChanges()},saveEntity:function(handlerOK,handlerKO){function handlerDefaultOK(data){actionParams.data=data,$rootScope.operations.dispatchAction({name:"save-ok"},actionParams)}function handlerDefaultKO(error){actionParams.error=error,$rootScope.operations.dispatchAction({name:"save-ko"},actionParams)}var actionParams={id:entityId,entityType:entityType,self:$scope,item:$scope.entity,params:$scope.params};verifyTriggers(util.constants.TRIGGER_MOMENT_COMMIT,$scope.entityMetadata,$scope.entity);var entity=$scope.entity;handlerOK||(handlerOK=handlerDefaultOK),handlerKO||(handlerKO=handlerDefaultKO),$scope.params.path=metadata.apiPath,entityId===util.constants.NEW_ENTITY_ID?entity.$create($scope.params,handlerOK,handlerKO):entity.$save($scope.params,handlerOK,handlerKO)},cancelUpdate:function(){pageData.init=!1,$rootScope.operations.closeTabById(pageData.pageId)},deleteEntity:function(){function okDeleteEntity(){var path=$scope.entityMetadata.apiPath;localEndpoint["delete"]({path:path,id:util.getEntityId($scope.entityMetadata,entity)},function(){$rootScope.operations.addAlert(util.constants.ALERT_TYPE_SUCCESS,"message.action-confirmation.delete.success"),pageData.init=!1,$scope.$emit("changes",{pageId:pageData.pageId,hasChanges:!1}),$rootScope.operations.closeTabById(pageData.pageId)},function error(error){actionParams.error=error,$rootScope.operations.dispatchAction({name:"delete-ko"},actionParams)})}function koDeleteEntity(){}var actionParams={id:entityId,entityType:entityType,self:$scope,item:$scope.entity,params:$scope.params},permission=$scope.entityMetadata.deleteable;if(permissionManager.isAllowed(permission)){var entity=$scope.entity;entityId!==util.constants.NEW_ENTITY_ID&&$rootScope.operations.confirm("message.delete-entity.title","message.delete-entity.message",okDeleteEntity,koDeleteEntity);var refreshSearchKey=util.constants.REFRESH_SEARCH_KEY+entityType;common.store(refreshSearchKey,!0)}else{var forbidden={name:"action-forbidden"};$rootScope.operations.dispatchAction(forbidden)}},changeEntityField:function(metadata,result){function okHandler(){var refreshSearchKey=util.constants.REFRESH_SEARCH_KEY+entityType;common.store(refreshSearchKey,!0),$scope.operations.saveEntity()}function koHandler(){var undoValue=angular.copy(result);undoValue.text=oldValue,$scope.operations.updateEntityField(metadata,undoValue,$scope.entity),$scope.$broadcast("update_"+metadata.owner+"_"+metadata.name,{})}var fieldValue=result.text;if($scope.entity.$resolved!==!1){var oldValue=$filter("mapField")(pageData.original,metadata),differs=fieldValue!==oldValue,index=$scope.changes.indexOf(metadata.name);return differs&&-1===index?($scope.changes.push(metadata.fieldName),verifyTriggers(util.constants.TRIGGER_MOMENT_IMMEDIATE,metadata,fieldValue,okHandler,koHandler)):differs||-1===index||$scope.changes.splice(index,1),updateChanges(),differs}},updateEntityField:function(metadata,value,entity,parentField,parentEntity){var result=fieldMapper.unmapField(metadata,entityType,entity,value,parentField,parentEntity);if(result){var escaped=result.escaped;if(escaped){var fieldType=metadata.fieldType,multiplicity=metadata.multiplicity;if(fieldType===util.constants.FIELD_COMPLEX||fieldType==util.constants.FIELD_LIST){var path=result.path,extraPath="";if(escaped.$resolved!==!1){if(!escaped.length){var eventName="update_"+metadata.owner+"_"+metadata.name;$scope.$broadcast(eventName,{})}for(var i=0;i<escaped.length;i++)multiplicity===util.constants.MULTIPLICITY_MANY&&(extraPath+="["+i+"]"),waitEntityResolve(escaped[i],path,extraPath)}else waitEntityResolve(escaped,path,"")}}}return result}},$scope.$on("entity-deletable",function(conf,data){$scope.deletable=data.deletable,$scope.disabledDelete=data.disabledDelete}),$scope.$on("entity-updatable-custom",function(conf,data){$scope.customDisableValider=data.disabledUpdate}),$scope.$on("discard",function(conf,data){data.pageId===pageData.pageId&&"new"!==entityType&&($scope.entity=pageData.entity=localEndpoint.get({id:entityType}))}),$scope.$on("tab-has-changes",function(conf,data){data.hasChange?$scope.changes.push(data.field):$scope.changes.pop(data.field),updateChanges()}),controlValidation(),$scope.$on("form-invalid",function(conf,invalid){var fieldName=invalid.owner+"-"+invalid.field,validation=invalid.validation,valid=invalid.valid;if(valid){if(validationData[fieldName]){var index=validationData[fieldName].indexOf(validation);-1!==index&&validationData[fieldName].splice(index,1),validationData[fieldName].length||delete validationData[fieldName]}}else{validationData[fieldName]||(validationData[fieldName]=[]);var index=validationData[fieldName].indexOf(validation);-1===index&&validationData[fieldName].push(validation)}controlValidation()}),$scope.$on("form-reset-invalid-date",function(){for(var name in validationData)if(validationData.hasOwnProperty(name))for(var clone=validationData[name].slice(0),i=0;void 0!=clone&&i<clone.length;i++)switch(clone[i]){case"DATE_GE":case"DATE_GT":case"DATE_LE":case"DATE_LT":validationData[name].splice(i,1),0==validationData[name].length&&delete validationData[name]}controlValidation()}),$scope.$on("closeCtrOperat",function(){$rootScope.operations.closeTabById(pageData.pageId)}),$scope.$on("createCtrOperat",function(){var refreshSearchKey=util.constants.REFRESH_SEARCH_KEY+entityType;common.store(refreshSearchKey,!0),$scope.operations.saveEntity()})}]),angular.module("konga").controller("KongaController",["$scope","$location","$filter","$rootScope","$timeout","common","scaffold","$translate","userData","$cookieStore","actionManager","$modal","permissionManager","kongaConfig","util","dialogs",function($scope,$location,$filter,$rootScope,$timeout,common,scaffold,$translate,userData,$cookieStore,actionManager,$modal,permissionManager,kongaConfig,util,dialogs){$scope.configConstants=kongaConfig,$rootScope.tabs=$scope.tabs=[],$scope.tabId=null,$scope.tabExtra={},$rootScope.alerts=$scope.alerts=[],$rootScope.tabWatch=$scope.tabWatch={enabled:!0},$scope.loading=[],$scope.loadingMessage=null,$rootScope.operations=$scope.operations={addAlert:function(type,msg,parameters){var alert={type:type,msg:msg,parameters:parameters?parameters:{},expired:!1};$scope.alerts.push(alert);$timeout(function(){alert.expired=!0},4e3)},removeAlert:function(index){$scope.alerts.splice(index,1)},confirm:function(title,message,okHandler,koHandler,params){var dlg=null,localeTitle=$filter("translate")(title,params),localeMessage=$filter("translate")(message,params);dlg=dialogs.confirm(localeTitle,localeMessage),dlg.result.then(function(btn){okHandler&&okHandler(btn,params)},function(btn){koHandler&&koHandler(btn,params)})},notify:function(title,message,type,params){type||(type="notify");var actionParameters=params?params.parameters:{};if("confirm"===type)return void this.confirm(title,message,params.okHandler,params.koHandler,actionParameters);var dlg=null,localeTitle=$filter("translate")(title,actionParameters),localeMessage=$filter("translate")(message,actionParameters);dlg=dialogs[type](localeTitle,localeMessage)},openEntitySearch:function(entityMetadata,params){"string"==typeof entityMetadata&&(entityMetadata=util.getMetadata(entityMetadata));var tabId=util.constants.ENTITY_ID_PREFFIX+entityMetadata.name+util.constants.SEARCH_SUFFIX,tabTitle="message.tabs.entity.search",extra=$scope.tabExtra[tabId]={};extra.label=$filter("translate")(entityMetadata.label),extra.labelPlaceholder=entityMetadata.label;var tab={id:tabId,title:tabTitle,href:"/entity/"+entityMetadata.name+"/search/",closable:!0,entityMetadata:entityMetadata,type:util.constants.TAB_TYPE_SEARCH};if(params)for(var param in params)tab[param]=params[param];$scope.operations.addTab(tab)},openEntityUpdate:function(entityMetadata,entity,params){"string"==typeof entityMetadata&&(entityMetadata=util.getMetadata(entityMetadata));var entityId=null;params&&params.useEntity?(entityId="stored-entity-"+(new Date).getTime(),common.store(entityId,entity)):entityId=util.getEntityId(entityMetadata,entity);var tabId=util.constants.ENTITY_ID_PREFFIX+entityMetadata.name+util.constants.STRING_SEPARATOR+entityId,entityCode=util.getEntityCode(entityMetadata,entity),tabTitle=entity?"message.tabs.entity.update":"message.tabs.entity.create",extra=$scope.tabExtra[tabId]={};extra.label=$filter("translate")(entityMetadata.label),extra.code=entityCode,extra.labelPlaceholder=entityMetadata.label;var tab={id:tabId,title:tabTitle,href:"/entity/"+entityMetadata.name+"/"+entityId+"/",closable:!0,hasChanges:!1,entityMetadata:entityMetadata,type:util.constants.TAB_TYPE_UPDATE};if(params)for(var param in params)tab[param]=params[param];$scope.operations.addTab(tab)},openEntityCreate:function(entityMetadata,params){"string"==typeof entityMetadata&&(entityMetadata=util.getMetadata(entityMetadata));var permission=entityMetadata.createable;if(permissionManager.isAllowed(permission))$scope.operations.openEntityUpdate(entityMetadata,null,params);else{var forbidden={name:"action-forbidden"};$scope.operations.dispatchAction(forbidden)}},openModal:function(action){$rootScope.$broadcast("suspend",{});var modalInstance=$modal.open({templateUrl:action.template,controller:action.controller,size:action.size||"md",resolve:{params:function(){return action.parameters}}});modalInstance.result.then(function(){$rootScope.$broadcast("resume",{}),action.okHandler.apply(action,arguments)},function(){$rootScope.$broadcast("resume",{}),action.koHandler.apply(action,arguments)})},addTab:function(newTab){var tabActive=$filter("filter")($scope.tabs,{active:!0})[0],existingTabs=$filter("filter")($scope.tabs,{id:newTab.id},!0);if(!existingTabs.length){if(newTab.type===util.constants.TAB_TYPE_UPDATE){var indexActive=$scope.tabs.indexOf(tabActive);$scope.tabs.splice(indexActive+1,0,newTab),existingTabs.push(newTab)}else $rootScope.tabs.push(newTab),existingTabs.push(newTab);!newTab.entityMetadata&&newTab.entityType&&(newTab.entityMetadata=util.getMetadata(newTab.entityType))}existingTabs[0].previousTab=tabActive,$scope.operations.redirectTo(existingTabs[0])},closeTab:function(tab,force){function deleteTab(index,tab){$rootScope.tabs.splice(i,1),$scope.updateData&&$scope.updateData["tab.id"]&&delete $scope.updateData["tab.id"],common.deletePageData(tab.id),tab.previousTab&&-1!==$rootScope.tabs.indexOf(tab.previousTab)&&$timeout(function(){$scope.operations.redirectTo(tab.previousTab)},500)}for(var changesOKHandler=function(){deleteTab(i,tab),$scope.$broadcast("discard",{pageId:tab.id})},changesKOHandler=function(){},i=0;i<$rootScope.tabs.length;i++)if($scope.tabs[i].id===tab.id)return void(tab.hasChanges&&!force?$scope.operations.confirm("message.discard-changes.title","message.discard-changes.message",changesOKHandler,changesKOHandler):deleteTab(i,tab))},closeTabById:function(id){for(var i=0;i<$rootScope.tabs.length;i++)if($scope.tabs[i].id===id){$scope.operations.closeTab($scope.tabs[i],!1);break}},closeAllTabs:function(force){for(var copyTabs=$rootScope.tabs.slice(0),i=0;i<copyTabs.length;i++)$scope.operations.closeTab(copyTabs[i],force)},redirectTo:function(tab){angular.forEach($rootScope.tabs,function(item){item.active=!1}),$rootScope.pageData=$scope.pageData=common.getPageData(tab.id),$rootScope.pageData.parameters=tab.parameters,$rootScope.tabs[$rootScope.tabs.indexOf(tab)].active=!0,$location.path()!==tab.href&&$location.path(tab.href),$scope.tabId=tab.id},requestLoading:function(source,message){$scope.loading.push(source),$scope.loadingMessage=message},freeLoading:function(source){var index=$scope.loading.indexOf(source);$scope.loading.splice(index,1)},setLoadingMessage:function(message){$scope.loadingMessage=message},changeLocale:function(newLocale){$scope.selectedLanguage=util.constants.LANGUAGE_MESSAGE_PREFFIX+newLocale;var oldLocale=$translate.use();$translate.use(newLocale),
$scope.$broadcast("locale-change",{old:oldLocale,"new":newLocale})},dispatchAction:function(action,parameters){parameters||(parameters={}),actionManager.dispatch(action,parameters)},dispatchActionBatch:function(actions,parameters){for(var i=0;i<actions.length;i++)$scope.operations.dispatchAction(actions[i],parameters)}},$scope.$on("changes",function(conf,data){for(var tabs=$scope.tabs,tab=null,i=0;i<tabs.length&&(tab=tabs[i],tab.id!==data.pageId);i++);tab.hasChanges=data.hasChanges}),$scope.$on("locale-change",function(){for(var item in $scope.tabExtra){var extra=$scope.tabExtra[item];extra.label=$filter("translate")(extra.labelPlaceholder)}})}]),angular.module("konga").controller("MultiSelectController",["$scope","$filter","$modalInstance","model","field","parentField","common","api","entity","metadata","items","$timeout","$rootScope","util",function($scope,$filter,$modalInstance,model,field,parentField,common,api,entity,metadata,items,$timeout,$rootScope,util){function updateValue(){var codes=[],ids=[],entity=[],selectedItems=$filter("filter")($scope.sourceList,{added:!0});if(selectedItems.length){for(var i=0;i<selectedItems.length;i++)ids.push(selectedItems[i].id),codes.push(selectedItems[i].key);for(var f=0;f<$scope.realList.length;f++)-1!==ids.indexOf($scope.realList[f][$scope.idField])&&entity.push($scope.realList[f])}$scope.model={text:ids,ids:ids,entity:entity,metadata:relatedMetadata}}$scope.id="multi-select",$scope.model=model,$scope.selected=null,$scope.filter={value:""},$scope.idField=null,$scope.limit=50,$scope.offset=0,$scope.field=null,$scope.loading=!0;var localEndpoint=null,relatedMetadata=null,scrollWatchEnabled=!0,allFetched=!1,query=null,quickSearchFields=$scope.quickSearch=[];$scope.multiselectModal={contentUrl:"/konga/views/multi-select-modal.html",animation:"am-fade-and-slide-top",save:function(){var newValue=$scope.model;$modalInstance.close(newValue)},cancel:function(){$modalInstance.dismiss("cancel")}},$scope.operations={init:function(){var entityType=null;field.type.type===util.constants.FIELD_COMPLEX?(entityType=field.type.complexType,$scope.field=field):field.isKey?(entityType=field.owner,$scope.field=field):(entityType=parentField.type.complexType,$scope.field=parentField),$scope.id="multi-select-"+entityType,relatedMetadata=util.getMetadata(entityType),quickSearchFields=$scope.quickSearch=$filter("quickSearch")(relatedMetadata),$scope.idField=util.getEntityId(relatedMetadata,null,!0),$scope.sourceList=[],$scope.realList=[],localEndpoint=api.getLocalEndpoint(entityType),$scope.callService(),$scope.$on($scope.id+"-scroll-watcher",function(event,msg){msg.relative>.7&&scrollWatchEnabled&&(scrollWatchEnabled=!1,$scope.scroll(msg))})},toggle:function(item,selected){void 0===selected&&(selected=!item.selected),item.selected=selected},add:function(){for(var code=0;code<$scope.sourceList.length;code++){var item=$scope.sourceList[code];item.selected&&(item.added=!0),item.selected=!1}updateValue()},remove:function(){for(var code=0;code<$scope.sourceList.length;code++){var item=$scope.sourceList[code];item.selected&&(item.added=!1),item.selected=!1}updateValue()},addAll:function(){if(allFetched){for(var code=0;code<$scope.sourceList.length;code++){var item=$scope.sourceList[code];item.added=!0,item.selected=!1}updateValue()}else{var configuration={offset:1,limit:0};$scope.callService(configuration,function(){for(var code=0;code<$scope.sourceList.length;code++){var item=$scope.sourceList[code];item.added=!0,item.selected=!1}updateValue()})}},removeAll:function(){for(var code=0;code<$scope.sourceList.length;code++){var item=$scope.sourceList[code];item.added=!1,item.selected=!1}updateValue()}},$scope.scroll=function(){$scope.offset+=$scope.limit,allFetched||$scope.callService(void 0,function(){})},$scope.treatData=function(data,callback){data.length<$scope.limit&&(allFetched=!0);var filter=$scope.field.type.filter,newList=null;if(filter&&filter.length)try{newList=$filter(filter)(data)}catch(e){newList=data}else newList=data;var verifiedList=[];if($scope.offset>1)for(var idField=util.getEntityId(relatedMetadata,null,!0),i=0;i<newList.length;i++){for(var ok=!0,f=0;f<$scope.realList.length;f++)if(newList[i][idField]===$scope.realList[f][idField]){ok=!1;break}ok&&verifiedList.push(newList[i])}else verifiedList=newList;var parsedList=$filter("selectData")(relatedMetadata,verifiedList);if(0===$scope.offset?($scope.sourceList=parsedList,$scope.realList=verifiedList):($scope.sourceList=$scope.sourceList.concat(parsedList),$scope.realList=$scope.realList.concat(verifiedList)),$scope.model.entity){for(var selectedIds=[],selectedItems=[],i=0;i<$scope.model.entity.length;i++)selectedIds.push($scope.model.entity[i][$scope.idField]),selectedItems.push($scope.model.entity[i]);for(var i=0;i<$scope.sourceList.length;i++){var index=selectedIds.indexOf($scope.sourceList[i].id);-1!==index&&($scope.sourceList[i].added=!0,selectedItems.splice(index,1),selectedIds.splice(index,1))}var parsedEntities=$filter("selectData")(relatedMetadata,selectedItems,{added:!0});$scope.sourceList=$scope.sourceList.concat(parsedEntities),$scope.realList=$scope.realList.concat(selectedItems)}callback&&callback(),scrollWatchEnabled=!0,$scope.loading=!1},$scope.callService=function(configuration,callback){$scope.loading=!0;var oldQuery=query;query=$filter("queryParser")($scope.field,entity,oldQuery),query.path=relatedMetadata.apiPath,query.offset=configuration&&void 0!==configuration.offset?configuration.offset:$scope.offset,query.limit=configuration&&void 0!==configuration.limit?configuration.limit:$scope.limit,query.sortBy||(query.sortBy=$scope.idField,query.sortAs="asc");var from=$scope.field.type.from;if(from){var action={name:from},parameters={query:query,metadata:relatedMetadata,self:$scope,okHandler:function(data){$scope.treatData(data,callback)},koHandler:function(){}};$rootScope.operations.dispatchAction(action,parameters)}else localEndpoint.search(query,function(data){$scope.treatData(data,callback)},function(){})},$scope.timeout=1,$scope.executeQuickSearch=function(){$scope.loading=!0,$timeout.cancel($scope.timeout),$scope.timeout=$timeout(function(){for(var i=0;i<quickSearchFields.length;i++){var field=quickSearchFields[i],name=field.metadata.apiName?field.metadata.apiName:field.metadata.name;query[name]=field.value,query[name].length||delete query[name]}$scope.offset=0,allFetched=!1,$scope.callService(function(){})},1e3)}}]),angular.module("konga").controller("SingleSelectController",["$scope","$filter","$modalInstance","model","field","parentField","common","api","entity","metadata","items","$timeout","$rootScope","util",function($scope,$filter,$modalInstance,model,field,parentField,common,api,entity,metadata,items,$timeout,$rootScope,util){function updateValue(){var codes=[],ids=[],entity=null;if($scope.selected){for(var selected=[],i=0;i<$scope.realList.length;i++)$scope.realList[i][$scope.idField]===$scope.selected.id&&selected.push($scope.realList[i]);selected.length&&(entity=selected[0],codes.push($scope.selected.key),ids.push($scope.selected.id))}$scope.model={text:ids,ids:ids,entity:entity,metadata:relatedMetadata}}$scope.id="single-select",$scope.model=model,$scope.selected=null,$scope.filter={value:""},$scope.idField=null,$scope.limit=50,$scope.offset=0,$scope.field=null,$scope.loading=!0;var localEndpoint=null,relatedMetadata=null,scrollWatchEnabled=!0,allFetched=!1,query=null,quickSearchFields=$scope.quickSearch=[];$scope.singleselectModal={contentUrl:"/konga/views/multi-select-modal.html",animation:"am-fade-and-slide-top",save:function(){var newValue=$scope.model;$modalInstance.close(newValue)},cancel:function(){$modalInstance.dismiss("cancel")}},$scope.operations={init:function(){var entityType=null;field.type.type===util.constants.FIELD_COMPLEX?(entityType=field.type.complexType,$scope.field=field):(entityType=parentField.type.complexType,$scope.field=parentField),$scope.id="single-select-"+entityType,relatedMetadata=util.getMetadata(entityType),quickSearchFields=$scope.quickSearch=$filter("quickSearch")(relatedMetadata),$scope.idField=util.getEntityId(relatedMetadata,null,!0),$scope.sourceList=[],$scope.realList=[],localEndpoint=api.getLocalEndpoint(entityType),$scope.callService(),$scope.$on($scope.id+"-scroll-watcher",function(event,msg){msg.relative>.7&&scrollWatchEnabled&&(scrollWatchEnabled=!1,$scope.scroll(msg))})},toggle:function(item){item==$scope.selected?$scope.selected=null:$scope.selected=item,updateValue()}},$scope.scroll=function(){$scope.offset+=$scope.limit,allFetched||$scope.callService(function(){})},$scope.treatData=function(data,callback){data.length<$scope.limit&&(allFetched=!0);var filter=$scope.field.type.filter,newList=null;if(entity&&metadata.name===$scope.field.type.complexType){var idField=util.getEntityId(metadata,null,!0),filterObj={};filterObj[idField]=entity[idField];var same=filterObj[idField]?$filter("filter")(data,filterObj,!0):[];if(same.length){var elt=same[0],index=data.indexOf(elt);-1!==index&&data.splice(index,1)}}var filter=$scope.field.type.filter,newList=null;if(filter&&filter.length)try{newList=$filter(filter)(data)}catch(e){newList=data}else newList=data;var parsedList=$filter("selectData")(relatedMetadata,newList);if(1===$scope.offset?($scope.sourceList=parsedList,$scope.realList=newList):($scope.sourceList=$scope.sourceList.concat(parsedList),$scope.realList=$scope.realList.concat(newList)),$scope.model.entity)for(var selectedId=$scope.model.entity[$scope.idField],i=0;i<$scope.sourceList.length;i++)if(selectedId===$scope.sourceList[i].id){$scope.selected=$scope.sourceList[i];break}callback&&callback(),scrollWatchEnabled=!0,$scope.loading=!1},$scope.callService=function(callback){$scope.loading=!0;var oldQuery=query;query=$filter("queryParser")($scope.field,entity,oldQuery),query.path=relatedMetadata.apiPath,query.offset=$scope.offset,query.limit=$scope.limit;var from=$scope.field.type.from;if(from){var action={name:from},parameters={query:query,metadata:relatedMetadata,self:$scope,okHandler:function(data){$scope.treatData(data,callback)},koHandler:function(error){}};$rootScope.operations.dispatchAction(action,parameters)}else localEndpoint.search(query,function(data){$scope.treatData(data,callback)},function(error){})},$scope.timeout=1,$scope.executeQuickSearch=function(){$scope.loading=!0,$timeout.cancel($scope.timeout),$scope.timeout=$timeout(function(){for(var i=0;i<quickSearchFields.length;i++){var field=quickSearchFields[i],name=field.metadata.apiName?field.metadata.apiName:field.metadata.name;query[name]=field.value,query[name].length||delete query[name]}$scope.offset=0,allFetched=!1,$scope.callService(function(){})},1e3)}}]),angular.module("konga").directive("calendarInput",function(){return{templateUrl:"/konga/views/calendar-input.html",restrict:"E",replace:!0,link:function(scope,element,attrs){scope.uiConfig={calendar:{height:600,editable:!0,header:{left:"",center:"title",right:"today prev,next"},firstDay:1,events:scope.value.entity,dayClick:function(date,jsEvent,view,resourceObj){scope.$emit("calendar-day-click",{date:date,jsEvent:jsEvent,view:view,resourceObj:resourceObj})},eventClick:function(date,jsEvent,view){scope.$emit("calendar-event-click",{date:date,jsEvent:jsEvent,view:view})},eventDrop:function(){},eventResize:function(){},eventRender:function(event,element,view){scope.$emit("calendar-event-render",{event:event,element:element,view:view})}}}}}}),angular.module("konga").directive("fileInput",["$upload",function(){return{templateUrl:"/konga/views/file-input.html",restrict:"E",replace:!0,link:function(scope,element,attrs){scope.fileSelected=function(files,event){scope.value.files=files}}}}]),angular.module("konga").directive("inputFormat",["$filter",function($filter){return{require:"?ngModel",link:function(scope,elem,attrs,ctrl){ctrl&&(ctrl.$formatters.unshift(function(a){return $filter(attrs.format)(ctrl.$modelValue)}),ctrl.$parsers.unshift(function(viewValue){var plainNumber=viewValue.replace(/[^\d|\-+|\.+]/g,"");return elem.val($filter(attrs.format)(plainNumber)),plainNumber}))}}}]),angular.module("konga").directive("kongaContent",["$filter","util",function($filter,util){return{templateUrl:"/konga/views/konga-content.html",restrict:"E",replace:!0,link:function(scope,element,attrs){function init(){var appConfiguration=util.getConfiguration(),appLookAndFeel=util.constants.LOOK_AND_FEEL_PLAIN,lookAndFeelConf=$filter("filter")(appConfiguration,{key:util.constants.CONFIG_LOOK_AND_FEEL},!0)[0];lookAndFeelConf&&(appLookAndFeel=lookAndFeelConf.value),scope.contentView="/konga/views/konga-content-"+appLookAndFeel+".html"}util.metadataObject?init():scope.$on("metadata-ready",function(){init()})}}}]),angular.module("konga").directive("kongaFieldName",function($compile,$parse){return{restrict:"A",terminal:!0,priority:1e5,link:function(scope,element,attrs){var name=$parse(element.attr("konga-field-name"))(scope);element.removeAttr("konga-field-name"),element.attr("name",name),$compile(element)(scope)}}}),angular.module("konga").directive("kongaSelect",function(){return{restrict:"A",link:function(scope,element,attrs){scope.removeItem=function(index){scope.value.entity.splice(index,1);var value=scope.value.text.split(",");value.splice(index,1),scope.value.text=value.join(",")},scope.writeValue=function(){scope.value.entity instanceof Array?scope.value.entity.splice(0,scope.value.entity.length):scope.value.entity={}}}}}),angular.module("konga").directive("listInput",["util","$filter",function(util,$filter){return{templateUrl:"/konga/views/list-input.html",restrict:"E",transclude:!1,replace:!0,scope:{originalFields:"=fields",list:"=",actions:"=",metadata:"=",property:"=?",setSelectedElements:"=",disabledIds:"=",dispatchFieldAction:"="},link:function(scope){function filterList(){if(scope.property){var filter=scope.property.type.filter,newList=scope.list;filter&&filter.length&&(newList=$filter(filter)(scope.list)),scope.filteredList=newList}}scope.disableField=scope.$parent.disableField,scope.paginate=!0;var configuration=scope.property.fieldType.configuration[0],paginationConfiguration=$filter("filter")(configuration,{key:util.constants.SHOW_PAGINATION,value:"false"},!0);paginationConfiguration&&paginationConfiguration.length&&(scope.paginate=!1),scope.filteredList=scope.list;var listenerName=scope.property.owner+"_"+scope.property.name;if(scope.$on("updateFilter_"+listenerName,function(){filterList()}),scope.$watchCollection("originalFields",function(newFields){function divideComplexField(field){for(var relatedMetadata=util.getMetadata(field.type.complexType),relatedFields=util.getEntityFields(relatedMetadata),nestFields=field.showInResults.fields,selectedFields=$filter("selectedFields")(relatedFields,nestFields),fi=0;fi<selectedFields.length;fi++)selectedFields[fi].fieldType.results===util.constants.FIELD_COMPLEX?divideComplexField(selectedFields[fi]):(selectedFields[fi].derivedPath.splice(0,0,field),scope.fields.push(selectedFields[fi]))}scope.originalFields=newFields;var allFields=newFields;scope.fields=[];for(var f=0;f<allFields.length;f++){var field=allFields[f];field.type.type===util.constants.FIELD_COMPLEX&&field.fieldType.results===util.constants.FIELD_COMPLEX&&field.showInResults.fields.length?divideComplexField(field):scope.fields.push(field)}}),scope.selectAllItmsData=!1,scope.selectedData=!1,scope.paginationData={currentItems:0,totalItems:0,limit:scope.paginate?10:1e3,offset:1,maxPages:1},scope.selected=[],scope.selectedIds={},scope.quickSearchParams={value:"",param:{}},scope.getTotalItems=function(){var totalItems=scope.paginationData.count=scope.list?scope.list.length:0,count=0;return scope.selectedData&&(angular.forEach(scope.list,function(item){item.selected&&count++}),totalItems=count),totalItems},scope.currentItems=function(){var totalItems=scope.getTotalItems();if(totalItems>0){var items=scope.paginationData.offset*scope.paginationData.limit;scope.paginationData.currentItems=items>totalItems?totalItems:items}else scope.paginationData.currentItems=0},scope.maxPages=function(){var totalItems=scope.getTotalItems();scope.paginationData.maxPages=Math.ceil(totalItems/scope.paginationData.limit),scope.paginationData.maxPages<scope.paginationData.offset&&scope.paginationData.maxPages>0&&(scope.paginationData.offset=scope.paginationData.maxPages)},scope.pageChanged=function(orientation){switch(orientation){case"first":scope.paginationData.offset=1;break;case"previous":scope.paginationData.offset=scope.paginationData.offset-1>1?scope.paginationData.offset-1:1;break;case"next":scope.paginationData.offset=scope.paginationData.offset+1<scope.paginationData.maxPages?scope.paginationData.offset+1:scope.paginationData.maxPages;break;case"last":scope.paginationData.offset=scope.paginationData.maxPages}orientation&&"undefined"!=typeof orientation||scope.maxPages(),scope.currentItems()},scope.selectAllHandler=function(){for(var length=scope.list?scope.list.length:0,i=0;length>i;i++)("undefined"!=typeof scope.disabledIds&&!scope.disabledIds[scope.list[i].id]||"undefined"==typeof scope.disabledIds)&&(scope.list[i].selected=scope.selectAllItmsData);scope.pageChanged()},scope.onDisplaySelectedItems=function(){scope.paginationData.offset=1,scope.pageChanged()},scope.onSelectListEds=function(){scope.pageChanged(),scope.filteredList=scope.list},scope.quickSearchHandler=function(){var result={};angular.forEach(scope.quickSearchParams.param,function(item,key){if(key.indexOf(".")>0){var keyList=key.split(".");switch(result[keyList[0]]={},keyList.length){case 2:result[keyList[0]][keyList[1]]=item;break;case 3:result[keyList[0]][keyList[1]]={},result[keyList[0]][keyList[1]][keyList[2]]=item;break;case 4:result[keyList[0]][keyList[1]]={},result[keyList[0]][keyList[1]][keyList[2]]={},result[keyList[0]][keyList[1]][keyList[2]][keyList[3]]=item}}else result[key]=item}),scope.quickSearchParams.value=result,scope.paginationData.offset=1,scope.pageChanged()},scope.property.fieldType.update==util.constants.FIELD_PICK_LIST){var validation=scope.property.validation,length=scope.list?scope.list.length:0;validation.minLength&&length<validation.minLength&&scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:"min-length",valid:!1})}scope.validate=function(){var dataFilter=$filter("filter")(scope.list,{selected:!0},transclude);scope.setSelectedElements(scope.edsType,dataFilter)},scope.cancel=function(){scope.selectAllItmsData=!1,scope.selectAllHandler()};var watchers=null;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers}),scope.$watchCollection("selectAllItmsData",scope.selectAllHandler),scope.$watchCollection("selectedData",scope.onDisplaySelectedItems),scope.$watchCollection("list",scope.onSelectListEds),scope.$watchCollection("quickSearchParams.param",scope.quickSearchHandler),scope.$watchCollection("disabledIds",function(){console.log("disabledIds "+scope.disabledIds)})}}}]),angular.module("konga").directive("numberInput",["configurationManager",function(configurationManager){return{templateUrl:"/konga/views/number-input.html",restrict:"E",link:function(scope,element,attrs){var stepConf=configurationManager.get(util.constants.NUMBER_CONF_STEP);void 0===stepConf&&(stepConf=1),scope.stepConf=stepConf}}}]),angular.module("konga").directive("optionInput",function(){return{template:"<div></div>",restrict:"E",link:function(scope,element,attrs){element.text("this is the optionInput directive")}}}),angular.module("konga").directive("priceInput",["$filter","$timeout",function($filter,$timeout){return{templateUrl:"views/price-input.html",restrict:"E",link:function(scope,element,attrs){function init(first){var configuration=scope.property.fieldType.configuration[0],currency=$filter("filter")(configuration,{key:"CURRENCY"},!0)[0],configurationSource=$filter("filter")(configuration,{key:"CURRENCY_SOURCE"},!0)[0];if(configurationSource)switch(configurationSource.value){case"translate":scope.currency=$filter("translate")(currency.value);break;case"entity":for(var unitSplit=currency.value.split("."),source=scope.entity,i=0;i<unitSplit.length&&source;i++)source=source[unitSplit[i]];scope.currency=source,first&&scope.$watch("entity."+currency.value,function(){init()});break;case"none":scope.showCurrency=!1,scope.currency="N/A";break;default:scope.currency=currency.value}else scope.currency=currency.value}scope.currency="",scope.showCurrency=!0,scope.inner={text:""},init(!0),scope.$watch("value.text",function(newValue,oldValue){scope.formatInput(!0)}),scope.formatInput=function(inverse,validate){validate&&scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:"price-formatting",valid:!1});var value=null;inverse?(value=$filter("priceRenderer")(scope.value.text,scope.property),scope.inner.text=value):(scope.inner.timeout&&$timeout.cancel(scope.inner.timeout),scope.inner.timeout=$timeout(function(){var input=scope.inner.text?scope.inner.text.replace(",",".").replace(/\s/g,""):scope.inner.text;scope.value.text=input?parseFloat(input):null,scope.formatInput(!0),scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:"price-formatting",valid:!0})},1500))}}}}]),angular.module("konga").directive("quantityInput",["$filter",function($filter){return{templateUrl:"views/quantity-input.html",restrict:"E",link:function(scope,element,attrs){function init(first){var configuration=scope.property.fieldType.configuration[0],configurationUnit=$filter("filter")(configuration,{key:"QUANTITY_UNIT"},!0)[0],configurationUnitSource=$filter("filter")(configuration,{key:"QUANTITY_UNIT_SOURCE"},!0)[0],configurationDecimal=$filter("filter")(configuration,{key:"QUANTITY_DECIMAL"},!0)[0],configurationDecimalSource=$filter("filter")(configuration,{key:"QUANTITY_DECIMAL_SOURCE"},!0)[0];if(configurationUnit){var unit=configurationUnit.value,source=configurationUnitSource?configurationUnitSource.value:null;switch(source){case"translate":scope.unit=$filter("translate")(unit);break;case"entity":for(var unitSplit=unit.split("."),source=scope.entity,i=0;i<unitSplit.length&&source;i++)source=source[unitSplit[i]];first&&scope.$watch("entity."+unit,function(){init()}),scope.unit=source;break;default:scope.unit=unit}}if(configurationDecimal){var decimal=configurationDecimal.value,source=configurationDecimalSource?configurationDecimalSource.value:null;switch(source){case"plain":scope.decimal=parseInt(decimal);break;case"entity":for(var decimalSplit=decimal.split("."),source=scope.entity,i=0;i<decimalSplit.length&&source;i++)source=source[decimalSplit[i]];first&&scope.$watch("entity."+decimal,function(){init()}),scope.decimal=source;break;default:scope.decimal=decimal}}for(var i=0;i<scope.decimal;i++)scope.step/=10}scope.unit="u.",scope.decimal=0,scope.step=1,scope.entity.$resolved!==!1?init(!0):scope.$watch("entity.$resolved",function(){scope.entity.$resolved&&init(!0)})}}}]),angular.module("konga").directive("rawInput",["$filter","$modal","$timeout","common","api","$rootScope","configurationManager","standardApi","permissionManager","util","mapper",function($filter,$modal,$timeout,common,api,$rootScope,configurationManager,standardApi,permissionManager,util,mapper){return{restrict:"E",replace:!0,scope:{property:"=",vertical:"=",disabled:"=",setValues:"&",operations:"=",ngRequired:"=",entity:"=",rootEntity:"=?",metadata:"=",rootMetadata:"=?",updateEntity:"=onUpdate",changeEntity:"=onChange",mode:"@",creating:"=",parentField:"=",style:"=?",index:"=?"},link:function(scope,element,attrs){function setupCascade(enabled){scope.cascadeEnabled=enabled}function setupPropagation(enabled){scope.propagateEnabled=enabled}function setupWatchers(enabled){scope.watchersEnabled=enabled}var resolveWatcher=null,valueWatcher=null,initactive=!0,initinactive=!1;scope.globalValidation=!0,scope.cascadeEnabled=!0,scope.propagateEnabled=!0,scope.watchersEnabled=!0,scope.rootMetadata||(scope.rootMetadata=scope.metadata),scope.rootEntity||(scope.rootEntity=scope.entity);var fieldConfig=scope.config={hidden:!1,init:!0,showHint:!0};scope.value={text:"",list:[],entity:{},date:{startDate:"",endDate:"",comparator:util.constants.DATE_COMPARATOR_EQUALS},range:{from:"",to:"",comparator:util.constants.NUMBER_COMPARATOR_BETWEEN},fields:[],files:[]};scope.fieldLabel=scope.property.label;var configurationSource=[],sourceField=scope.parentField?scope.parentField:scope.property;switch(scope.mode){case util.constants.SCOPE_SEARCH:configurationSource=sourceField.searchable.configuration;break;case util.constants.SCOPE_UPDATE:configurationSource=sourceField.showInUpdate.configuration}var shortLabelConf=$filter("filter")(configurationSource,{key:util.constants.USE_SHORT_LABEL});shortLabelConf&&shortLabelConf.length&&"true"===shortLabelConf[0].value&&(scope.fieldLabel=scope.property.shortLabel);var hintKey=scope.mode===util.constants.SCOPE_SEARCH?util.constants.SHOW_HINT_SEARCH:util.constants.SHOW_HINT_UPDATE,hintConf=configurationManager.get(hintKey,scope.property);void 0!==hintConf&&(fieldConfig.showHint=hintConf),scope.readonly=!1;var readonlyConf=$filter("filter")(configurationSource,{key:util.constants.READ_ONLY,value:"true"},!0);readonlyConf&&readonlyConf.length&&(scope.readonly=!0),scope.label="";var related=null!=scope.parentField,entityLabel=null,entityLabelPlaceholder=null;if(related){var relatedMetadata=util.getMetadata(scope.property.owner);entityLabel=$filter("translate")(relatedMetadata.label),entityLabelPlaceholder=relatedMetadata.label}else entityLabel=$filter("translate")(scope.metadata.label),entityLabelPlaceholder=scope.metadata.label;if(scope.extra={label:entityLabel,labelPlaceholder:entityLabelPlaceholder},scope.update=function(init){var value="";if(this.entity&&this.entity.$resolved!==!1){var value;if(value=this.mode===util.constants.SCOPE_UPDATE?$filter("mapField")(scope.entity,scope.property):scope.entity[scope.property.name],null==value){var parent=scope.parentField;if(parent){parent.apiName;value=scope.entity[scope.property.apiName]}}var complexProperty=null,complexEntity=scope.entity;if(scope.property.isSelf&&(complexEntity=scope.rootEntity),scope.property.type.type===util.constants.FIELD_COMPLEX?complexProperty=scope.property:scope.parentField&&scope.parentField.type.type===util.constants.FIELD_COMPLEX&&(complexProperty=scope.parentField),complexProperty){var related=complexProperty.type.complexType,realMetadata=common.getMetadata(related);if(this.value.metadata=realMetadata,scope.mode===util.constants.SCOPE_UPDATE){var realEntity;if(scope.parentField&&scope.parentField.multiplicity!==util.constants.MULTIPLICITY_ONE){realEntity=[];for(var i=0;i<complexEntity.length;i++)realEntity.push($filter("mapField")(complexEntity[i],scope.property))}else realEntity=$filter("mapField")(complexEntity,scope.property);try{scope.setLabel(realMetadata,realEntity)}catch(e){}scope.property.isExtended&&(scope.value.extended=scope.property.labelExtended,scope.value.isExtended=scope.property.isExtended),scope.value.entity=realEntity;var entityCode=util.getEntityCode(realMetadata,realEntity);null!==entityCode?scope.value.text=entityCode:scope.value.text="",$timeout(function(){if(scope.property.derived){var source=scope.parentField,configuration=source.showInUpdate.configuration,listenerName=scope.parentField.owner+"_"+scope.parentField.name,cascadeConfiguration=$filter("filter")(configuration,{key:util.constants.CASCADE_UPDATE});cascadeConfiguration.length&&scope.$emit("reset_cascade_"+listenerName,{reset:!1,source:scope.property,configuration:cascadeConfiguration,query:scope.value.text})}},50)}var nestFields=null;if(scope.mode===util.constants.SCOPE_SEARCH&&scope.property.searchable.fields&&scope.property.searchable.fields.length?nestFields=scope.property.searchable.fields:scope.mode===util.constants.SCOPE_UPDATE&&scope.property.showInUpdate.fields.length&&(nestFields=scope.property.showInUpdate.fields),nestFields&&init)for(var allFields=util.getEntityFields(realMetadata),selectedFields=$filter("selectedFields")(allFields,nestFields,scope.property),i=0;i<selectedFields.length;i++)scope.value.fields.push(selectedFields[i]);scope.mode===util.constants.SCOPE_SEARCH&&(scope.value.text=value)}switch(scope.property.type.type){case util.constants.FIELD_COMPLEX:break;case util.constants.FIELD_BOOLEAN:scope.mode===util.constants.SCOPE_SEARCH?(scope.value.text=value,""===scope.value.text||null===scope.value.text?(scope.value.active=!0,scope.value.inactive=!0):(scope.value.active=!!scope.value.text,scope.value.inactive=!scope.value.text)):scope.value.text=!!value;break;case util.constants.FIELD_DATE:scope.mode===util.constants.SCOPE_UPDATE?(scope.value.text=value,scope.property.fieldType.update==util.constants.FIELD_DATE&&(scope.value.text=$filter("date")(value,"yyyy-MM-dd"))):scope.mode===util.constants.SCOPE_SEARCH&&(scope.value.date=value);break;default:if(scope.property.type.type===util.constants.FIELD_NUMBER&&""!=value&&null!=value?scope.value.text=Number(value):scope.value.text=value,scope.property.type.list){scope.value.list=angular.copy(scope.property.type.list);var multi=null;multi=scope.mode===util.constants.SCOPE_SEARCH?fieldToMatch.searchConf.multiplicity:fieldToMatch.multiplicity,multi===util.constants.MULTIPLICITY_ONE&&scope.value.list.splice(0,0,{key:null,value:"combobox.placeholder"})}void 0==value&&void 0!=scope.property.defaults&&scope.creating&&(scope.value.text=scope.property.defaults)}}else this.entity&&this.entity.$resolved===!1&&(resolveWatcher=scope.$watch("entity.$resolved",function(){scope.entity.$resolved!==!1&&(resolveWatcher(),scope.update(!0))}));init&&(this.entity&&this.entity.$resolved!==!1||scope.creating)&&(scope.$watch("value.text",function(newValue,oldValue){scope.watchersEnabled&&newValue!==oldValue&&(scope.fieldValidation(),$timeout(valueWatcher,50))}),scope.value.entity&&scope.value.entity instanceof Array?scope.$watchCollection("value.entity",function(newValue,oldValue){angular.equals(newValue,oldValue)||(scope.fieldValidation(),$timeout(valueWatcher,50))},!0):scope.property.type.type===util.constants.FIELD_COMPLEX&&scope.$watch("value.entity",function(newValue,oldValue){angular.equals(newValue,oldValue)||(scope.fieldValidation(),$timeout(valueWatcher,50))},!0),scope.mode===util.constants.SCOPE_SEARCH&&scope.property.type.type==util.constants.FIELD_BOOLEAN&&(scope.$watch("value.active",valueWatcher),scope.$watch("value.inactive",valueWatcher)),scope.mode===util.constants.SCOPE_SEARCH&&scope.property.type.type==util.constants.FIELD_DATE&&(scope.$watch("value.date.startDate",valueWatcher),scope.$watch("value.date.endDate",valueWatcher),scope.$watch("value.date.comparator",valueWatcher)),scope.mode===util.constants.SCOPE_SEARCH&&scope.property.type.type==util.constants.FIELD_NUMBER&&scope.property.searchConf.policy===util.constants.VALIDATOR_RANGE&&(scope.$watch("value.range.from",valueWatcher),scope.$watch("value.range.to",valueWatcher),scope.$watch("value.range.comparator",valueWatcher)),scope.property.type.type==util.constants.FIELD_FILE&&scope.$watchCollection("value.files",valueWatcher),$timeout(function(){$rootScope.$broadcast("field-updated",{field:scope.property,value:scope.value,init:!0})},50))},scope.reset=function(){if(scope.property.fieldType.search===util.constants.FIELD_BOOLEAN)scope.value.active="true"===scope.property.defaults,scope.value.inactive="true"!==scope.property.defaults;else if(scope.property.fieldType.search===util.constants.FIELD_DATE)scope.value.date.comparator=util.constants.DATE_COMPARATOR_EQUALS,scope.value.date.startDate=0,scope.value.date.endDate=0;else if(scope.property.searchConf.policy===util.constants.VALIDATOR_RANGE)scope.value.range.comparator=util.constants.NUMBER_COMPARATOR_BETWEEN,scope.value.range.from="",scope.value.range.to="";else if(scope.property.fieldType[scope.mode]!==util.constants.FIELD_COMPLEX)if(scope.value.text=null==scope.property.defaults?"":scope.property.defaults,scope.property.multiplicity===util.constants.MULTIPLICITY_MANY){
var length=scope.value.entity.length;scope.value.entity.splice(0,length)}else scope.value.entity={};scope.label=""},scope.disableField=function(mode,field){var editable=field.editable,isId=field.isId;if(mode===util.constants.SCOPE_SEARCH)return!1;if(scope.property.derived){var configuration=scope.parentField.showInUpdate.configuration,matchingConfiguration=$filter("filter")(configuration,{key:util.constants.DISABLE_COMPLEX_FIELD,value:scope.property.apiPath},!0);if(matchingConfiguration.length)return!0}var isEditable=null!==editable.value,isAllowed=null;isEditable&&(isAllowed=permissionManager.isAllowed(editable.value));var bEditable=!isEditable||!isAllowed||isId&&!scope.creating;return bEditable},scope.showRemove=function(field){return null!==scope.value.text&&""!==scope.value.text&&(scope.mode===util.constants.SCOPE_SEARCH||!scope.disableField(scope.mode,scope.property))},scope.disableSelect=function(field){return"object"==typeof field.singleSelectCustom&&field.singleSelectCustom.disableSelect?!0:scope.disableField(scope.mode,scope.property)},scope.disableSelectInput=function(mode,field){var editable=field.editable;return mode===util.constants.SCOPE_UPDATE&&field.fieldType.update===util.constants.FIELD_SELECT?field.disabledSelect?!0:"true"===editable.value?!1:!0:!1},scope.removeField=function(field){scope.value.text=null,scope.value.list=[],scope.value.entity=null,scope.value.date.startDate="",scope.value.date.endDate="",scope.value.date.comparator=util.constants.DATE_COMPARATOR_EQUALS,scope.label="","object"==typeof field.singleSelectCustom&&(field.singleSelectCustom.deleteField=!1,field.singleSelectCustom.updateOtherFields=!0)},scope.validation={pattern:function(){if(scope.mode===util.constants.SCOPE_SEARCH)return".*";if(scope.property.validation.validators&&scope.property.validation.validators.length>0&&"REGEXP"==scope.property.validation.validators[0].type){var regexp=scope.property.validation.validators[0].value;return regexp}var regexp=".*";return regexp},forbiddenCharacters:function(){return["/","\\"]},required:function(){return scope.mode===util.constants.SCOPE_SEARCH?!1:scope.property.validation.required},minlength:function(){if(scope.mode===util.constants.SCOPE_SEARCH)return 0;var minLength=scope.property.validation.minLength;return null!==minLength?minLength:0},maxlength:function(){if(scope.mode===util.constants.SCOPE_SEARCH)return 524288;var maxLength=scope.property.validation.maxLength;return maxLength?524288:maxLength},minvalue:function(){var minLength=scope.property.validation.minLength;return null!==minLength?minLength:Number.MIN_SAFE_INTEGER},maxvalue:function(){var maxLength=scope.property.validation.maxLength;return null!==maxLength?maxLength:Number.MAX_SAFE_INTEGER},valid_required:function(){if(scope.mode===util.constants.SCOPE_SEARCH)return!0;switch(scope.property.type.type){case util.constants.FIELD_STRING:return scope.validation.required()?scope.value.text&&scope.value.text.length>0:!0;case util.constants.FIELD_COMPLEX:var relatedMetadata=util.getMetadata(scope.property.type.complexType),idField=util.getEntityId(relatedMetadata,null,!0);return scope.validation.required()?scope.value.entity&&void 0!==scope.value.entity[idField]:!0;case util.constants.FIELD_FILE:return scope.validation.required()?scope.value.files.length>0:!0}return null!==scope.value.text&&void 0!==scope.value.text},valid_pattern:function(){if(!scope.value.text||scope.property.type.type!==util.constants.FIELD_STRING)return!0;if(!scope.value.text.match)return!0;for(var parts=scope.value.text.split("\n"),i=0;i<parts.length;i++){var matches=parts[i].match(scope.validation.pattern());if(!matches||!matches.length||matches[0]!=parts[i])return!1}return!0},valid_minlength:function(){if(scope.mode===util.constants.SCOPE_SEARCH)return!0;var minLength=scope.minLength=scope.property.validation.minLength;return scope.property.type.type===util.constants.FIELD_COMPLEX?minLength?scope.value.entity.length>=minLength:!0:minLength?scope.value.text.length>minLength:!0},valid_maxlength:function(){if(scope.mode===util.constants.SCOPE_SEARCH)return!0;var maxLength=scope.property.validation.maxLength;return maxLength?scope.value.text.length<maxLength:!0}},scope.templating={inputSize:"col-md-8",fieldSize:"col-md-6",labelStyle:"col-md-12",labelWeight:"font-normal",labelDecoration:"",validationStyle:"col-md-12",adjusted:!1},scope.classFormInput=-1===[util.constants.FIELD_PICK_LIST,util.constants.FIELD_TABLE].indexOf(scope.property.fieldType[scope.mode])?"form-input-content":"",scope.displayMode=-1===[util.constants.FIELD_PICK_LIST,util.constants.FIELD_TABLE].indexOf(scope.property.fieldType[scope.mode])?"":"pickListDispBlock padding-cero",scope.mode===util.constants.SCOPE_UPDATE){switch(scope.property.fieldType.update){case util.constants.FIELD_SELECT:(scope.parentField||!scope.property.isKey)&&(scope.templating.inputSize="col-md-12",scope.templating.fieldSize="col-md-8",scope.templating.adjusted=!0);break;case util.constants.FIELD_DATE:case util.constants.FIELD_NUMBER:case util.constants.FIELD_COMBOBOX:case util.constants.FIELD_PRICE:scope.templating.inputSize="col-md-6",scope.templating.fieldSize="col-md-4",scope.templating.adjusted=!0;break;case util.constants.FIELD_COMPLEX:scope.templating.inputSize="",scope.templating.fieldSize="col-md-12 no-padding",scope.templating.labelWeight="font-bold",scope.templating.adjusted=!0;break;case util.constants.FIELD_PICK_LIST:case util.constants.FIELD_IMAGE:case util.constants.FIELD_TABLE:scope.templating.inputSize="col-md-12",scope.templating.fieldSize="col-md-12 no-padding",scope.templating.labelWeight="font-bold",scope.templating.labelDecoration="font-underline",scope.templating.adjusted=!0;break;case util.constants.FIELD_FILE:scope.templating.inputSize="col-md-12",scope.templating.fieldSize="col-md-8 no-padding",scope.templating.labelWeight="font-bold",scope.templating.labelDecoration="font-underline",scope.templating.adjusted=!0}!scope.templating.adjusted&&scope.property.validation.maxLength&&(scope.property.validation.maxLength<14?(scope.templating.inputSize="col-md-6",scope.templating.fieldSize="col-md-4"):scope.property.validation.maxLength>100&&(scope.templating.inputSize="col-md-12",scope.templating.fieldSize="col-md-8"))}else scope.mode===util.constants.SCOPE_SEARCH&&(scope.templating.inputSize="col-md-12",scope.templating.fieldSize="col-md-12",scope.property.fieldType.search===util.constants.FIELD_COMPLEX?(scope.templating.fieldSize="col-md-12 no-padding",scope.templating.labelWeight="font-bold"):(scope.property.fieldType.search===util.constants.FIELD_DATE||scope.property.fieldType.search===util.constants.FIELD_NUMBER&&scope.property.searchConf.policy===util.constants.VALIDATOR_RANGE)&&(scope.templating.labelWeight="font-bold"));if(scope.property.fieldType[scope.mode]!==util.constants.FIELD_COMPLEX)switch(scope.rootMetadata[scope.mode+"Style"]){case util.constants.FORM_STYLE_HORIZONTAL:scope.templating.inputSize="col-md-12",scope.templating.labelStyle="col-md-4 control-label",scope.templating.validationStyle="col-md-offset-4 col-md-8"}if(scope.style)for(var item in scope.style)scope.templating[item]=scope.style[item];valueWatcher=function(){fieldConfig.init=!1,initactive=scope.value.active,initinactive=scope.value.inactive,"null"===scope.value.text&&(scope.value.text=null);var forceNotCopy=!1;-1!==[util.constants.FIELD_FILE,util.constants.FIELD_TABLE].indexOf(scope.property.type.type)&&(forceNotCopy=!0);var configuration=$filter("filter")(scope.metadata.configuration,{key:"DONT_CREATE_COPY",value:scope.property.name},!0),sendValue=null;sendValue=forceNotCopy||configuration.length?scope.value:angular.copy(scope.value);var result=scope.updateEntity(scope.property,sendValue,scope.entity,scope.parentField,scope.rootEntity);if(scope.property.derived){var configuration=[],source=(scope.property.derivedPath,scope.parentField);switch(scope.mode){case util.constants.SCOPE_SEARCH:configuration=source.searchable.configuration;break;case util.constants.SCOPE_UPDATE:configuration=source.showInUpdate.configuration}var listenerName=scope.parentField.owner+"_"+scope.parentField.name,cascadeConfiguration=$filter("filter")(configuration,{key:util.constants.CASCADE_UPDATE});cascadeConfiguration.length&&scope.$emit("reset_cascade_"+listenerName,{source:scope.property,configuration:cascadeConfiguration,query:scope.value.text});var propagateConfiguration=$filter("filter")(configuration,{key:util.constants.PROPAGATE_UPDATE});propagateConfiguration.length&&scope.$emit("complex_update_"+listenerName,{source:scope.property,configuration:propagateConfiguration})}if(1==sendValue.isExtended&&(scope.value.extended=sendValue.extended),scope.value.isExtended=1==sendValue.isExtended,result&&scope.changeEntity){var sendResult=angular.copy(result);scope.changeEntity(scope.property,sendResult,scope.entity)}$rootScope.$broadcast("field-updated",{field:scope.property,value:scope.value})};var listenerName=scope.property.owner+"_"+scope.property.name;scope.$on("manually_change_"+listenerName,function(events,args){valueWatcher()}),scope.$on("update_"+listenerName,function(events,args){if(!args||!args.self||scope.property.isSelf)if(scope.property.fieldType[scope.mode]===util.constants.FIELD_COMPLEX){var innerFields=scope.value.fields,innerEntity=scope.entity[scope.property.name];scope.$broadcast("setup-cascade",{enabled:!1}),scope.$broadcast("setup-propagation",{enabled:!1}),scope.$broadcast("setup-watchers",{enabled:!1});for(var i=0;i<innerFields.length;i++){var innerField=innerFields[i],innerListenerName="update_"+innerField.owner+"_"+innerField.name;scope.$broadcast(innerListenerName,{newEntity:innerEntity})}scope.$broadcast("setup-cascade",{enabled:!0,delay:500}),scope.$broadcast("setup-propagation",{enabled:!0,delay:500}),scope.$broadcast("setup-watchers",{enabled:!0,delay:500})}else scope.parentField&&args.newEntity&&(scope.entity=args.newEntity),scope.update()}),scope.property.fieldType[scope.mode]!==util.constants.FIELD_COMPLEX||scope.property.isSelf||scope.$on("complex_update_"+listenerName,function(events,args){if(scope.propagateEnabled)for(var source=args.source,configuration=args.configuration,i=(args.query,0);i<configuration.length;i++){var currentConf=configuration[i].value,apiPath=source.isSelf?util.constants.SELF_FIELD:source.apiPath,index=currentConf.indexOf(apiPath+"->");if(-1!==index){for(var parsedConf=currentConf.split("->"),engaged=!1,f=0;f<parsedConf.length;f++)if(parsedConf[f]!==apiPath){if(engaged){var conf=parsedConf[f],self=!1;conf===util.constants.SELF_FIELD&&(conf=scope.property.name,self=!0);var cascadeField=$filter("filter")(scope.value.fields,{apiPath:conf},!0)[0],eventName="update_"+cascadeField.owner+"_"+cascadeField.name;scope.$broadcast(eventName,{source:source,self:self,newEntity:scope.entity[scope.property.name]})}}else engaged=!0,scope.$broadcast("setup-cascade",{enabled:!1}),scope.$broadcast("setup-watchers",{enabled:!1});engaged&&(scope.$broadcast("setup-cascade",{enabled:!0,delay:500}),scope.$broadcast("setup-watchers",{enabled:!0,delay:500}))}}}),scope.$on("cascade_update_"+listenerName,function(events,args){if(!args.self||scope.property.isSelf){var source=args.source,query=args.query;if(scope.reset(),scope.property.type.query){if(scope.property.type.query instanceof Array){var newQuery={};for(var param in scope.property.type.query)newQuery[param]=scope.property.type.query[param];scope.property.type.query=newQuery}}else scope.property.type.query={};scope.property.type.query[source.apiName]=query}}),scope.$on("setup-cascade",function(event,args){args.delay?$timeout(function(){setupCascade(args.enabled)},args.delay):setupCascade(args.enabled)}),scope.$on("setup-propagation",function(event,args){args.delay?$timeout(function(){setupPropagation(args.enabled)},args.delay):setupPropagation(args.enabled)}),scope.$on("setup-watchers",function(event,args){args.delay?$timeout(function(){setupWatchers(args.enabled)},args.delay):setupWatchers(args.enabled)}),scope.$on("reset_cascade_"+listenerName,function(events,args){if(scope.cascadeEnabled)for(var source=args.source,configuration=args.configuration,query=args.query,i=0;i<configuration.length;i++){var currentConf=configuration[i].value,index=currentConf.indexOf(source.apiPath+"->");if(-1!==index){for(var parsedConf=currentConf.split("->"),engaged=!1,f=0;f<parsedConf.length;f++)if(parsedConf[f]!==source.apiPath){if(engaged){var conf=parsedConf[f],self=!1;conf===util.constants.SELF_FIELD&&(conf=scope.property.name,self=!0);var cascadeField=$filter("filter")(scope.value.fields,{apiPath:conf},!0)[0],eventName="cascade_update_"+cascadeField.owner+"_"+cascadeField.name;scope.$broadcast(eventName,{source:source,query:query,self:self,reset:args.reset})}}else engaged=!0,scope.$broadcast("setup-propagation",{enabled:!1}),scope.$broadcast("setup-watchers",{enabled:!1});engaged&&(scope.$broadcast("setup-propagation",{enabled:!0,delay:500}),scope.$broadcast("setup-watchers",{enabled:!0,delay:500}))}}}),scope.$on("reset_"+listenerName,function(event,args){scope.reset()}),scope.$on("reset-form",function(event,args){scope.reset()}),scope.$on("locale-change",function(data){scope.extra.label=$filter("translate")(scope.extra.labelPlaceholder)}),scope.$on("field-updated",function(evt,data){if(scope.property.linked&&-1!==scope.property.linked.to.indexOf(data.field.name)){var action=scope.property.linked.via;scope.dispatchFieldAction(action,{source:data.field,value:data.value,init:!!data.init})}});var multiField=null,fieldToMatch=null;fieldToMatch=scope.parentField?scope.parentField:scope.property,multiField=scope.mode===util.constants.SCOPE_SEARCH?fieldToMatch.searchConf.multiplicity:fieldToMatch.multiplicity;var multi=multiField===util.constants.MULTIPLICITY_MANY;scope.multiple=multi;var selectTemplate=multi?"/konga/views/multi-select.html":"/konga/views/single-select.html",selectController=multi?"MultiSelectController":"SingleSelectController";"object"==typeof scope.property.singleSelectCustom&&""!==scope.property.singleSelectCustom.selectTemplate&&""!==scope.property.singleSelectCustom.selectController&&(selectTemplate=scope.property.singleSelectCustom.selectTemplate,selectController=scope.property.singleSelectCustom.selectController),scope.modal={temp:{}},scope.openMultiSelect=function(){var myScope=scope,modalInstance=$modal.open({templateUrl:selectTemplate,controller:selectController,size:"lg",resolve:{items:function(){return common.read("raw-input>"+myScope.property.name+" "+myScope.property.owner)},model:function(){return angular.copy(myScope.value)},field:function(){return angular.copy(myScope.property)},parentField:function(){return angular.copy(myScope.parentField)},entity:function(){return angular.copy(myScope.entity)},metadata:function(){return angular.copy(myScope.metadata)}}});modalInstance.result.then(function(newValue){myScope.value.text=newValue.text?newValue.text.join(","):"",myScope.value.ids=newValue.ids,myScope.value.entity=newValue.entity,myScope.setLabel(newValue.metadata,myScope.value.entity),"object"==typeof myScope.property.singleSelectCustom&&(0==newValue.ids.length&&(scope.value={text:null,list:[],entity:null,date:{startDate:"",endDate:"",comparator:util.constants.DATE_COMPARATOR_EQUALS}},scope.label="",myScope.property.singleSelectCustom.deleteField=!1),myScope.property.singleSelectCustom.updateOtherFields=!0)},function(){console.log("Operation canceled")})},scope.dispatchFieldAction=function(name,params){var overrideDefaults=scope.property.overrideDefaults,matchingActions=null;overrideDefaults.length&&(matchingActions=$filter("filter")(overrideDefaults,{overrides:name}));var actions=scope.property.actions;(!matchingActions||matchingActions&&!matchingActions.length)&&actions.length&&(matchingActions=$filter("filter")(actions,{name:name}));var actionParams={id:util.getEntityId(scope.metadata,scope.entity),entityType:scope.metadata.name,self:scope,item:scope.entity,field:scope.property,data:params};if(matchingActions&&matchingActions.length)$rootScope.operations.dispatchActionBatch(matchingActions,actionParams);else switch(name){case"add":case"open-select":scope.openMultiSelect();break;default:$rootScope.operations.dispatchAction({name:name},actionParams)}},scope.setLabel=function(metadata,entity){var name=metadata.name.charAt(0).toLowerCase()+metadata.name.substr(1);scope.isExtended=$filter("extended")(scope.metadata.fields,name),scope.label=util.getEntityLabel(metadata,entity)},scope.getOptionsList=function(){switch(scope.property.name){case util.constants.COMBO_NATURE_TIERS:return[{code:"Fournisseur",label:"Fournisseur"},{code:"Client",label:"Client"}]}};var watchers=null;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers}),scope.$on("force-validation",function(){scope.fieldValidation()}),scope.hideGlobalValidation=function(){scope.globalValidation=!1};var fieldType=scope.property.fieldType[scope.mode];if(scope.mode===util.constants.SCOPE_SEARCH&&fieldType==util.constants.FIELD_BOOLEAN){fieldType=util.constants.FIELD_CHECKBOX;var queryValue=scope.entity[scope.property.name];scope.value.text=queryValue}scope.mode===util.constants.SCOPE_SEARCH&&fieldType===util.constants.FIELD_DATE&&(fieldType=util.constants.FIELD_DATESEARCH),fieldType==util.constants.FIELD_PLAIN&&scope.property.validation.maxLength>255&&(fieldType=util.constants.FIELD_TEXTAREA),scope.value.fields.length&&(fieldType=util.constants.FIELD_COMPLEX);var inputSuffix="";if(scope.mode===util.constants.SCOPE_SEARCH){var validatorType=scope.property.searchConf.policy;validatorType===util.constants.VALIDATOR_RANGE&&(inputSuffix="-"+validatorType.toLowerCase())}var fieldTemplate=null;if(fieldType===util.constants.FIELD_TYPE_CUSTOM){var configuration=null;switch(scope.mode){case util.constants.SCOPE_SEARCH:configuration=source.searchable.configuration;break;case util.constants.SCOPE_UPDATE:configuration=source.showInUpdate.configuration}var confParams=$filter("filter")(configuration,{key:util.constants.CUSTOM_FIELD_TYPE});!confParams||!confParams.length;var conf=confParams[0].value;fieldTemplate=mapper[conf],fieldType||(fieldTemplate=conf)}else fieldTemplate="/konga/views/raw-"+fieldType.toLowerCase()+inputSuffix+"-input.html";scope.contentUrl=fieldTemplate,scope.datePicker={opened:!1},scope.toggleDatePicker=function(){scope.datePicker.opened=scope.datePicker.opened?!1:!0},scope.fieldValidation=function(){if(scope.mode===util.constants.SCOPE_UPDATE&&(scope.property.type.type===util.constants.FIELD_DATE||scope.property.type.type===util.constants.FIELD_DATETIME)&&scope.property.validation.validators&&scope.property.validation.validators.length>0){for(var classErrorName,hasError=!1,i=0;i<scope.property.validation.validators.length;i++){var typeValidator=scope.property.validation.validators[i].type;switch(typeValidator){case"DATE_GE":case"DATE_GT":case"DATE_LE":case"DATE_LT":var dateToCompare=scope.entity[scope.property.validation.validators[i].value];"string"==typeof dateToCompare&&(dateToCompare=new Date(dateToCompare).getTime());var value=scope.value.text;if(classErrorName="invalid-date",void 0==dateToCompare||0==dateToCompare)break;if(void 0!=value){var dateRef=value;if(scope.property.type.type===util.constants.FIELD_DATE&&value.length>0)var dateRef=new Date(value).getTime();"DATE_GE"==typeValidator&&0>dateRef-dateToCompare&&(hasError=!0),"DATE_GT"==typeValidator&&0>=dateRef-dateToCompare&&(hasError=!0),"DATE_LE"==typeValidator&&dateRef-dateToCompare>0&&(hasError=!0),"DATE_LT"==typeValidator&&dateRef-dateToCompare>=0&&(hasError=!0)}}}var realInput=element.find("input");hasError?(realInput.addClass(classErrorName),scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:typeValidator,valid:!1})):(realInput.removeClass(classErrorName),scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:typeValidator,valid:!0}))}if(scope.mode===util.constants.SCOPE_UPDATE&&scope.property.type.type===util.constants.FIELD_STRING){var validation=scope.property.validation,value=scope.value.text,length=value?value.length:0,realInput=element.find("input");validation.maxLength&&length>validation.maxLength?(realInput.addClass("invalid-max-length"),scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:"max-length",valid:!1})):(realInput.removeClass("invalid-max-length"),scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:"max-length",valid:!0})),validation.minLength&&length<validation.minLength?(realInput.addClass("invalid-min-length"),scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:"min-length",valid:!1})):(realInput.removeClass("invalid-min-length"),scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:"min-length",valid:!0}))}if(scope.property.fieldType.update==util.constants.FIELD_PICK_LIST){var validation=scope.property.validation,length=scope.entity.situations?scope.entity.situations.length:0,realInput=element.find("input");validation.minLength&&length<validation.minLength?scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:"min-length",valid:!1}):scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:"min-length",valid:!0})}},scope.aucun=null,scope.update(!0),scope.fieldId="raw-input-"+scope.property.name+"-"+scope.property.owner},templateUrl:"/konga/views/raw-input.html"}}]),angular.module("konga").directive("recursiveListItem",function(){return{templateUrl:"/konga/views/recursive-list-item.html",restrict:"E",replace:!0,scope:{item:"=",click:"=onClick",ngClass:"@"},link:function(scope,element,attrs){}}}),angular.module("konga").directive("recursiveList",function(){return{template:'<div ng-include="contentUrl"></div>',restrict:"E",replace:!0,scope:{list:"=",clickItem:"=onClickItem",itemClass:"@"},link:function(scope){scope.contentUrl="/konga/views/recursive-list.html"}}}),angular.module("konga").directive("resultTable",["util","mapper","$filter","$rootScope","permissionManager",function(util,mapper,$filter,$rootScope,permissionManager){return{templateUrl:"/konga/views/result-table.html",replace:!0,restrict:"E",scope:{entityMetadata:"=",entities:"=",updateEntity:"=onUpdate",submitSorting:"=onSorting"},controller:function($scope,$filter,$rootScope,permissionManager){function divideComplexField(field){for(var relatedMetadata=util.getMetadata(field.type.complexType),relatedFields=util.getEntityFields(relatedMetadata),nestFields=field.showInResults.fields,selectedFields=$filter("selectedFields")(relatedFields,nestFields,field),fi=0;fi<selectedFields.length;fi++)selectedFields[fi].fieldType.results===util.constants.FIELD_COMPLEX?divideComplexField(selectedFields[fi]):(selectedFields[fi].derivedPath.splice(0,0,field),selectedFields[fi].derivedSource=field,$scope.fields.push(selectedFields[fi]))}$scope.fields=[],$scope.categories=[],$scope.init=function(){$scope.categories=util.getEntityCategories($scope.entityMetadata,1);var formType=$scope.entityMetadata.resultsType;if(formType===util.constants.CUSTOM_FORM){var configuration=$filter("filter")($scope.entityMetadata.configuration,{key:util.constants.RESULTS_CUSTOM_VIEW});!configuration.length;var contentUrl=mapper[configuration[0].value];contentUrl||(contentUrl=configuration[0].value),$scope.contentUrl=contentUrl}else switch($scope.contentUrl="/konga/views/"+formType.toLowerCase()+"-result-table.html",formType){case util.constants.CATEGORIZED_CASCADE_FORM:var configuration=$filter("filter")($scope.entityMetadata.configuration,{key:util.constants.RESULTS_USE_CATEGORY},!0);$scope.categories=[];for(var i=0;i<configuration.length;i++){var cat=configuration[i].value,hideHeaderConf=$filter("filter")($scope.entityMetadata.configuration,{key:util.constants.HIDE_CATEGORY_HEADER,value:cat},!0),showHeader=!0;hideHeaderConf.length&&(showHeader=!1);var category={name:cat,showHeader:showHeader};$scope.categories.push(category)}}for(var allFields=$filter("orderBy")(util.getEntityFields($scope.entityMetadata),"+priority.results"),filteredFields=$filter("resultParams")(allFields,$scope.entityMetadata),f=0;f<filteredFields.length;f++){var field=filteredFields[f];field.type.type===util.constants.FIELD_COMPLEX&&field.fieldType.results===util.constants.FIELD_COMPLEX&&field.showInResults.fields.length?divideComplexField(field):$scope.fields.push(field)}$scope.categoryFields={},$scope.sortedFieldsByCategory=[];for(var i=0;i<$scope.categories.length;i++){var category=$scope.categories[i].name,matchingFields=$filter("filter")($scope.fields,{categories:category},!0);$scope.sortedFieldsByCategory=$scope.sortedFieldsByCategory.concat(matchingFields),$scope.categoryFields[category]=matchingFields}var isEditable=null!==$scope.entityMetadata.editable,isAllowed=null;isEditable&&(isAllowed=permissionManager.isAllowed($scope.entityMetadata.editable));var bEditable=!isEditable||!isAllowed;$scope.isEditable=!bEditable};var entityLabel=$filter("translate")($scope.entityMetadata.entityLabel);$scope.extra={label:entityLabel,labelPlaceholder:$scope.entityMetadata.entityLabel},$scope.resultClick=function(metadata,entity,index){var actions=metadata.overrideDefaults,matchingActions=null;actions.length&&(matchingActions=$filter("filter")(actions,{overrides:"result-click"})),matchingActions&&matchingActions.length?$rootScope.operations.dispatchActionBatch(matchingActions,{id:util.getEntityId(metadata,entity),entityType:metadata.name,self:$scope,item:entity,index:index}):$scope.isEditable&&$scope.updateEntity(metadata,entity)},$scope.showSorting=function(sorting,isDESC){return""!==sorting?isDESC?"asc"===sorting?"dropup":"":"caret":""},$scope.sorting=function(field,type){var matchingActions=$filter("filter")(scope.entityMetadata.overrideDefaults,{overrides:"sort"},!0);if(matchingActions&&matchingActions.length)for(var i=0;i<matchingActions.length;i++)scope.dispatch(matchingActions[i],{data:{field:field,type:type}});else scope.dispatch({name:"sort"},{data:{field:field,type:type}})};var watchers=null;$scope.$on("suspend",function(){watchers=$scope.$$watchers,$scope.$$watchers=[]}),$scope.$on("resume",function(){$scope.$$watchers=watchers})},link:function(scope,element,attrs){}}}]),angular.module("konga").directive("scrollWatcher",function(){return{restrict:"A",link:function(scope,element){angular.element(element).bind("scroll",function(){var height=element[0].scrollHeight-element.height(),scroll=element.scrollTop(),msg={absolute:scroll,height:height,relative:scroll/height};scope.$emit(scope.id+"-scroll-watcher",msg)}),scope.$on("set-scroll",function(event,data){if(data.relative){var height=element[0].scrollHeight-element.height(),newScroll=height*data.relative;element.scrollTop(newScroll)}})}}}),angular.module("konga").directive("searchPane",["util","$filter","$modal","$timeout","scaffold",function(util,$filter,$modal,$timeout,scaffold){return{templateUrl:"/konga/views/search-pane.html",replace:!0,restrict:"E",scope:{entityMetadata:"=",query:"=",submit:"=onSubmit",dispatch:"=onDispatch"},controller:function($scope){$scope.fields=[],$scope.categories=[],$scope.init=function(){$scope.fields=util.getEntityFields($scope.entityMetadata),$scope.categories=util.getEntityCategories($scope.entityMetadata,1);var formType=$scope.entityMetadata.searchType;if(formType===util.constants.CUSTOM_FORM){var configuration=$filter("filter")($scope.entityMetadata.configuration,{key:util.constants.SEARCH_CUSTOM_VIEW});!configuration.length,$scope.contentUrl=mapper[configuration[0].value]}else switch($scope.contentUrl="/konga/views/"+formType.toLowerCase()+"-search-pane.html",formType){case util.constants.CATEGORIZED_CASCADE_FORM:var configuration=$filter("filter")($scope.entityMetadata.configuration,{key:util.constants.SEARCH_USE_CATEGORY},!0);$scope.categories=[];for(var i=0;i<configuration.length;i++){var cat=configuration[i].value;$scope.categories.push(cat)}}},$scope.resetQuery=function(){var newQuery=scaffold.newQuery($scope.entityMetadata);for(var param in $scope.query)$scope.query[param]=newQuery[param]},$scope.delayedSubmit=function(){$timeout(function(){$scope.operations.submit()},100)};var watchers=null;$scope.$on("suspend",function(){watchers=$scope.$$watchers,$scope.$$watchers=[]}),$scope.$on("resume",function(){$scope.$$watchers=watchers})},link:function(scope){scope.operations={updateField:function(property,value,query,parent){var fieldName=property.name;parent&&(fieldName=property.apiName),property.fieldType.search===util.constants.FIELD_BOOLEAN&&(value.active==value.inactive?value.text="":value.text=value.active),property.fieldType.search===util.constants.FIELD_DATE?(value.date.startDate=""==value.date.startDate?0:value.date.startDate,value.date.endDate=""==value.date.endDate?0:value.date.endDate,value.text=value.date):property.searchConf.policy===util.constants.VALIDATOR_RANGE&&""!==value.range.from&&(value.text=value.range);var ret=value.text;return query[fieldName]=ret,ret},clear:function(){var matchingActions=$filter("filter")(scope.entityMetadata.overrideDefaults,{overrides:"clear"},!0);if(matchingActions&&matchingActions.length)for(var i=0;i<matchingActions.length;i++)scope.dispatch(matchingActions[i]);else scope.dispatch({name:"clear"})},submit:function(){var matchingActions=$filter("filter")(scope.entityMetadata.overrideDefaults,{overrides:"search"},!0);if(matchingActions&&matchingActions.length)for(var i=0;i<matchingActions.length;i++)scope.dispatch(matchingActions[i]);else scope.dispatch({name:"search"})}}}}}]),angular.module("konga").directive("selectInput",["api","$filter","util",function(api,$filter,util){return{templateUrl:"/konga/views/select-input.html",restrict:"E",replace:!0,link:function(scope,element,attrs){scope.textinput=scope.value.text;var entityType=scope.property.type.complexType,localEndpoint=api.getLocalEndpoint(entityType),metadata=util.getMetadata(entityType),apiPath=metadata.apiPath,quickSearch=$filter("quickSearch")(metadata)[0],paramName=quickSearch.metadata?$filter("fieldApiName")(quickSearch.metadata.name,quickSearch.metadata):null,fields=util.getEntityFields(metadata),codeField=$filter("filter")(fields,{isKey:!0},!0)[0],labelField=scope.labelField=$filter("filter")(fields,{isLabel:!0},!0)[0],active=!1;scope.getElements=function(value){var query=$filter("queryParser")(this.property,this.entity);return query.path=apiPath,query[paramName]=value,active=!0,localEndpoint.search(query).$promise.then(function(data){return data.map(function(item){var code=$filter("mapField")(item,codeField),label=$filter("mapField")(item,labelField),ret={label:code+" - "+label,real:item};return ret})})},scope.formatInput=function(value,model,label){var item=value.real,text="";if($filter("fieldMultiplicity")(this.property,this.mode)===util.constants.MULTIPLICITY_MANY){this.value.entity&&this.value.entity instanceof Array||(this.value.entity=[]);var existing=$filter("filter")(this.value.entity,{id:item.id},!0);existing.length||this.value.entity.push(item),text=this.value.entity.map(function(item){return item.id}).join(","),this.textinput=""}else this.value.entity=item,text=item.id,this.textinput=$filter("mapField")(item,labelField);this.value.text=text},scope.writeValue=function(){};var multiplicity="search"===scope.mode?scope.property.searchConf.multiplicity:scope.property.multiplicity;multiplicity===util.constants.MULTIPLICITY_ONE&&scope.$watch("value.text",function(){scope.textinput=scope.value.text})}}}]),angular.module("konga").directive("tabContent",function(){return{require:"^verticalTabs",restrict:"E",transclude:!0,replace:!0,scope:{title:"@",id:"=tabId"},link:function(scope,element,attrs,tabsCtrl){tabsCtrl.addTabContent(scope)},templateUrl:"/konga/views/vertical-tabs-element.tp.html"}}),angular.module("konga").directive("tableCell",["util","$filter","configurationManager","mapper",function(util,$filter,configurationManager,mapper){
return{templateUrl:"/konga/views/table-cell.html",restrict:"E",replace:!0,scope:{entity:"=",field:"="},link:function(scope,element){function setupValue(){var fieldEntity=scope.entity,mapped=null;switch(scope.field.derived&&scope.field.derivedSource&&(fieldEntity=$filter("mapField")(scope.entity,scope.field.derivedSource),scope.field.isSelf&&(mapped=fieldEntity)),mapped||(mapped=$filter("mapField")(fieldEntity,scope.field)),scope.field.fieldType.results){case util.constants.FIELD_DATE:scope.content=0!==mapped?$filter("date")(mapped,"dd/MM/yyyy"):"";break;case util.constants.FIELD_DATETIME:scope.content=0!==mapped?$filter("date")(mapped,"dd/MM/yyyy HH:mm:ss"):"";break;case util.constants.FIELD_BOOLEAN:var content=$filter("activeInactive")(mapped,scope.field);scope.content=$filter("translate")(content);break;case util.constants.FIELD_IMAGE:scope.type="image",scope.content=mapped,scope.image={width:30,height:30};var conf=scope.field.fieldType.configuration[0],width=$filter("filter")(conf,{key:"IMAGE_WIDTH"},!0)[0],height=$filter("filter")(conf,{key:"IMAGE_HEIGHT"},!0)[0];width&&(scope.image.width=width.value),height&&(scope.image.height=height.value);break;case util.constants.FIELD_PRICE:var configuration=scope.field.fieldType.configuration[0],currency=$filter("filter")(configuration,{key:"CURRENCY"},!0)[0];scope.suffix=currency.value,scope.styles.push("text-right"),scope.content=$filter("number")(mapped,2);break;case util.constants.FIELD_NUMBER:scope.styles.push("text-right"),scope.content=mapped;break;case util.constants.FIELD_CSS:scope.type="styling",scope.styles.push("text-center"),scope.content=mapped,useList=!1;break;case util.constants.FIELD_PLAIN_FILTERED:scope.type="plain-filtered",scope.content=mapped;var configuration=scope.field.fieldType.configuration[0],filter=$filter("filter")(configuration,{key:util.constants.TABLE_CELL_FILTER},!0)[0];scope.filter=filter.value;break;case util.constants.FIELD_CUSTOM:scope.type="custom",scope.content=mapped;var customConf=configurationManager.get(util.constants.CUSTOM_FIELD_TYPE,scope.field,util.constants.SCOPE_RESULTS);scope.custom=mapper[customConf],scope.custom||(scope.custom=customConf);break;case util.constants.FIELD_PLAIN:default:if(scope.field.type.type===util.constants.FIELD_COMPLEX)scope.content=$filter("tableRendererComplex")(mapped,scope.field);else try{scope.content=$filter("translate")(mapped)}catch(e){scope.content=mapped}}if(scope.field.type.list&&useList){var list=scope.field.type.list,listMatch=$filter("filter")(list,{key:scope.content+""},!0);if(listMatch.length){var item=listMatch[0],content=item.value;scope.content=$filter("translate")(content)}}(null===scope.content||void 0===scope.content)&&(scope.content="")}scope.content="",scope.type="text",scope.styles=[],scope.preffix="",scope.suffix="",scope.custom=null;var entityWatcher,useList=!0;entityWatcher=scope.$watch("entity",function(){setupValue(),scope.updateContent(),entityWatcher()},!0);var watchers=null;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers});angular.element(element);scope.updateContent=function(){element.children(".table-cell-content").text(scope.preffix+" "+scope.content+" "+scope.suffix)}}}}]),angular.module("konga").directive("tableHeader",["util","$filter","$rootScope",function(util,$filter,$rootScope){return{templateUrl:"/konga/views/table-header.html",restrict:"E",replace:!0,scope:{field:"=",selectSortingField:"=sorting",showSorting:"=",mode:"@"},link:function(scope,element,attrs){scope.label=scope.field.label,scope.owner="";var sourceField=scope.field;if(scope.sort=null,scope.styles=[],-1!==["CSS","NUMBER","PRICE"].indexOf(scope.field.fieldType.results)&&scope.styles.push("text-center"),scope.field.owner)for(var i=0;i<$rootScope.metadata.entities.length;i++)if(scope.field.owner==$rootScope.metadata.entities[i].name){null!=$rootScope.metadata.entities[i].label?scope.owner=$filter("translate")($rootScope.metadata.entities[i].label):scope.owner=scope.field.owner;break}scope.field.derived&&(sourceField=scope.field.derivedPath[0]),!scope.field.derived&&scope.field.isKey&&(scope.sort="asc");var configurationSource=[];switch(scope.mode){case util.constants.SCOPE_RESULTS:configurationSource=sourceField.showInResults.configuration;break;case util.constants.SCOPE_UPDATE:configurationSource=scope.field.showInUpdate.configuration}var configuration=$filter("filter")(configurationSource,{key:util.constants.USE_SHORT_LABEL});configuration&&configuration.length&&"true"===configuration[0].value&&(scope.label=scope.field.shortLabel),scope.sorting=function(type){scope.selectSortingField(scope.field,type)};var watchers=null;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers}),scope.$on("sorting",function(evt,args){var field=args.field,type=args.type;field===scope.field?scope.sort=type:scope.sort=null})}}}]),angular.module("konga").directive("tableInput",["$filter","$timeout","scaffold","util",function($filter,$timeout,scaffold,util){return{templateUrl:"/konga/views/table-input.html",restrict:"E",replace:!0,link:function(scope,element,attrs){function initLimits(first){var xAxisMinConfiguration=$filter("filter")(configurationSource,{key:util.constants.TABLE_CONF_X_AXIS_MIN})[0],yAxisMinConfiguration=$filter("filter")(configurationSource,{key:util.constants.TABLE_CONF_Y_AXIS_MIN})[0],xAxisMaxConfiguration=$filter("filter")(configurationSource,{key:util.constants.TABLE_CONF_X_AXIS_MAX})[0],yAxisMaxConfiguration=$filter("filter")(configurationSource,{key:util.constants.TABLE_CONF_Y_AXIS_MAX})[0],xAxisMinPropName=xAxisMinConfiguration.value.replace(/[\{\}]/g,""),yAxisMinPropName=yAxisMinConfiguration.value.replace(/[\{\}]/g,""),xAxisMaxPropName=xAxisMaxConfiguration.value.replace(/[\{\}]/g,""),yAxisMaxPropName=yAxisMaxConfiguration.value.replace(/[\{\}]/g,""),xAxisMinProperty=$filter("filter")(entityFields,{name:xAxisMinPropName})[0],yAxisMinProperty=$filter("filter")(entityFields,{name:yAxisMinPropName})[0],xAxisMaxProperty=$filter("filter")(entityFields,{name:xAxisMaxPropName})[0],yAxisMaxProperty=$filter("filter")(entityFields,{name:yAxisMaxPropName})[0];scope.minX=$filter("mapField")(scope.entity,xAxisMinProperty),scope.minY=$filter("mapField")(scope.entity,yAxisMinProperty),scope.maxX=$filter("mapField")(scope.entity,xAxisMaxProperty),scope.maxY=$filter("mapField")(scope.entity,yAxisMaxProperty),first===!0?(scope.$watch("entity."+xAxisMinPropName,initLimits),scope.$watch("entity."+xAxisMaxPropName,initLimits),scope.$watch("entity."+yAxisMinPropName,initLimits),scope.$watch("entity."+yAxisMaxPropName,initLimits)):(initTimeout&&($timeout.cancel(initTimeout),initTimeout=null),initTimeout=$timeout(function(){init()},500))}function initSteps(first){var xAxisStepConfiguration=$filter("filter")(configurationSource,{key:util.constants.TABLE_CONF_X_AXIS_STEP})[0],yAxisStepConfiguration=$filter("filter")(configurationSource,{key:util.constants.TABLE_CONF_Y_AXIS_STEP})[0],xAxisStepPropName=xAxisStepConfiguration.value.replace(/[\{\}]/g,""),yAxisStepPropName=yAxisStepConfiguration.value.replace(/[\{\}]/g,""),xAxisStepProperty=$filter("filter")(entityFields,{name:xAxisStepPropName})[0],yAxisStepProperty=$filter("filter")(entityFields,{name:yAxisStepPropName})[0];scope.stepX=$filter("mapField")(scope.entity,xAxisStepProperty),scope.stepY=$filter("mapField")(scope.entity,yAxisStepProperty),first===!0?(scope.$watch("entity."+xAxisStepPropName,initSteps),scope.$watch("entity."+yAxisStepPropName,initSteps)):(initTimeout&&($timeout.cancel(initTimeout),initTimeout=null),initTimeout=$timeout(function(){init()},500))}function init(){if(scope.minX>0&&scope.minY>0&&scope.stepX>0&&scope.stepY>0&&scope.maxX>scope.minX&&scope.maxY>scope.minY){var difX=scope.maxX-scope.minX,difY=scope.maxY-scope.minY,rowNum=difY/scope.stepY|0,colNum=difX/scope.stepX|0,rows=scope.rows=[];if(rowNum>0)for(var i=0;rowNum>=i;i++)rows.push({value:scope.minY+i*scope.stepY});var columns=scope.columns=[];if(colNum>0)for(var i=0;colNum>=i;i++)columns.push({value:scope.minX+i*scope.stepX});for(var steps=scope.steps=[],existingSteps=$filter("mapField")(scope.entity,scope.property),r=0;r<rows.length;r++)for(var c=0;c<columns.length;c++){var queryObj={};queryObj[xAxisPropName]=columns[c].value,queryObj[yAxisPropName]=rows[r].value;var existingStep=$filter("filter")(existingSteps,queryObj,!0)[0];if(existingStep)steps.push(existingStep);else{var newStep=scaffold.newEntity(innerEntityType);newStep[xAxisPropName]=columns[c].value,newStep[yAxisPropName]=rows[r].value,newStep.$provisory=!0,steps.push(newStep)}}}}var entityFields=util.getEntityFields(scope.metadata),innerEntityTypeName=scope.property.type.complexType,innerEntityType=util.getMetadata(innerEntityTypeName),innerEntityTypeFields=util.getEntityFields(innerEntityType);scope.rows=null,scope.columns=null,scope.minX=null,scope.maxX=null,scope.minY=null,scope.maxY=null,scope.stepX=null,scope.stepY=null,scope.valueField="value";var initTimeout=null,configuration=scope.configuration={},configurationSource=scope.property.fieldType.configuration[0],xAxisPropertyConfiguration=$filter("filter")(configurationSource,{key:util.constants.TABLE_CONF_X_AXIS_PROPERTY},!0)[0],xAxisPropName=xAxisPropertyConfiguration.value;configuration.xAxisProperty=$filter("filter")(innerEntityTypeFields,{name:xAxisPropName},!0)[0];var yAxisPropertyConfiguration=$filter("filter")(configurationSource,{key:util.constants.TABLE_CONF_Y_AXIS_PROPERTY},!0)[0],yAxisPropName=yAxisPropertyConfiguration.value;if(configuration.yAxisProperty=$filter("filter")(innerEntityTypeFields,{name:yAxisPropName},!0)[0],scope.entity.$resolved!==!1)initLimits(!0),initSteps(!0),init();else var resolveWatcher=scope.$watch("entity.$resolved",function(){scope.entity.$resolved!==!1&&(resolveWatcher(),initLimits(!0),initSteps(!0),init())});scope.getQueryObj=function(row,column){var queryObj={};return queryObj[xAxisPropName]=column.value,queryObj[yAxisPropName]=row.value,queryObj},scope.updateValue=function(step){if(step.value>0?step.$invalid&&delete step.$invalid:step.$invalid=!0,step.$provisory)delete step.$provisory,scope.value.entity.push(step);else{var listenerName=scope.property.owner+"_"+scope.property.name;scope.$emit("manually_change_"+listenerName)}var invalidSteps=$filter("filter")(scope.steps,{$invalid:!0});scope.$emit("form-invalid",{field:scope.property.name,owner:scope.property.owner,validation:"table-valid",valid:!invalidSteps.length})}}}}]),angular.module("konga").directive("updateForm",["$routeParams","api","common","fieldMapper","$filter","util","mapper",function($routeParams,api,common,fieldMapper,$filter,util,mapper){return{template:'<div ng-include="templateUrl"></div>',restrict:"E",replace:!0,scope:{entity:"=",changes:"=",metadata:"=",params:"=",onUpdate:"=",creating:"=",onChange:"=",fields:"=?"},link:function(scope,element,attrs){switch(scope.templateUrl="/konga/views/cascade-update.html",scope.fields||(scope.fields=util.getEntityFields(scope.metadata)),scope.metadata.updateType){case util.constants.TABBED_FORM:scope.templateUrl="/konga/views/tabbed-update.html",scope.fieldsets=util.getEntityFieldSets(scope.metadata);break;case util.constants.CUSTOM_TABBED_FORM:scope.templateUrl="/konga/views/custom_tabbed-update.html",scope.fieldsets=util.getEntityFieldSets(scope.metadata),scope.getView=function(name){var view=mapper[name];return view};break;case util.constants.CUSTOM_FORM:var configuration=$filter("filter")(scope.metadata.configuration,{key:util.constants.UPDATE_CUSTOM_VIEW});!configuration.length;var templateUrl=mapper[configuration[0].value];templateUrl||(templateUrl=configuration[0].value),scope.templateUrl=templateUrl}scope.$on("changeTab",function(events,args){scope.$broadcast("tabChangeCustomTabbed",{tab:args.tab})})}}}]),angular.module("konga").directive("verticalTabs",["$rootScope",function($rootScope){return{restrict:"E",transclude:!0,replace:!0,scope:!0,controller:function($scope){var tabContentList=$scope.tabContentList=[];$scope.select=function(tabContent){angular.forEach(tabContentList,function(tabContent){tabContent.selected=!1,tabContent.active=""}),tabContent.selected=!0,tabContent.active="active",$rootScope.pageData.currentTab=tabContent.title,$scope.$emit("changeTab",{tab:tabContent})},this.addTabContent=function(tabContent){0!==tabContentList.length||$rootScope.pageData.currentTab||$scope.select(tabContent),$rootScope.pageData.currentTab&&tabContent.title===$rootScope.pageData.currentTab&&$scope.select(tabContent),tabContentList.push(tabContent)}},link:function(scope,element,attrs){},templateUrl:"/konga/views/verticaltab.tp.html"}}]),angular.module("konga").filter("activeInactive",["configurationManager",function(){return function(value,field){return value?"message.boolean.yes":"message.boolean.no"}}]),angular.module("konga").filter("allowed",["userData","util",function(userData,util){return function(input,mode){for(var ret=[],i=0;i<input.length;i++){var field=input[i];switch(mode){case util.constants.SCOPE_SEARCH:field.searchable.value.length?-1!==userData.roles.indexOf(field.searchable.value)&&ret.push(field):ret.push(field);break;case util.constants.SCOPE_RESULTS:field.showInResults.value.length?-1!==userData.roles.indexOf(field.showInResults.value)&&ret.push(field):ret.push(field);break;case util.constants.SCOPE_UPDATE:field.showInUpdate.value.length?-1!==userData.roles.indexOf(field.showInUpdate.value)&&ret.push(field):ret.push(field)}}return ret}}]),angular.module("konga").filter("customFilter",["$filter",function($filter){return function(value,filter){return $filter(filter)(value)}}]),angular.module("konga").filter("extended",function(){return function(metadata,name){for(var i=0;i<metadata.length;i++)if(metadata[i].name==name)return metadata[i].isExtended;return!1}}),angular.module("konga").filter("fieldApiName",["util",function(util){return function(fieldName,source){var attrs=fieldName.split(" ");return 1===attrs.length?fieldName:attrs[1]===util.constants.COMPLEX_FIELD_AS?source&&attrs[1]===util.constants.SELF_FIELD?source.name:attrs[2]:void 0}}]),angular.module("konga").filter("fieldMultiplicity",["util",function(util){return function(field,mode){return mode===util.constants.SCOPE_SEARCH?field.searchConf.multiplicity:field.multiplicity}}]),angular.module("konga").filter("htmlify",["$filter",function($filter){return function(text){var parsedText=text,lineBreakRegex=/\n/g,lineBreakReplace="<br />";return parsedText=parsedText.replace(lineBreakRegex,lineBreakReplace),parsedText=$filter("urlify")(parsedText)}}]),angular.module("konga").filter("locale",["common",function(common){return function(input){var messages=common.read("messages");return input&&messages&&messages.messages?messages.messages[input]:null}}]),angular.module("konga").filter("mapField",["util",function(util){return function(entity,field){if(!entity)return null;if(field.derived){for(var path=field.apiPath,pathSteps=path.split("."),current=entity,i=0;i<pathSteps.length;i++){if(!current){current=null;break}current=current[pathSteps[i]]}return current}return field.type.type===util.constants.FIELD_COMPLEX?entity[field.name]:entity[field.name]}}]),angular.module("konga").filter("priceRenderer",["$filter",function($filter){return function(input,field,symbol){var configuration=field.fieldType.configuration[0],value=($filter("filter")(configuration,{key:"CURRENCY_THOUSAND_SEPARATOR"},!0)[0],$filter("filter")(configuration,{key:"CURRENCY_DECIMAL_SEPARATOR"},!0)[0],$filter("number")(input,2)),strValue=value+"";return strValue}}]),angular.module("konga").filter("queryParser",["util",function(util){return function(field,entity,oldQuery){var query=oldQuery?oldQuery:{},fieldQuery=field.type.query;fieldQuery instanceof Array&&(fieldQuery={});for(var param in fieldQuery){var value=fieldQuery[param];if(value.match(util.constants.QUERY_PARAM_REGEXP)){var realValue=value.replace(/[{-}]/g,""),entityValue=entity[realValue];null!==entityValue&&void 0!==entityValue&&0!==entityValue.length&&(query[param]=entityValue)}else if(value.match(util.constants.QUERY_COMPLEX_PARAM_REGEXP)){for(var valuePath=value.replace(/[{-}]/g,"").split(/\./),entityValue=entity,i=0;i<valuePath.length;i++){var step=valuePath[i];if(!entityValue)break;entityValue=entityValue[step]}null!==entityValue&&void 0!==entityValue&&0!==entityValue.length&&(query[param]=entityValue)}else query[param]=value}return query}}]),angular.module("konga").filter("quickSearch",["$filter","util",function($filter,util){return function(metadata){for(var ret=[],fields=util.getEntityFields(metadata),i=0;i<fields.length;i++){var field=fields[i];if(null!==field.quickSearch.value){var quickSearchField={metadata:field,value:""};ret.push(quickSearchField)}}if(!ret.length){var codeField=$filter("filter")(fields,{isKey:!0}),relatedMetadata=util.getMetadata(field.owner),extra={label:$filter("translate")(relatedMetadata.label),labelPlaceholder:relatedMetadata.label},quickSearchField={metadata:codeField[0],value:"",extra:extra};ret.push(quickSearchField)}return ret}}]),angular.module("konga").filter("resultParams",function(){return function(fields,metadata){for(var result=[],hasDefaultSorting=!1,i=0;i<fields.length;i++){var field=fields[i];null!==field.showInResults.value&&(field.sorting="",1===field.priority.results&&(field.sorting="asc",hasDefaultSorting=!0),result.push(field))}return!hasDefaultSorting&&result.length>0&&(result[0].sorting="asc"),result}}),angular.module("konga").filter("scroll",function(){return function(input,limit){return input.slice(0,limit)}}),angular.module("konga").filter("searchParams",function(){return function(fields,metadata){for(var result=[],i=0;i<fields.length;i++){var field=fields[i];null!==field.searchable.value&&result.push(field)}return result}}),angular.module("konga").filter("selectData",["util",function(util){return function(metadata,entities,configuration){for(var result=[],i=0;i<entities.length;i++){var added=configuration&&void 0!==configuration.added?configuration.added:!1,selected=configuration&&void 0!==configuration.selected?configuration.selected:!1,obj={id:util.getEntityId(metadata,entities[i]),key:util.getEntityCode(metadata,entities[i]),value:util.getEntityLabel(metadata,entities[i]),added:added,selected:selected};result.push(obj)}return result}}]),angular.module("konga").filter("selectedFields",["$filter","util",function($filter,util){return function(real,names,source){for(var result=[],sortedResult=[],i=0;i<names.length;i++)sortedResult.push(name);for(var i=0;i<real.length;i++){var nameIndex=names.indexOf(real[i].name);if(-1!==nameIndex){var fieldToPush=angular.copy(real[i]);fieldToPush.derived=!0,fieldToPush.apiName=$filter("fieldApiName")(names[nameIndex]),fieldToPush.apiPath=real[i].name,fieldToPush.derivedPath=[],fieldToPush.categories=source.categories;for(var showConf in fieldToPush.fieldType)fieldToPush.fieldType[showConf]===util.constants.FIELD_COMPLEX&&(fieldToPush.fieldType[showConf]=util.constants.FIELD_SELECT);result.push(fieldToPush)}}for(var i=0;i<names.length;i++){var name=names[i],nameAttrs=name.split(" ");if(nameAttrs[0]!==util.constants.SELF_FIELD){if(-1!==nameAttrs[0].indexOf("."))for(var fieldPath=nameAttrs[0].split("."),path=[],current=null,currentFields=real,f=0;f<fieldPath.length;f++){current=fieldPath[f];for(var g=0;g<currentFields.length;g++){var currentField=currentFields[g];if(currentField.name===current){var fieldType=currentField.type;if(f===fieldPath.length-1){var fieldToPush=angular.copy(currentField);fieldToPush.derived=!0,fieldToPush.apiName=$filter("fieldApiName")(name),fieldToPush.apiPath=nameAttrs[0],fieldToPush.derivedPath=path,fieldToPush.categories=source.categories;for(var showConf in fieldToPush.fieldType)fieldToPush.fieldType[showConf]===util.constants.FIELD_COMPLEX&&(fieldToPush.fieldType[showConf]=util.constants.FIELD_SELECT);result.push(fieldToPush)}else if(fieldType.type===util.constants.FIELD_COMPLEX){var complexType=fieldType.complexType,complexMetadata=util.getMetadata(complexType),complexFields=util.getEntityFields(complexMetadata);currentFields=complexFields,path.push(currentField)}break}}}}else{var fieldCopy=angular.copy(source);for(var showConf in fieldCopy.fieldType)fieldCopy.fieldType[showConf]=util.constants.FIELD_SELECT;fieldCopy.derived=!0,fieldCopy.apiName=$filter("fieldApiName")(name,fieldCopy),fieldCopy.apiPath=fieldCopy.name,fieldCopy.derivedPath=[],fieldCopy.isSelf=!0,result.push(fieldCopy)}}for(var i=0;i<result.length;i++){var apiPath=result[i].apiPath,index=names.indexOf(apiPath);sortedResult.splice(index,1,result[i])}return sortedResult}}]),angular.module("konga").filter("selectedLocale",function(){return function(locales){if(!locales)return{};for(var i=0;i<locales.length;i++)if(locales[i].selected)return locales[i];return{}}}),angular.module("konga").filter("shortify",function(){return function(input,length){var ret;try{ret=input.substring(0,length)}catch(e){ret=input}return ret}}),angular.module("konga").filter("tableRendererComplex",["util",function(util){return function(value,metadata){if(metadata.type.type===util.constants.FIELD_COMPLEX){var complexType=metadata.type.complexType,metadata=util.getMetadata(complexType),key=util.getEntityCode(metadata,value),label=util.getEntityLabel(metadata,value);return label||key?label+" (#"+key+")":""}return""}}]),angular.module("konga").filter("translateComplex",["$filter",function($filter){return function(input,extra){return"string"!=typeof input?input:$filter("translate")(input,extra)}}]),angular.module("konga").filter("updateParams",function(){return function(fields,metadata,category){for(var result=[],i=0;i<fields.length;i++){var field=fields[i];null!==field.showInUpdate.value&&(void 0!==category?-1!==field.categories.indexOf(category)&&result.push(field):result.push(field))}return result}}),angular.module("konga").filter("urlify",function(){return function(text){var urlRegex=/(https?:\/\/[^\s]+)/g;return text.replace(urlRegex,function(url){return'<a href="'+url+'" target="_blank">'+url+"</a>"})}}),angular.module("konga").provider("actionManager",["util",function(util){function ActionManager($rootScope,Session,configurationManager,customActions,$injector){this.dispatch=function(action,parameters){"string"==typeof action&&(action={name:action});var actionDefinitionOriginal=customActions[action.name];actionDefinitionOriginal||(actionDefinitionOriginal=actions[action.name]);var actionDefinition=angular.copy(actionDefinitionOriginal);actionDefinition.params.parameters=parameters,actionDefinition.params.parameters.actionManager=this,actionDefinition.params.parameters.dependencyInjector=$injector;var authorized=!0;if(actionDefinition.restrict){for(var rolesNative=userData.roles,userRoles=[],i=0;i<rolesNative.length;i++){for(var role="",f=-1;void 0!==rolesNative[i][++f];)role+=rolesNative[i][f];userRoles.push(role)}authorized=!1;for(var i=0;i<actionDefinition.restrict.length;i++){var role=actionDefinition.restrict[i];if(-1!==userRoles.indexOf(role)){authorized=!0;break}}}switch(authorized||(actionDefinition=actions["action-forbidden"]),actionDefinition.type){case util.constants.ACTION_TYPE_MODAL:$rootScope.operations.openModal(actionDefinition.params);break;case util.constants.ACTION_TYPE_NOTIFY:$rootScope.operations.notify(actionDefinition.params.title,actionDefinition.params.message,actionDefinition.params.type,actionDefinition.params);break;case util.constants.ACTION_TYPE_CONFIRM:$rootScope.operations.confirm(actionDefinition.params.title,actionDefinition.params.message,actionDefinition.params.okHandler,actionDefinition.params.koHandler,actionDefinition.params);break;case util.constants.ACTION_TYPE_TAB:for(var encodedParam in parameters)for(var actionParam in actionDefinition.params)"string"==typeof actionDefinition.params[actionParam]&&(actionDefinition.params[actionParam]=actionDefinition.params[actionParam].split("{"+encodedParam+"}").join(parameters[encodedParam]));$rootScope.operations.addTab(actionDefinition.params);break;case util.constants.ACTION_TYPE_FUNCTION:var params=actionDefinition.params.parameters,functionToCall=actionDefinition.params.fn;if("function"==typeof functionToCall)functionToCall.call(params.self,params);else if(functionToCall instanceof Array){for(var fnParams=functionToCall,fn=fnParams.splice(fnParams.length-1,1)[0],deps=[],i=0;i<fnParams.length;i++){var depName=fnParams[i];if("params"!==depName)try{var dep=params.dependencyInjector.get(depName);deps.push(dep)}catch(e){}else deps.push(params)}fn.apply(params.self,deps)}}}}var actions={search:{type:util.constants.ACTION_TYPE_FUNCTION,params:{fn:function(params){this.query.resetPaging=!0,this.query.resetSorting=!0,this.submit(this.query)}}},clear:{type:util.constants.ACTION_TYPE_FUNCTION,params:{fn:function(params){this.$broadcast("reset-form"),this.delayedSubmit()}}},"quick-search":{type:util.constants.ACTION_TYPE_FUNCTION,params:{fn:function(params){this.submit(quickSearchQuery)}}},sort:{type:util.constants.ACTION_TYPE_FUNCTION,params:{fn:function(params){var field=params.data.field,type=params.data.type;this.submitSorting(field,type),this.$broadcast("sorting",{field:field,type:type})}}},"save-ok":{type:util.constants.ACTION_TYPE_FUNCTION,params:{fn:["$rootScope","params",function($rootScope,params){var entityId=params.id,$scope=this,data=params.data;entityId===util.constants.NEW_ENTITY_ID?$rootScope.operations.addAlert(util.constants.ALERT_TYPE_SUCCESS,"message.action-confirmation.create.success"):$rootScope.operations.addAlert(util.constants.ALERT_TYPE_SUCCESS,"message.action-confirmation.update.success"),$rootScope.pageData.original=angular.copy(data),$scope.entity=$rootScope.pageData.entity=data,$scope.changes=[],$scope.operations.updateChanges(),$rootScope.operations.closeTabById($rootScope.pageData.pageId)}]}},"save-ko":{type:util.constants.ACTION_TYPE_FUNCTION,params:{fn:["exceptionManager","params",function(exceptionManager,params){exceptionManager.analyzeException(params)}]}},"delete-ko":{type:util.constants.ACTION_TYPE_FUNCTION,params:{fn:["exceptionManager","params",function(exceptionManager,params){exceptionManager.analyzeException(params)}]}},"search-entity":{type:util.constants.ACTION_TYPE_TAB,params:{id:util.constants.ENTITY_ID_PREFFIX+"{entityType}"+util.constants.SEARCH_SUFFIX,title:"message.tabs.entity.search",href:"/entity/{entityType}/search/",closable:!0,hasChanges:!1,entityType:"{entityType}",type:util.constants.TAB_TYPE_SEARCH}},"update-entity":{type:util.constants.ACTION_TYPE_TAB,params:{id:util.constants.ENTITY_ID_PREFFIX+"{entityType}"+util.constants.STRING_SEPARATOR+"{id}",title:"message.tabs.entity.search",href:"/entity/{entityType}/{id}/",closable:!0,hasChanges:!1,entityType:"{entityType}",type:util.constants.TAB_TYPE_UPDATE}},"action-form-invalid":{type:util.constants.ACTION_TYPE_NOTIFY,params:{type:"error",title:"message.action.form-invalid.title",message:"message.action.form-invalid.message"}},"action-forbidden":{type:util.constants.ACTION_TYPE_NOTIFY,params:{type:"error",title:"message.action.forbidden.title",message:"message.action.forbidden.message"}},"action-under-development":{type:util.constants.ACTION_TYPE_NOTIFY,params:{type:"notify",title:"message.action.under-development.title",message:"message.action.under-development.message"}}};this.setSalutation=function(s){salutation=s},this.$get=function($injector){var rScope=$injector.get("$rootScope"),userData=$injector.get("userData"),configurationManager=$injector.get("configurationManager"),customActions=$injector.get("customActions");return new ActionManager(rScope,userData,configurationManager,customActions,$injector)}}]),angular.module("konga").factory("api",["konga","standardApi",function(konga,standardApi){return{getLocalEndpoint:function(source){var endpoint=konga.api(source);return endpoint||(endpoint=standardApi),endpoint}}}]),angular.module("konga").provider("common",function(){function Storer(){this.store=function(key,value){storage[key]=value},this.read=function(key){return storage[key]},this.deleteKey=function(key){delete storage[key]},this.getMetadata=function(type){for(var metadata=this.read("metadata"),i=0;i<metadata.entities.length;i++){var c_metadata=metadata.entities[i];if(c_metadata.name===type)return c_metadata}return null},this.getPageData=function(id){var ret=pageData[id];return ret||(ret=pageData[id]={pageId:id,init:!1}),ret},this.deletePageData=function(id){var ret=pageData[id];ret&&delete pageData[id]}}var storage={},pageData={};this.$get=function(){return new Storer}}),angular.module("konga").provider("configurationManager",["util",function(util){function ConfigurationManager($rootScope,$filter){this.get=function(param,source,mode,order){var configuration=null,confSource=null;if(source&&(confSource=source.configuration,mode)){switch(mode){case util.constants.SCOPE_SEARCH:confSource=source.searchable?source.searchable.configuration:[];break;case util.constants.SCOPE_RESULTS:confSource=source.showInResults?source.showInResults.configuration:[];break;case util.constants.SCOPE_UPDATE:confSource=source.showInUpdate?source.showInUpdate.configuration:[]}if(configuration=$filter("filter")(confSource,{key:param}),configuration.length)return configuration[0].value;if(source.owner){var entityMetadata=util.getMetadata(source.owner),entityConfiguration=entityMetadata.configuration;if(configuration=$filter("filter")(entityConfiguration,{key:param}),configuration.length)return configuration[0].value}}var rootConfiguration=$rootScope.metadata.configuration;return configuration=$filter("filter")(rootConfiguration,{key:param}),configuration&&configuration.length?configuration[0].value:void 0}}this.$get=function($injector){var rScope=$injector.get("$rootScope"),filter=$injector.get("$filter");return new ConfigurationManager(rScope,filter)}}]),angular.module("konga").constant("customActions",{}),angular.module("konga").service("exceptionManager",["util",function(util){this.analyzeException=function(params){var exceptionCode,$rootScope=params.dependencyInjector.get("$rootScope"),$filter=params.dependencyInjector.get("$filter"),$scope=params.self,error=params.error;exceptionCode=error.data.length?error.data&&error.data.length?error.data[0].exceptionCode:"GENERIC_TECHNICAL_ERROR":error.data?error.data.exceptionCode:"GENERIC_TECHNICAL_ERROR";var involvedFields="";if("UNIQUE_CONSTRAINT_VIOLATION"==error.data.exceptionCode){var fieldArray=$scope.entityMetadata.fields;if($scope.entityMetadata.superClass)for(var i=0;i<$scope.metadata.entities.length;i++)if($scope.metadata.entities[i].name==$scope.entityMetadata.superClass){fieldArray=fieldArray.concat($scope.metadata.entities[i].fields);break}var usedFields=[];exceptionCode="UNIQUE_CONSTRAINT_VIOLATION";for(var ind=0;ind<error.data.fieldNames.length;ind++)for(var i=0;i<fieldArray.length;i++)if(error.data.fieldNames[ind]==fieldArray[i].name&&usedFields.indexOf(fieldArray[i].name)<0)if(usedFields.push(fieldArray[i].name),ind>0&&(involvedFields+=", "),$scope.entityMetadata.superClass){var owner=$filter("translate")(fieldArray[i].owner?$scope.entityMetadata.label:"");involvedFields+=$filter("translate")(fieldArray[i].label,{label:owner})}else involvedFields+=$filter("translate")(fieldArray[i].label);involvedFields="("+involvedFields+")"}$rootScope.operations.addAlert(util.constants.ALERT_TYPE_ERROR,exceptionCode,{fields:involvedFields})}}]),angular.module("konga").service("fieldMapper",["api","common","scaffold","$filter","util",function(api,common,scaffold,$filter,util){this.mapField=function(fieldName,edsType,entity){},this.unmapField=function(fieldMetadata,edsType,entity,value,parentField,parentEntity){try{var fieldName=fieldMetadata.name,fieldType=fieldMetadata.type.type;fieldType===util.constants.FIELD_COMPLEX&&fieldMetadata.isKey&&(fieldType=util.constants.FIELD_TEXT);var escapedValue=null;switch(fieldType){case util.constants.FIELD_TEXT:escapedValue=value.text;break;
case util.constants.FIELD_BOOLEAN:escapedValue=value.text;break;case util.constants.FIELD_NUMBER:escapedValue=parseFloat((value.text+"").split(",").join("."));break;case util.constants.FIELD_COMPLEX:escapedValue=value.entity;break;case util.constants.FIELD_FILE:escapedValue=value.files,escapedValue.$filesIncluded=!!escapedValue.length;break;default:escapedValue=value.text}if(parentField&&parentField.type.type===util.constants.FIELD_COMPLEX){var entityMetadata=common.getMetadata(parentField.type.complexType),entityParent=null,parentMultiplicity=parentField.multiplicity;if(parentMultiplicity===util.constants.MULTIPLICITY_ONE)void 0!==parentEntity[fieldName]&&(parentEntity[fieldName]=escapedValue);else{var parentFieldName=parentField.name;parentEntity[parentFieldName].splice(0,entity.length);for(var i=0;i<escapedValue.length;i++)entityParent=scaffold.newEntity(entityMetadata),entityParent[fieldName]||(entityParent[fieldName]={}),entityParent[fieldName]=escapedValue[i],null!=entityParent&&parentEntity[parentFieldName].push(entityParent)}}else entity[fieldName]=escapedValue}catch(e){value=null,escapedValue=null}return value&&(value.escaped=escapedValue,value.extra={}),value}}]),angular.module("konga").constant("kongaConfig",{}),angular.module("konga").provider("konga",["kongaConfig","mapper","util","customActions",function(kongaConfig,mapper,util,customActions){function Konga(common,$rootScope,userData){this.api=function(entity,API){return void 0!==API&&(apiResolutions[entity]=API),apiResolutions[entity]},this.action=function(name,action){return void 0!==action&&(customActions[name]=action),customActions[name]},this.config=function(key,value){return void 0!==value&&(kongaConfig[key]=value),kongaConfig[key]},this.viewMapper=function(map,view){return void 0!==view&&(mapper[map]=view),mapper[map]},this.util=util,this.storage=common,this.init=function(metadata){$rootScope.metadata=metadata,util.init(metadata),common.store("metadata",metadata),$rootScope.$emit("metadata-ready",{metadata:metadata})}}var apiResolutions={};this.api=function(entity,API){apiResolutions[entity]=API},this.action=function(name,action){return void 0!==action&&(customActions[name]=action),customActions[name]},this.config=function(key,value){kongaConfig[key]=value},this.viewMapper=function(map,view){mapper[map]=view},this.$get=["common","$rootScope","userData",function(common,$rootScope,userData){return new Konga(common,$rootScope,userData)}]}]),angular.module("konga").constant("mapper",{}),angular.module("konga").provider("permissionManager",function(){function Greeter(userData){this.isAllowed=function(permission){for(var rolesNative=userData.roles,userRoles=[],i=0;i<rolesNative.length;i++){for(var role="",f=-1;void 0!==rolesNative[i][++f];)role+=rolesNative[i][f];userRoles.push(role)}return permission.length?-1!==userRoles.indexOf(permission):!0}}this.$get=function($injector){var userData=$injector.get("userData");return new Greeter(userData)}}),angular.module("konga").service("scaffold",["$filter","common","util",function($filter,common,util){function generate(fields,entity,search){for(var i=0;i<fields.length;i++){var field=fields[i],multiplicity=search?field.searchConf.multiplicity:field.multiplicity,type=field.type.type,defaultValue=field.defaults,castValue=null;if("null"==defaultValue||field.isId)castValue=null;else if(multiplicity!=util.constants.MULTIPLICITY_MANY||search&&field.fieldType.search===util.constants.FIELD_COMPLEX)if(type!==util.constants.FIELD_TEXT)switch(type){case util.constants.FIELD_BOOLEAN:castValue=search?"true"===defaultValue?!0:"false"===defaultValue?!1:null:"true"===defaultValue;break;case util.constants.FIELD_COMPLEX:if(castValue=null,search&&field.fieldType.search===util.constants.FIELD_COMPLEX){var innerFields=field.searchable.fields,apiNames=field.apiName;if(innerFields.length){castValue={},apiNames&&apiNames.length==innerFields.length&&(innerFields=apiNames);for(var f=0;f<innerFields.length;f++){var innerFieldName=innerFields[f];castValue[$filter("fieldApiName")(innerFieldName)]=null}}}break;case util.constants.FIELD_DATE:castValue=search?{startDate:0,endDate:0,comparator:util.constants.DATE_COMPARATOR_EQUALS}:defaultValue==util.constants.DATE_DEFAULT_NOW?(new Date).getTime():null;break;case util.constants.FIELD_NUMBER:castValue=defaultValue?parseInt(defaultValue):defaultValue;break;case util.constants.FIELD_STRING:"undefined"!=typeof defaultValue&&(castValue=defaultValue)}else castValue=defaultValue;else castValue=[];entity[field.name]=castValue}}this.newEntity=function(metadata,resource){var entity=null;entity=void 0===resource?{}:new resource;var fields=util.getEntityFields(metadata);return generate(fields,entity),entity},this.newQuery=function(metadata){var query={},entityFields=util.getEntityFields(metadata),fields=$filter("searchParams")(entityFields,metadata);if(generate(fields,query,!0),void 0!==query.idCtrOperat){var ctrOperat=common.read("ctr-operat"),idCtrOperat=ctrOperat.id;query.idCtrOperat=idCtrOperat}return query}}]),angular.module("konga").factory("standardApi",["$resource","$routeParams","configurationManager","kongaConfig","util",function($resource,$routeParams,configurationManager,kongaConfig,util){var service=$resource(kongaConfig.apiEndpoint+"/:path/:id/:operation/:opId",{},{get:{method:"GET",params:{id:"@id"},transformResponse:function(resp){var data=angular.fromJson(resp);return data}},search:{method:"GET",params:{id:null,path:"@path",opId:null},isArray:!0,transformResponse:function(data){var jsonData=angular.fromJson(data);return jsonData.data?($routeParams.count=jsonData.count,jsonData.data):jsonData}},update:{method:"PUT",params:{path:"@path",id:"@id"}},save:{method:"PUT",params:{path:"@path",id:"@id"}},create:{method:"POST",params:{path:"@path",id:null}},deleteObj:{method:"DELETE",params:{path:"@path",id:"@id"}}});return service}]),angular.module("konga").factory("TokenHandler",function(){var tokenHandler={},token="none";tokenHandler.set=function(newToken){token=newToken},tokenHandler.get=function(){return token},tokenHandler.wrapActions=function(resource,actions){for(var wrappedResource=resource,i=0;i<actions.length;i++)tokenWrapper(wrappedResource,actions[i]);return wrappedResource};var tokenWrapper=function(resource,action){resource["_"+action]=resource[action],resource[action]=function(data,success,error){return resource["_"+action](angular.extend({},data||{},{access_token:tokenHandler.get()}),success,error)}};return tokenHandler}),angular.module("konga").value("userData",{roles:[]}),angular.module("konga").constant("util",{metadataObject:null,getConfiguration:function(){return this.metadataObject.configuration},getMetadata:function(name){for(var i=0;i<this.metadataObject.entities.length;i++){var current=this.metadataObject.entities[i];if(current.name===name)return current}return null},getEntityFields:function(entity){var fields=angular.copy(entity.fields);if(entity.superClass){for(var superClass=this.getMetadata(entity.superClass),entityConfiguration=entity.configuration,superFields=superClass.fields,superFieldsCopy=[],i=0;i<superFields.length;i++){for(var ignore=!1,f=0;f<entityConfiguration.length;f++){var param=entityConfiguration[f];if(param.key===this.constants.CONFIGURATION_IGNORE_PARENT_FIELD){var fieldName=param.value;if(superFields[i].name===fieldName){ignore=!0;break}}}if(!ignore){var newField=angular.copy(superFields[i]);newField.owner=entity.name,superFieldsCopy.push(newField)}}fields=fields.concat(superFieldsCopy)}return fields},getEntityId:function(metadata,entity,fieldName){for(var id=this.constants.NEW_ENTITY_ID,fields=this.getEntityFields(metadata),i=0;i<fields.length;i++){var field=fields[i];if(field.isId){entity&&(id=entity[field.name]),fieldName&&(id=field.name);break}}return id},getEntityCode:function(metadata,entity,fieldName){for(var code=null,fields=this.getEntityFields(metadata),i=0;i<fields.length;i++){var field=fields[i];if(field.isKey&&!field.related){entity&&(code=entity[field.name]),fieldName&&(code=field.name);break}}return code},getEntityLabel:function(metadata,entity,fieldName){for(var label=null,fields=this.getEntityFields(metadata),i=0;i<fields.length;i++){var field=fields[i];if(field.isLabel&&!field.related){entity&&(label=entity[field.name]),fieldName&&(label=field.name);break}}return label},getEntityCategories:function(entity,level){for(var categories=[],fields=this.getEntityFields(entity),i=0;i<fields.length;i++)1==level&&fields[i].categories.length&&-1==categories.indexOf(fields[i].categories[0])&&categories.push(fields[i].categories[0]);return categories},getEntityFieldSets:function(entity){var fieldsets=[];if(fieldsets=fieldsets.concat(entity.fieldSets),entity.superClass){var superClass=this.getMetadata(entity.superClass);fieldsets=fieldsets.concat(superClass.fieldSets)}return fieldsets},init:function(metadata){this.metadataObject=metadata},constants:{ALERT_TYPE_ERROR:"danger",ALERT_TYPE_SUCCESS:"success",ALERT_TYPE_DEFAULT:"default",ALERT_TYPE_WARNING:"warning",ENTITY_ID_PREFFIX:"entity_",SEARCH_SUFFIX:"_search",STRING_SEPARATOR:"_",NEW_ENTITY_ID:"new",REFRESH_SEARCH_KEY:"refreshSearchKey_",SCOPE_SEARCH:"search",SCOPE_RESULTS:"results",SCOPE_UPDATE:"update",FIELD_STRING:"STRING",FIELD_NUMBER:"NUMBER",FIELD_PLAIN:"PLAIN",FIELD_PASSWORD:"PASSWORD",FIELD_BOOLEAN:"BOOLEAN",FIELD_CHECKBOX:"CHECKBOX",FIELD_COMBOBOX:"COMBOBOX",FIELD_DATE:"DATE",FIELD_DATETIME:"DATETIME",FIELD_DATESEARCH:"DATE-SEARCH",FIELD_TEXT:"TEXT",FIELD_TEXTAREA:"TEXTAREA",FIELD_COMPLEX:"COMPLEX",FIELD_LIST:"LIST",FIELD_PICK_LIST:"PICK_LIST",FIELD_SELECT:"SELECT",FIELD_FILTERED_SELECT:"FILTERED_SELECT",FIELD_TICS:"TICS",FIELD_COLOR:"COLOR",FIELD_CSS:"CSS",FIELD_FILE:"FILE",FIELD_IMAGE:"IMAGE",FIELD_PRICE:"PRICE",FIELD_CUSTOM:"CUSTOM",FIELD_PLAIN_FILTERED:"PLAIN_FILTERED",FIELD_TABLE:"TABLE",DATE_DEFAULT_NOW:"now",MULTIPLICITY_ONE:"ONE",MULTIPLICITY_MANY:"MANY",TRIGGER_MOMENT_IMMEDIATE:"IMMEDIATE",TRIGGER_MOMENT_COMMIT:"COMMIT",TRIGGER_TYPE_CONFIRM:"CONFIRM",TRIGGER_TYPE_ALERT:"ALERT",TRIGGER_PARAM_LABEL:"label",TRIGGER_MATCH_VALUE:"VALUE",TRIGGER_MATCH_LENGTH:"LENGTH",TRIGGER_MATCH_TYPE_EXACT:"EXACT_MATCH",TRIGGER_MATCH_TYPE_RANGE:"RANGE",CASCADE_FORM:"CASCADE",TABBED_FORM:"TABBED",CUSTOM_TABBED_FORM:"CUSTOM_TABBED",CUSTOM_FORM:"CUSTOM",CATEGORIZED_CASCADE_FORM:"CATEGORIZED_CASCADE",LANGUAGE_MESSAGE_PREFFIX:"message.languages.",DATE_COMPARATOR_LOWER_THAN:"LOWER_THAN",DATE_COMPARATOR_LOWER_EQUALS:"LOWER_EQUALS",DATE_COMPARATOR_EQUALS:"EQUALS",DATE_COMPARATOR_GREATER_EQUALS:"GREATER_EQUALS",DATE_COMPARATOR_GREATER_THAN:"GREATER_THAN",DATE_COMPARATOR_BETWEEN:"BETWEEN",NUMBER_COMPARATOR_LOWER_THAN:"LOWER_THAN",NUMBER_COMPARATOR_LOWER_EQUALS:"LOWER_EQUALS",NUMBER_COMPARATOR_EQUALS:"EQUALS",NUMBER_COMPARATOR_GREATER_EQUALS:"GREATER_EQUALS",NUMBER_COMPARATOR_GREATER_THAN:"GREATER_THAN",NUMBER_COMPARATOR_BETWEEN:"BETWEEN",VALIDATOR_EXACT_MATCH:"EXACT_MATCH",VALIDATOR_RANGE:"RANGE",MAXLEN_FILTER_NAME:30,ACTION_TYPE_MODAL:"modal",ACTION_TYPE_NOTIFY:"notify",ACTION_TYPE_CONFIRM:"confirm",ACTION_TYPE_TAB:"tab",ACTION_TYPE_FUNCTION:"function",ACTION_RESTRICTION_POLICY_ALL:"all",USER_ID:"userId",COMBO_NATURE_TIERS:"natTiers",CONFIGURATION_IGNORE_PARENT_FIELD:"IGNORE_PARENT_FIELD",CONFIGURATION_USE_VIEW:"USE_VIEW",TAB_TYPE_SEARCH:"glyphicon glyphicon-search",TAB_TYPE_UPDATE:"glyphicon glyphicon-pencil",TAB_TYPE_HOME:"glyphicon glyphicon-home",TAB_TYPE_TASKS:"glyphicon glyphicon-tasks",TAB_TYPE_GRID:"glyphicon glyphicon-th",TAB_TYPE_GRID_LARGE:"glyphicon glyphicon-th-large",TAB_TYPE_STORE:"glyphicon glyphicon-shopping-cart",TAB_TYPE_CONFIG:"glyphicon glyphicon-cog",FORM_STYLE_HORIZONTAL:"HORIZONTAL",USE_SHORT_LABEL:"USE_SHORT_LABEL",FILE_TYPE_PDF:"application/pdf",FILE_TYPE_PNG:"image/png",FILE_TYPE_JPG:"image/jpeg",FILE_TYPE_GIF:"image/gif",FILE_EXT_PNG:".png",FILE_EXT_JPG:".jpg",FILE_EXT_GIF:".gif",CASCADE_UPDATE:"CASCADE_UPDATE",PROPAGATE_UPDATE:"PROPAGATE_UPDATE",DISABLE_COMPLEX_FIELD:"DISABLE_FIELD",SELF_FIELD:"$self",COMPLEX_FIELD_AS:"as",UPDATE_CUSTOM_VIEW:"UPDATE_CUSTOM_VIEW",SEARCH_CUSTOM_VIEW:"SEARCH_CUSTOM_VIEW",RESULTS_CUSTOM_VIEW:"RESULTS_CUSTOM_VIEW",UPDATE_HIDE_BUTTONS:"UPDATE_HIDE_BUTTONS",WEEKDAYS:["day.sunday","day.monday","day.tuesday","day.wednesday","day.thursday","day.friday","day.saturday"],WEEKEND_DAYS:["day.saturday","day.sunday"],MONTHS:["month.january","month.february","month.march","month.april","month.may","month.june","month.july","month.august","month.september","month.october","month.november","month.december"],SEARCH_USE_CATEGORY:"USE_SEARCH_CATEGORY",RESULTS_USE_CATEGORY:"USE_RESULTS_CATEGORY",HIDE_CATEGORY_HEADER:"HIDE_CATEGORY_HEADER",QUERY_PARAM_REGEXP:/^{\w+}$/,QUERY_COMPLEX_PARAM_REGEXP:/^{(\w+\.\w+)*}$/,SHOW_PAGINATION:"SHOW_PAGINATION",TABLE_CELL_RENDERER:"TABLE_CELL_RENDERER",TABLE_CELL_FILTER:"TABLE_CELL_FILTER",READ_ONLY:"READ_ONLY",TABLE_CONF_X_AXIS_PROPERTY:"X_AXIS_PROPERTY",TABLE_CONF_Y_AXIS_PROPERTY:"Y_AXIS_PROPERTY",TABLE_CONF_X_AXIS_MIN:"X_AXIS_MIN",TABLE_CONF_Y_AXIS_MIN:"Y_AXIS_MIN",TABLE_CONF_X_AXIS_MAX:"X_AXIS_MAX",TABLE_CONF_Y_AXIS_MAX:"Y_AXIS_MAX",TABLE_CONF_X_AXIS_STEP:"X_AXIS_STEP",TABLE_CONF_Y_AXIS_STEP:"Y_AXIS_STEP",LOOK_AND_FEEL_PLAIN:"plain",LOOK_AND_FEEL_TABS:"tabs",CONFIG_LOOK_AND_FEEL:"look-and-feel",HIDE_WHEN_CREATING:"hide-when-creation",HIDE_WHEN_UPDATING:"hide-when-updating",FIELD_TYPE_CUSTOM:"CUSTOM",CUSTOM_FIELD_TYPE:"CUSTOM_FIELD_TYPE",SHOW_HINT_SEARCH:"SHOW_HINT_SEARCH",SHOW_HINT_UPDATE:"SHOW_HINT_UPDATE",NUMBER_CONF_STEP:"NUMBER_CONF_STEP"}}),angular.module("config",[]).constant("i18n",{es:{"message.login.title":"Acceso a la aplicacin","message.login.description":"Introduzca sus datos de acceso para utilizar la aplicacin","message.login.username":"Correo electrnico","message.login.password":"Contrasea","message.login.rememberme":"Recordarme en este equipo","message.login.proceed":"Acceder","message.login.incorrect-data":"Usuario o contrasea invlidos","message.action.validate":"Validar","message.action.save":"Guardar","message.action.cancel":"Cancelar","message.action.add":"Aadir","message.action.delete":"Eliminar","message.action.clean":"Limpiar","message.action.search":"Buscar","message.action.close":"Cerrar","message.action.proceed-order":"Pedido","message.discard-changes.title":"Confirma tu accin","message.discard-changes.message":"Deseas cancelar tus cambios?","message.delete-entity.title":"Confirma tu accin","message.delete-entity.message":"Deseas eliminar este elemento?","message.action-confirmation.create.success":"Elemento creato con xito","message.action-confirmation.update.success":"Elemento actualizado con xito","message.action-confirmation.delete.success":"Elemento borrado con xito","message.search-filters.title":"Filtros de bsqueda","message.field-validation.required":"Este campo es obligatorio","message.boolean.yes":"S","message.boolean.no":"No",DIALOGS_YES:"S",DIALOGS_NO:"No",DIALOGS_CLOSE:"Cerrar","message.tabs.home":"Home","message.tabs.admin":"Admin","message.tabs.entity.search":"Buscar {{ label }}","message.tabs.entity.update":"Actualizar {{ label }} {{ id }}","message.tabs.entity.create":"Crear {{ label }}","message.menu.entity-management":"Gestionar elementos","message.menu-internal-news":"Mensajes internos","field.searchResults.noresults":"Sin resultados","panel.admin-options.title":"Opciones de administracin","panel.admin-options.control-panel":"Administracin","panel.admin-options.sales-panel":"Comercial","panel.select-store.title":"Selecciona tu tienda","field.date-search.comparator":"Comparador","field.date-search.date":"Fecha","field.date-search.otherdate":"Otra fecha","field.date-search.LOWER_THAN":"Anterior","field.date-search.LOWER_EQUALS":"Anterior o igual","field.date-search.EQUALS":"Igual","field.date-search.GREATER_EQUALS":"Posterior o igual","field.date-search.GREATER_THAN":"Posterior","field.date-search.BETWEEN":"Entre","field.number-range.comparator":"Comparador","field.number-range.number":"Valor","field.number-range.othernumber":"Otro valor","field.number-range.LOWER_THAN":"Menor","field.number-range.LOWER_EQUALS":"Menor o igual","field.number-range.EQUALS":"Igual","field.number-range.GREATER_EQUALS":"Mayor o igual","field.number-range.GREATER_THAN":"Mayor","field.number-range.BETWEEN":"Entre","message.table-input.not-yet-configured":"La tabla an no ha sido configurada","field.list-input.actions":"Acciones","field.file-input.upload":"Seleccionar archivo","message.pagination.results-per-page":"Resultados por pgina","message.pagination.results":"Mostrando  resultados {{ (offset-1) * limit + 1 }} a {{ count < ((offset-1)*limit)+limit ? count : ((offset-1)*limit+limit) }} de {{ count }} ","message.single-select.title":"Elija un elemento","message.multi-select.title":"Elija sus elementos","combobox.placeholder":"Seleccionar un valor",DUPLICATED_ELEMENT:"Error de integridad: Ese elemento ya existe","entity.catalog-product-details.cart.add.success":"{{ product.description }} aadido al carrito","entity.catalog-product-details.cart.edit.success":"{{ product.description }} editado con xito","entity.catalog-product-details.cart.add.no-stock":"No hay stock de este producto","entity.catalog-product-details.cart.add.not-enough-stock":"No hay stock de este producto","entity.catalog-product-details.cart.add.from-total-stock":"Este producto pertenece a un almacn externo a Storpanel, y puede estar fuera de su embalaje original."},en:{"message.action.validate":"Validate","message.action.save":"Save","message.action.cancel":"Cancel","message.action.add":"Add","message.action.delete":"Delete","message.action.clean":"Clean","message.action.search":"Search","message.action.close":"Close","message.discard-changes.title":"Confirm your action","message.discard-changes.message":"Do you want to discard your changes?","message.delete-entity.title":"Confirm your action","message.delete-entity.message":"Do you want to remove this item?","message.action-confirmation.create.success":"Item successfully created","message.action-confirmation.update.success":"Item successfully updated","message.action-confirmation.delete.success":"Item successfully deleted","message.search-filters.title":"Search filters","message.field-validation.required":"Mandatory field","message.boolean.yes":"Yes","message.boolean.no":"No",DIALOGS_YES:"Yes",DIALOGS_NO:"No",DIALOGS_CLOSE:"Close","message.tabs.home":"Home","message.tabs.admin":"Admin","message.tabs.entity.search":"Find {{ label }}","message.tabs.entity.update":"Update {{ label }} {{ id }}","message.tabs.entity.create":"New {{ label }}","field.searchResults.noresults":"No results","field.date-search.comparator":"Comparator","field.date-search.date":"Date","field.date-search.otherdate":"Other date","field.date-search.LOWER_THAN":"Lower than","field.date-search.LOWER_EQUALS":"Lower or equal","field.date-search.EQUALS":"Equal","field.date-search.GREATER_EQUALS":"Greater or equal","field.date-search.GREATER_THAN":"Greater","field.date-search.BETWEEN":"Between","field.number-range.comparator":"Comparator","field.number-range.number":"Value","field.number-range.othernumber":"Other value","field.number-range.LOWER_THAN":"Lower than","field.number-range.LOWER_EQUALS":"Lower or equal","field.number-range.EQUALS":"Equal","field.number-range.GREATER_EQUALS":"Greater or equal","field.number-range.GREATER_THAN":"Greater than","field.number-range.BETWEEN":"Between","field.link.text":"Select value","message.table-input.not-yet-configured":"The table hasn't been configured yet","field.list-input.actions":"Actions","field.file-input.upload":"Select file","message.pagination.results-per-page":"Items per page","message.pagination.results":"Showing items {{ (offset-1) * limit + 1 }} to {{ count < ((offset-1)*limit)+limit ? count : ((offset-1)*limit+limit) }} from {{ count }} ","message.single-select.title":"Select an item","combobox.placeholder":"Select a value",DUPLICATED_ELEMENT:"Data integrity exception. Item exists already"},fr:{"message.login.title":"Acceso a la aplicacin","message.login.description":"Introduzca sus datos de acceso para utilizar la aplicacin","message.login.username":"Correo electrnico","message.login.password":"Contrasea","message.login.rememberme":"Recordarme en este equipo","message.login.proceed":"Acceder","message.login.incorrect-data":"Usuario o contrasea invlidos","message.action.validate":"Validar","message.action.save":"Guardar","message.action.cancel":"Cancelar","message.action.add":"Aadir","message.action.delete":"Eliminar","message.action.clean":"Limpiar","message.action.search":"Buscar","message.action.close":"Cerrar","message.action.proceed-order":"Pedido","message.discard-changes.title":"Confirma tu accin","message.discard-changes.message":"Deseas cancelar tus cambios?","message.delete-entity.title":"Confirma tu accin","message.delete-entity.message":"Deseas eliminar este elemento?","message.action-confirmation.create.success":"Elemento creato con xito","message.action-confirmation.update.success":"Elemento actualizado con xito","message.action-confirmation.delete.success":"Elemento borrado con xito","message.search-filters.title":"Filtros de bsqueda","message.field-validation.required":"Este campo es obligatorio","message.boolean.yes":"S","message.boolean.no":"No",DIALOGS_YES:"S",DIALOGS_NO:"No",DIALOGS_CLOSE:"Cerrar","message.tabs.home":"Home","message.tabs.admin":"Admin","message.tabs.entity.search":"Buscar {{ label }}","message.tabs.entity.update":"Actualizar {{ label }} {{ id }}","message.tabs.entity.create":"Crear {{ label }}","message.menu.entity-management":"Gestionar elementos","message.menu-internal-news":"Mensajes internos","field.searchResults.noresults":"Sin resultados","panel.admin-options.title":"Opciones de administracin","panel.admin-options.control-panel":"Administracin","panel.admin-options.sales-panel":"Comercial","panel.select-store.title":"Selecciona tu tienda","field.date-search.comparator":"Comparador","field.date-search.date":"Fecha","field.date-search.otherdate":"Otra fecha","field.date-search.LOWER_THAN":"Anterior","field.date-search.LOWER_EQUALS":"Anterior o igual","field.date-search.EQUALS":"Igual","field.date-search.GREATER_EQUALS":"Posterior o igual","field.date-search.GREATER_THAN":"Posterior","field.date-search.BETWEEN":"Entre","field.number-range.comparator":"Comparador","field.number-range.number":"Valor","field.number-range.othernumber":"Otro valor","field.number-range.LOWER_THAN":"Menor","field.number-range.LOWER_EQUALS":"Menor o igual","field.number-range.EQUALS":"Igual","field.number-range.GREATER_EQUALS":"Mayor o igual","field.number-range.GREATER_THAN":"Mayor","field.number-range.BETWEEN":"Entre","message.table-input.not-yet-configured":"La tabla an no ha sido configurada","field.list-input.actions":"Acciones","field.file-input.upload":"Seleccionar archivo","message.pagination.results-per-page":"Resultados por pgina","message.pagination.results":"Mostrando  resultados {{ (offset-1) * limit + 1 }} a {{ count < ((offset-1)*limit)+limit ? count : ((offset-1)*limit+limit) }} de {{ count }} ","message.single-select.title":"Elija un elemento","combobox.placeholder":"Seleccionar un valor",DUPLICATED_ELEMENT:"Error de integridad: Ese elemento ya existe","entity.catalog-product-details.cart.add.success":"{{ product.description }} aadido al carrito","entity.catalog-product-details.cart.edit.success":"{{ product.description }} editado con xito","entity.catalog-product-details.cart.add.no-stock":"No hay stock de este producto","entity.catalog-product-details.cart.add.not-enough-stock":"No hay stock de este producto","entity.catalog-product-details.cart.add.from-total-stock":"Este producto pertenece a un almacn externo a Storpanel, y puede estar fuera de su embalaje original."}}),angular.module("konga").run(["$templateCache",function($templateCache){$templateCache.put("/konga/views/about.html","<p>This is the about view.</p>\n"),$templateCache.put("/konga/views/app-loader.html","Loading..."),$templateCache.put("/konga/views/calendar-input.html",'<div ui-calendar="uiConfig.calendar" ng-model="value.entity"></div>'),$templateCache.put("/konga/views/cascade-result-table.html",'<table class="table table-result">\n	<thead>\n		<tr class="table-header">\n			<th ng-repeat="field in fields | allowed:\'results\'" style="cursor: pointer;">\n				<table-header field="field" sorting="sorting" showSorting="showSorting" mode="results"></table-header>\n			</th>\n		</tr>\n	</thead>\n	<tbody>\n		<tr	ng-class="{editable: isEditable, resultClick: entityMetadata.resultClick.length}" \n			ng-repeat="entity in entities"\n			ng-click="resultClick(entityMetadata, entity, $index)" ng-show="entities.length > 0">\n			<td ng-repeat="field in fields | allowed:\'results\'">\n				<table-cell entity="entity" field="field"></table-cell>\n			</td>\n		</tr>\n		<tr ng-hide="entities.length > 0" ng-if="entities.$resolved !== false">\n			<td colspan="{{ fields.length }}" class="text-center">{{\'field.searchResults.noresults\' | translate }}</td>\n		</tr>\n		<tr ng-if="entities.$resolved === false">\n			<td colspan="{{ fields.length }}" class="text-center">\n				<i class="fa fa-circle-o-notch fa-spin"></i>\n			</td>\n		</tr>\n	</tbody>\n</table>'),$templateCache.put("/konga/views/cascade-search-pane.html",'<raw-input \n	property="field"\n	vertical="true" \n	source-list="productCodes[field.name]"\n	ng-repeat="field in fields | searchParams | orderBy:\'priority.search\' | allowed:\'search\'"\n	entity="query" \n	metadata="entityMetadata" \n	on-update="operations.updateField"\n	mode="search"\n	index="$index">\n</raw-input>'),$templateCache.put("/konga/views/cascade-update.html",'<div class="form-cascade">\n	<raw-input \n		property="field"\n		vertical="true"\n		ng-repeat="field in fields | updateParams:metadata | orderBy:\'+priority.update\' | allowed:\'update\'" \n		entity="entity" \n		on-update="onUpdate"\n		on-change="onChange"\n		metadata="metadata"\n		mode="update"\n		creating="creating"\n		index="$index">\n	</raw-input>\n</div>'),$templateCache.put("/konga/views/categorized_cascade-result-table.html",'<table class="table table-result" cellpadding="0" cellspacing="0" border="0">\n	<thead>\n		<tr class="table-header categories">\n			<th ng-repeat="category in categories" style="cursor: pointer;" colspan="{{ categoryFields[category.name].length }}" ng-class="{ noHeader: !category.showHeader }">\n				<span ng-if="category.showHeader">{{ category.name | translate }}</span>\n			</th>\n		</tr>\n		<tr class="table-header">\n			<th ng-repeat="field in sortedFieldsByCategory" style="cursor: pointer;">\n				<table-header field="field" sorting="sorting" showSorting="showSorting" mode="results"></table-header>\n			</th>\n		</tr>\n	</thead>\n	<tbody>\n		<tr	ng-class="{editable: entityMetadata.editable !== null, resultClick: entityMetadata.resultClick.length}" \n			ng-repeat="entity in entities"\n			ng-click="resultClick(entityMetadata, entity)" ng-show="entities.length > 0">\n			<td ng-repeat="field in sortedFieldsByCategory">\n				<table-cell entity="entity" field="field"></table-cell>\n			</td>\n		</tr>\n		<tr ng-hide="entities.length > 0" ng-if="entities.$resolved !== false">\n			<td colspan="{{ fields.length }}" class="text-center">{{\'field.searchResults.noresults\' | translate }}</td>\n		</tr>\n		<tr ng-if="entities.$resolved === false">\n			<td colspan="{{ fields.length }}" class="text-center">\n				<i class="fa fa-circle-o-notch fa-spin"></i>\n			</td>\n		</tr>\n	</tbody>\n</table>'),$templateCache.put("/konga/views/categorized_cascade-search-pane.html",'<div ng-repeat="category in categories" ng-if="(fields | searchParams | filter:{ categories: category }).length > 0">\n	<h4>{{ category | translate }}</h1>\n	<raw-input \n		property="field"\n		vertical="true" \n		source-list="productCodes[field.name]"\n		ng-repeat="field in fields | searchParams | filter:{ categories: category } | orderBy:\'priority.search\'"\n		entity="query" \n		metadata="entityMetadata" \n		on-update="operations.updateField"\n		mode="search"\n		index="$index">\n	</raw-input>\n</div>'),$templateCache.put("/konga/views/custom_tabbed-update.html",'<vertical-tabs>\n	<tab-content ng-repeat="fs in fieldsets" title="{{fs.name | translate}}" tab-id="fs.name" is-show="true">\n		<div ng-include="getView(fs.configuration.view)"></div>\n	</tab-content>\n</vertical-tabs>'),$templateCache.put("/konga/views/entity-details.html","<p>This is the entity-details view.</p>\n"),$templateCache.put("/konga/views/entity-search.html",'<div class="wall" ng-init="init()">\n	<div class="entity-search">\n		<div class="col-md-3 search-panel" ng-class="filterClass">\n			<search-pane \n					entity-metadata="entityMetadata"\n					query="query"  \n					on-submit="submit"\n					on-dispatch="dispatchSearchAction">\n			</search-pane>\n		</div>\n		<div ng-class="{ \'col-md-9\': !!filterOpened, \'col-md-12\': !filterOpened }">\n			<!-- ng-show="hideSearchSpiner"> -->\n			<div class="row">\n				<div class="col-md-12">\n					<div class="col-md-3 quickSearchBox" ng-show="paginationData[entityType].count > 0 || quickSearchEnabled">\n						<div class="form-inline">\n							<div class="form-group" ng-repeat="quickSearchField in quickSearch">\n								<div class="input-group margin-bottom">\n									<div class="input-group-addon" ng-click="toggleFilter()" ng-class="{\'text-warning\': !filterOpened}">\n										&nbsp;\n										<i class="glyphicon glyphicon-filter"></i>\n										&nbsp;\n									</div>\n									<input type="text" class="form-control" placeholder="{{quickSearchField.metadata.label | translate:quickSearchField.extra }}" ng-model="quickSearchField.value" ng-change="executeQuickSearch()" id="quick-search-{{ quickSearchField.metadata.name }}">\n								</div>\n							</div>\n						</div>\n					</div>\n					<div class="col-md-3 form-inline numItemsBox" ng-show="paginationData[entityType].count > 0">\n						<div class="form-group">\n							<label class="control-label font-normal">\n								{{ \'message.pagination.results-per-page\' | translate }}\n							</label>\n							<select class="form-control" ng-model="paginationCount" ng-change="paginationSubmit()">\n								<!-- <option>10</option> -->\n								<option value="20">20</option>\n								<option value="50">50</option>\n								<option value="100">100</option>\n							</select>\n						</div>\n					</div>\n					<div class="col-md-6 text-right" ng-show="paginationData[entityType].count > 0">\n						<div class="form-inline">\n							<div class="form-group">\n								{{ \'message.pagination.results\' | translate:paginationData[entityType] }}\n							</div>\n							<div class="form-group">\n								<pagination boundary-links="true" total-items="paginationData[entityType].count" items-per-page="paginationData[entityType].limit" max-size="4" rotate="false" ng-model="paginationData[entityType].offset" ng-change="paginationSubmit()" class="pagination-sm" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;">\n								</pagination>	\n							</div>\n						</div>\n					</div>\n				</div>\n			</div>\n			<div class="row result-table">\n				<result-table entities="searchResults" \n								entity-metadata="entityMetadata" \n								on-update="operations.openEntityUpdate" \n								pagination-data="paginationData[entityType]"\n								pagination-update="paginationUpdate"\n								filter-code="quickSearchParams.value[codeField]"\n								on-sorting="submitSorting">\n				</result-table>\n			</div>\n			<div class="row">\n				<div class="col-md-12">\n					<div class="col-md-6 text-right col-md-offset-6" ng-show="paginationData[entityType].count > 0">\n						<div class="form-inline">\n							<div class="form-group">\n								{{ \'message.pagination.results\' | translate:paginationData[entityType] }}\n							</div>\n							<div class="form-group">\n								<pagination boundary-links="true" total-items="paginationData[entityType].count" items-per-page="paginationData[entityType].limit" max-size="4" rotate="false" ng-model="paginationData[entityType].offset" ng-change="paginationSubmit()" class="pagination-sm" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;">\n								</pagination>	\n							</div>\n						</div>\n					</div>\n				</div>\n			</div>\n			<div class="row chantier-btn-list">\n				<div class="actions pull-right">\n					<button class="btn btn-primary" ng-click="operations.openEntityCreate(entityMetadata)" ng-show="isCreateable" id="create-entity">\n						<i class="icon fa fa-plus"></i>\n						{{ \'message.action.add\' | translate }}\n					</button>\n					<button class="btn btn-default" ng-repeat="action in entityMetadata.actions" ng-model="action" ng-click="dispatchSearchAction(action)" ng-show="action.scope===\'SEARCH\' || action.scope===\'RESULTS\'" id="search-action-dispatcher-{{ action.name }}">\n						<i ng-class="action.icon" ng-show="action.icon.length"></i>\n						{{ action.label | translate }}\n					</button>\n				</div>\n			</div>\n		</div>\n\n		<!-- TODO Uncomment -->\n		<!-- <div class="col-md-9 searchLoader" ng-hide="hideSearchSpiner">\n			<div class="png-spiner-container"></div>\n		</div> -->\n	</div>\n</div>\n<div class="open-filters" ng-if="entityMetadata.searchable !== null" ng-show="!filterOpened">\n	\n</div>'),
$templateCache.put("/konga/views/entity-update.html",'<div class="wall">\n	<div class="panel-body">\n		<form ng-class="formStyle" role="form" name="entityUpdate" novalidate>\n			<update-form entity="entity" changes="changes" metadata="entityMetadata" params="params" on-change="operations.changeEntityField" on-update="operations.updateEntityField" creating="creating"></update-form>\n			<div class="pull-right update-btn-group" ng-if="showActions">\n				<button class="btn btn-default" ng-repeat="action in entityMetadata.actions" ng-model="action" ng-click="operations.dispatchAction(action)" ng-show="action.scope===\'UPDATE\'" ng-disabled="action.scope!==\'UPDATE\'" id="update-action-dispatcher-{{ action.name }}">\n							{{ action.label | translate }}\n				</button>\n				<button type="submit" class="btn btn-success" ng-click="operations.dispatchEntityAction(\'save\', params)" ng-disabled="entityUpdate.$invalid || !changes.length || invalid || (entityMetadata.name===\'Materiel\' && !entity.validCtrOperat && entity.id != null) || customDisableValider || alreadyValidated" id="save-entity">	\n					<i class="glyphicon glyphicon-ok"></i>\n					{{ \'message.action.validate\' | translate }}\n				</button>\n				<button class="btn btn-default" ng-click="operations.cancelUpdate()" id="cancel-update">\n					<i class="glyphicon glyphicon-remove"></i>\n					{{ \'message.action.cancel\' | translate }}\n				</button>\n				<button class="btn btn-danger" ng-click="operations.deleteEntity()" ng-hide="deletable == false" id="delete-entity" ng-disabled="disabledDelete">\n					<i class="glyphicon glyphicon-trash"></i>\n					{{ \'message.action.delete\' | translate }}\n				</button>\n			</div>\n		</form>\n	</div>\n</div>'),$templateCache.put("/konga/views/file-input.html",'<div class="col-md-12 file-input">\n	<button multiple="{{ property.multiplicity === \'MANY\' }}" ng-file-select ng-model="value.files">\n	<i class="glyphicon glyphicon-open"></i>\n	{{ \'field.file-input.upload\' | translate }}\n</button>\n\n<!-- TODO Include more stuff -->\n</div>'),$templateCache.put("/konga/views/footer.html","<div class=\"container\">\n	<p>{{ 'message.common.footer' | translate }}</p>\n</div>"),$templateCache.put("/konga/views/konga-content-plain.html",'<div class="konga-container plain-app">\n	<div class="pwd text-center">\n        <h1>\n            <i class="{{ (tabs | filter:{ id: tabId })[0].type }}"></i>\n            {{ (tabs | filter:{ id: tabId })[0].title | translate:tabExtra[tabId] }}\n        </h1>\n    </div>\n	<div ng-view></div>\n</div>'),$templateCache.put("/konga/views/konga-content-tabs.html",'<div class="container">			\n	<div id="konga-nav-tabs" class="container-fluid">\n		<!--<div bs-tabs="tabs" ng-model="tabs.activeTab"></div>-->\n\n	<tabset>			    \n	    <tab ng-repeat="tab in tabs" active="tab.active" select="operations.redirectTo(tab)">\n	    	<tab-heading>\n	    		<i ng-class="tab.type"></i></span>\n		        <span class="tab-heading-title">{{ tab.title | translate:tabExtra[tab.id] }}{{ tab.hasChanges ? \'*\' : \'\' }}\n		        <i class="glyphicon glyphicon-remove tab-close-btn" ng-click="operations.closeTab(tab, false)" ng-show="tab.closable"></i></span>\n		    </tab-heading>\n		    \n		</tab>\n	</tabset>\n	<!-- Tab panes Container-->\n	<div class="view-container">\n		<div ng-view></div>\n	</div>\n	</div><!-- End of navTab -->\n</div>'),$templateCache.put("/konga/views/konga-content.html",'<div ng-include="contentView"></div>'),$templateCache.put("/konga/views/list-input.html",'<div class="list-input padding-cero">\n	<div ng-if="paginate && filteredList.length > 10">\n		<!-- ng-show="hideSearchSpiner"> -->\n		<div class="row">\n			<div class="col-md-4 form-inline position-pagination" style="margin-top:10px" ng-show="paginationData.count">\n				<label class="control-label font-normal">\n					{{ \'message.pagination.results-per-page\' | translate }}\n				</label>\n				<select class="form-control" ng-model="paginationData.limit" ng-change="pageChanged()">\n					<option>10</option>\n					<option>20</option>\n					<option>50</option>\n				</select>\n			</div>\n			<div class="col-md-6 text-right" ng-show="paginationData.count">\n				<div class="form-inline">\n					<div class="form-group">\n						<span class="total-items">{{\'message.pagination.results\' | translate:paginationData }}</span>\n					</div>\n					<div class="form-group">\n						<pagination boundary-links="true" total-items="paginationData.count" items-per-page="paginationData.limit" max-size="2" rotate="false" ng-model="paginationData.offset" ng-change="paginationSubmit()" class="pagination-sm" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"> </pagination>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n	<div>\n		<table class="table table-striped">\n			<thead>\n				<tr class="table-header">\n					<th ng-repeat="field in fields">\n						<table-header field="field" showSorting="showSorting" mode="update"></table-header>\n					</th>\n					<th ng-show="actions && actions.length">\n						<span>{{ \'field.list-input.actions\' | translate }}</span>\n					</th>\n					\n				</tr>\n			</thead>\n			<tbody>\n				<tr ng-hide="filteredList.length > 0">\n					<td colspan="{{ fields.length + 1 }}" class="text-center no-results">{{\'field.searchResults.noresults\' | translate }}</td>\n				</tr>\n				<tr ng-show="filteredList.length>0" ng-repeat="entity in filteredList | filter:quickSearchParams.value">\n					<!-- <td>\n						<div class="checkbox">\n						  <label>\n						    <input id="checkbox.id-list-input" type="checkbox" ng-model="entity.selected" ng-change="pageChanged()" ng-disabled="disabledIds[entity.id]">\n						  </label>\n						</div>\n					</td> -->\n					<td ng-repeat="field in fields">\n						<table-cell entity="entity" field="field"></table-cell>\n					</td>\n	<!-- 					<table-cell entity="entity" field="field"></table-cell> -->\n					<td ng-show="actions && actions.length">\n						<button class="btn btn-link no-button-styles" ng-repeat="action in actions" ng-click="dispatchFieldAction(action.name, {entity: entity})" id="{{ fieldId + \'-\' + action.name }}">\n							<i ng-class="action.icon" ng-show="action.icon.length"></i>\n							{{ action.label | translate }}\n						</button>\n						&nbsp;\n					</td>\n				</tr>\n				<tr ng-hide="disableField(mode, property)">\n					<td colspan="{{ fields.length + 1 }}" class="text-center">\n						<button class="btn btn-link" ng-click="dispatchFieldAction(\'add\')" id="{{ fieldId }}-add">\n							<i class="glyphicon glyphicon-plus"></i>\n							{{ \'message.action.add\' | translate }}\n						</button>\n					</td>\n				</tr>\n			</tbody>\n		</table>\n	</div>\n</div>'),$templateCache.put("/konga/views/loader.html",'<div class="loader" ng-show="loading.length > 0">\n	<div class="blocker"></div>\n	<div class="loading"></div>\n	<div class="message">{{ loadingMessage }}</div>\n</div>'),$templateCache.put("/konga/views/main.html",'\n<!-- Alerts -->\n<div class="alert-container">\n	<alert ng-repeat="alert in alerts" type="{{alert.type}}" close="operations.removeAlert($index)" ng-show="!alert.expired" class="alert">\n		{{alert.msg | translate:alert.parameters}}\n	</alert>\n</div>\n\n<!-- TODO Include header -->\n\n<!-- Content -->\n<div id="wrapper">\n	<div id="content" >\n		<konga-content></konga-content>\n	</div>\n</div>'),$templateCache.put("/konga/views/modal.tpl.html",'<div class="modal" tabindex="-1" role="dialog">\n\n  <!-- Dialog for the modal -->\n  <div class="modal-dialog">\n\n    <!-- Content for the modal -->\n    <div class="modal-content">\n\n      <!-- Header of the modal -->\n      <div class="modal-header" ng-show="modal.title">\n\n        <!-- Close button -->\n        <button id="modal-tpl-closeX" type="button" class="close" ng-click="">&times;</button>\n\n        <!-- Title -->\n        <h4 class="modal-title" ng-bind="modal.title"></h4>\n      </div>\n\n      <!-- Body -->\n      <div class="modal-body">\n\n        <!-- Include content -->\n        <div ng-include="modal.contentUrl"></div>\n      </div>\n\n      <!-- Footer of the modal -->\n      <div class="modal-footer">\n\n        <!-- Close button -->\n        <button type="button" class="btn btn-default" id="modal-save" ng-click="modal.save();$hide()">{{ \'message.action.validate\' | translate }}</button>\n        <button type="button" class="btn btn-default" id="modal-cancel" ng-click="$hide()">{{ \'message.action.cancel\' | translate }}</button>\n        \n      </div>\n    </div>\n  </div>\n</div>'),$templateCache.put("/konga/views/multi-select-modal.html",'<!-- Multi select for modal views -->\n<multi-select source-list="sourceList" model="modal.temp"></multi-select>'),$templateCache.put("/konga/views/multi-select.html",'<div class="multi-select" ng-init="operations.init()">\n	<div class="modal-header" ng-show="true">\n	    <!-- Close button -->\n	    <button id="multiselectModal.cancelX.id" type="button" class="close" ng-click="multiselectModal.cancel()">&times;</button>\n\n		<div class="filter">\n			<div class="form-inline" ng-repeat="quickSearchItem in quickSearch">\n				<div class="form-group">\n					<!-- <label for="filter" class="control-label col-md-4">5 rsultats</label> -->\n					<div class="col-md-12">\n						<div class="input-group">\n						  <span class="input-group-addon">\n						  	&nbsp;\n						  	<i class="glyphicon glyphicon-filter"></i>\n						  	&nbsp;\n						  </span>\n						  <input type="text" id="multi-select-filter" class="form-control" name="filter" ng-model="quickSearchItem.value" placeholder="{{quickSearchItem.metadata.label | translate:quickSearchItem.extra }}" ng-change="executeQuickSearch()" />\n						</div>\n					</div>\n				</div>\n			</div>\n		</div>\n\n	    <!-- Title -->\n		<h4 class="modal-title">{{ \'message.multi-select.title\' | translate }}</h4>\n  	</div>\n	<div class="col-md-5 multi-select-modal-body-item">\n		<div class="multiselect-list list-group" scroll-watcher>\n			<a class="list-group-item"\n				ng-repeat="item in sourceList | filter:filter.value | filter: {added: false} | orderBy: \'+key\'"\n				ng-click="operations.toggle(item, !item.selected)"\n				ng-dblclick="operations.toggle(item, true);operations.add()"\n				ng-class="{selected: item.selected}">\n				<h5>\n					{{ item.key }} <small>{{ item.value | translate }}</small>\n				</h5>\n			</a>\n			<div class="loading-data" ng-if="loading">&nbsp;</div>\n		</div>\n	</div>\n	<div class="col-md-2 multi-select-modal-body-item center">\n		<div class="add-remove-btn">\n			<button id="add-multi-select.id" type="button" class="btn btn-default" ng-click="operations.add()">\n				<i class="icon fa fa-chevron-right"></i>\n			</button>\n			<button id="remove-multi-select.id" type="button" class="btn btn-default" ng-click="operations.remove()">\n				<i class="icon fa fa-chevron-left"></i>\n			</button>\n		</div>\n		<div class="add-remove-btn">\n			<button id="addAll-button.id" type="button" class="btn btn-default bulk-option" ng-click="operations.addAll()">\n				<i class="icon icon-add-remove-all fa fa-chevron-right"></i><i\n					class="icon icon-add-remove-all fa fa-chevron-right"></i>\n			</button>\n			<button id="removeAll-button.id" type="button" class="btn btn-default bulk-option" ng-click="operations.removeAll()">\n				<i class="icon icon-add-remove-all fa fa-chevron-left"></i><i\n					class="icon icon-add-remove-all fa fa-chevron-left"></i>\n			</button>\n		</div>\n	</div>\n	<div class="col-md-5 multi-select-modal-body-item">\n		<div class="multiselect-list list-group">\n			<a a class="list-group-item"\n				ng-repeat="item in sourceList | filter: {added: true} | orderBy: \'+key\'"\n				ng-click="operations.toggle(item)" \n				ng-dblclick="operations.toggle(item, true);operations.remove()"\n				ng-class="{selected: item.selected}">\n				<h5>   \n					{{ item.key }} <small>{{ item.value | translate }}</small>\n				</h5>\n			</a>\n		</div>\n	</div>\n	<div class="clear">&nbsp;</div>\n	<div class="modal-footer">\n		<!-- Close button -->\n		<button  type="button" class="btn btn-success" ng-click="multiselectModal.save()" id="multi-select-save">\n			<i class="glyphicon glyphicon-ok"></i>\n			{{ \'message.action.validate\' | translate }}\n		</button>\n		<button  type="button" class="btn btn-default" ng-click="multiselectModal.cancel()" id="multi-select-cancel">\n			<i class="glyphicon glyphicon-remove"></i>\n			{{ \'message.action.cancel\' | translate }}\n		</button>\n		\n	</div>\n</div>'),$templateCache.put("/konga/views/ng-view.html",'<div class="view-container">\n	<div ng-view></div>\n</div>'),$templateCache.put("/konga/views/number-input.html",'<input name="{{property.name }}"type="number"\n	class="form-control konga-form-search-input konga-form-simple-search-input"\n	id="{{ fieldId }}" placeholder="" ng-model="value.text"\n 	ng-disabled="disableField(mode, property)"\n	angular.module(\'konga\') ng-required="validation.required()" min="{{ validation.minvalue() }}" max="{{ validation.maxvalue() }}" tabindex="{{ (index + 1) * 12 }}" step="{{ stepConf}}">'),$templateCache.put("/konga/views/option-input.html","<p>This is the option-input view.</p>\n"),$templateCache.put("/konga/views/price-input.html",'<div class="input-group">\n  <input name="{{property.name }}" type="text" class="form-control text-right"\n	id="{{ fieldId }}" placeholder="" ng-model="inner.text" ng-change="formatInput()"\n 	ng-disabled="disableField(mode, property)"\n	angular.module(\'konga\') ng-required="validation.required()" aria-describedby="{{fieldId}}_addon">\n  <span class="input-group-addon" id="{{fieldId}}_addon">&nbsp;<b>{{ currency }}&nbsp;</b></span>\n</div>'),$templateCache.put("/konga/views/quantity-input.html",'<div class="input-group">\n	<input type="number" class="form-control text-right" id="{{ fieldId }}" placeholder="" ng-model="value.text" ng-disabled="disableField(mode, property)" ng-pattern="validation.pattern()" ng-required="validation.required()" maxlength="{{ validation.maxlength() }}" aria-describedby="{{ fieldId }}_addon" step="{{ step }}" konga-field-name="fieldId" inputFormat>\n	<span class="input-group-addon" id="{{ fieldId }}_addon">&nbsp; {{ unit }} &nbsp;</span>\n</div>'),$templateCache.put("/konga/views/raw-boolean-input.html",'<div class="radio-inline">\n	<label for="{{ fieldId }}-true">\n		<input name="{{property.name }}"type="radio" name="{{property.name}}" ng-value="true" ng-model="value.text" id="{{ fieldId }}-true" ng-disabled="disableField(mode, property)">\n		{{ true | activeInactive:property:mode | translate }}\n	</label>\n</div>\n<div class="radio-inline">\n	<label for="{{ fieldId }}-false">\n		<input type="radio" name="{{property.name}}" ng-value="false" ng-model="value.text" id="{{ fieldId }}-false" ng-disabled="disableField(mode, property)">\n		{{ false | activeInactive:property:mode | translate }}\n	</label>\n</div>'),$templateCache.put("/konga/views/raw-calendar-input.html","<calendar-input></calendar-input>"),$templateCache.put("/konga/views/raw-checkbox-input.html",'<div class="checkbox-inline">\n	<label for="{{ fieldId }}-true"> <input name="{{property.name }}"type="checkbox" ng-value="true" ng-model="value.active" id="{{ fieldId }}-true"> \n		{{ true | activeInactive:property | translate}}\n	</label>\n</div>\n<div class="checkbox-inline">\n	<label for="{{ fieldId }}-false"> <input name="{{property.name }}"type="checkbox" ng-value="false" ng-model="value.inactive" id="{{ fieldId }}-false">\n		{{ false | activeInactive:property | translate}}\n	</label>\n</div>'),$templateCache.put("/konga/views/raw-color-input.html",'<input name="{{property.name }}" type="color" class="form-control konga-form-search-input" id="{{ fieldId }}" placeholder="" ng-model="value.text" ng-disabled="disableField(mode, property)" angular.module(\'konga\') ng-required="validation.required()" maxlength="{{ validation.maxlength() }}">\n<!-- TODO This is not working (yet) -->\n<!-- ng-minlength="property.minLength"\nng-maxlength="property.maxLength" -->\n<!-- <div class="input-group-addon bg-invalid">\n	<button type="button" class="btn btn-link">\n		<i class="glyphicon glyphicon-remove text-bg-invalid"></i>\n	</button>\n</div> -->'),$templateCache.put("/konga/views/raw-combobox-input.html",'<button type="button" class="btn btn-default combobox-button" ng-model="value.text" ng-disabled="disableField(mode, property)" ng-required="validation.required()" data-html="0" bs-options="item.key as item.value | translate for item in value.list" data-animation="am-flip-x" data-placeholder="{{ \'combobox.placeholder\' | translate }}" bs-select ng-if="!multiple">\n	Action <span class="caret"></span>\n</button>\n<button type="button" class="btn btn-default combobox-button" ng-model="value.text" ng-disabled="disableField(mode, property)" ng-required="validation.required()" data-html="0" bs-options="item.key as item.value | translate for item in value.list" data-multiple="{{ multiple }}" data-animation="am-flip-x" data-placeholder="{{ \'combobox.placeholder\' | translate }}" bs-select ng-if="multiple">\n	Action <span class="caret"></span>\n</button>'),$templateCache.put("/konga/views/raw-complex-input.html",'<div class="complex-container" ng-init="hideGlobalValidation()">\n	<raw-input \n		property="field"\n		vertical="true" \n		ng-repeat="field in value.fields"\n		entity="entity[$parent.property.name]"\n		root-entity="entity" \n		metadata="value.metadata"\n		root-metadata="metadata"\n		on-update="updateEntity"\n		on-change="changeEntity"\n		mode="{{mode}}"\n		parent-field="$parent.property"\n		creating="creating"\n		index="index + $index">\n	</raw-input>\n</div>'),$templateCache.put("/konga/views/raw-css-input.html",'<div ng-class="value.text"></div>'),$templateCache.put("/konga/views/raw-date-input.html",'<input name="{{property.name }}" id="{{ fieldId }}" type="date" placeholder="yyyy-MM-dd" ng-model="value.text" name="{{property.fieldName}}"\n		class="form-control" ng-required="validation.required()" ng-disabled="disableField(mode, property)" value="{{ value.text }}">\n\n<div class="validation">\n	<div class="validation-invalid-date btn-danger">\n		{{	\'message.field-validation.invalid-date\' | translate }}\n	</div>\n</div>'),$templateCache.put("/konga/views/raw-date-search-input.html",'<div class="padding-cero">\n	<label>{{ \'field.date-search.comparator\' | translate }}</label>\n	<select name="comparator" ng-model="value.date.comparator"\n		class="form-control" ng-required="ngRequired" id="{{ fieldId }}-comparator">\n		<option value="LOWER_THAN">{{ \'field.date-search.LOWER_THAN\' | translate }}</option>\n		<option value="LOWER_EQUALS">{{ \'field.date-search.LOWER_EQUALS\' | translate }}</option>\n		<option value="EQUALS">{{ \'field.date-search.EQUALS\' | translate }}</option>\n		<option value="GREATER_EQUALS">{{ \'field.date-search.GREATER_EQUALS\' | translate }}</option>\n		<option value="GREATER_THAN">{{ \'field.date-search.GREATER_THAN\' | translate }}</option>\n		<option value="BETWEEN">{{ \'field.date-search.BETWEEN\' | translate }}</option>\n	</select>\n</div>\n<div class="padding-cero">\n	<label for="{{ fieldId }}-dateSince">{{ \'field.date-search.date\' | translate }}</label>\n	<input name="{{property.name }}"type="date" name="date-since" ng-model="value.date.startDate"\n		class="form-control" ng-required="ngRequired" id="{{ fieldId }}-dateSince"\n</div>\n<div class="padding-cero" ng-show="value.date.comparator == \'BETWEEN\'">\n	<label for="{{ fieldId }}-dateTo">{{ \'field.date-search.otherdate\' | translate }}</label>\n	<input name="{{property.name }}"type="date" name="to" ng-model="value.date.endDate"\n		class="form-control" ng-required="ngRequired" id="{{ fieldId }}-dateTo">\n</div>\n<!-- <div class="col-md-2 padding-cero">\n	<button id="toggleDatePicker.id" type="button" class="btn btn-default"\n		ng-click="toggleDatePicker()">\n		<i class="icon fa fa-ios7-calendar-outline"></i>\n	</button>\n</div> -->\n<!-- <datepicker ng-model="value.text" show-weeks="true"\n	class="well well-sm" ng-show="datePicker.opened"></datepicker> -->'),$templateCache.put("/konga/views/raw-datetime-input.html",'<div class="dropdown">\n  <a class="dropdown-toggle" id="dropdown2" role="button" data-toggle="dropdown" ng-disabled="disableField(mode, property)" data-target="#" href="#">\n    <div class="input-group">\n    	<div class="input-datetimepicker" ng-model="value.text">\n	    	<input name="{{property.name }}"id="{{ fieldId }}" type="text" class="form-control" name="{{property.fieldName}}"\n					placeholder="dd/MM/yyyy HH:mm" value="{{ value.text | date:\'dd/MM/yyyy HH:mm\' }}" ng-required="validation.required()" ng-disabled="disableField(mode, property)">\n			<div></div>\n    	</div>\n		<div class="input-group-addon">\n			<button type="button" class="btn btn-link" ng-disabled="disableField(mode, property)"id="raw-input-dateHeure-releve-select">\n				<i class="glyphicon glyphicon-calendar"></i></button>\n		</div>\n    </div>\n  </a>\n  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">\n    <datetimepicker data-ng-model="value.text" data-datetimepicker-config="{ dropdownSelector: \'#dropdown2\' }" />\n  </ul>\n</div>\n\n<div class="validation">\n	<div class="validation-invalid-date btn-danger">\n		{{	\'message.field-validation.invalid-date\' | translate }}\n	</div>\n	<div class="validation-required btn-danger">{{\n		\'message.field-validation.required\' | translate }}\n	</div>\n</div>\n'),$templateCache.put("/konga/views/raw-file-input.html","<file-input></file-input>"),$templateCache.put("/konga/views/raw-image-input.html",'<!-- <input name="{{property.name }}"type="text" class="form-control konga-form-search-input" id="{{ fieldId }}" placeholder="" ng-model="value.text" ng-disabled="disableField(mode, property)" angular.module(\'konga\') ng-required="validation.required()" maxlength="{{ validation.maxlength() }}"> -->\n\n<img ng-src="{{ value.text }}" width="200" />'),$templateCache.put("/konga/views/raw-input.html",'<div class="raw-input" ng-hide="config.hidden" ng-class="{ empty: config.init }">\n	<div class="row form-group mode-{{ mode }} {{ parentField ? \'derived\' : \'\' }} {{(isExtended) ? \'extended\' : \'\' }} {{displayMode}}">\n		<label class="col-xs-12 col-sm-12 col-md-6 col-lg-4">\n			{{property.label | translate:extra }}\n			<strong class="required asterisk" ng-if="validation.required()">*</strong>\n		</label>\n		<div ng-class="{ \'derived\': !!parentField, \'full-width-component\': ([\'COMPLEX\', \'TABLE\', \'PICK_LIST\', \'CALENDAR\'].indexOf(property.fieldType[mode]) !== -1) }" class="col-xs-12 col-sm-12 col-md-6 col-lg-8">\n			<div ng-include="contentUrl" ng-class="classFormInput"></div>\n		</div>\n		<div class="col-xs-12 col-sm-12 col-md-8 col-md-offset-6 col-lg-10 col-lg-offset-4" ng-if="property.hint && config.showHint">\n			<span class="text-muted">{{ property.hint | translate:extra}}</span>\n		</div>\n		<div ng-if="globalValidation" ng-hide="config.init" class="col-xs-12 col-sm-12 col-md-8 col-md-offset-6 col-lg-10 col-lg-offset-4">\n			<div class="validation-required text-danger" ng-show="!validation.valid_required()" >\n				<i class="glyphicon glyphicon-remove"></i>\n				{{ \'message.field-validation.required\' | translate:extra }}\n			</div>\n		</div>\n	</div>\n</div>'),$templateCache.put("/konga/views/raw-link-input.html",'<button class="btn btn-link" ng-click="dispatchFieldAction(\'open-link\')" ng-init="hideGlobalValidation()">\n	<i class="glyphicon glyphicon-plus" ng-if="creating"></i>\n	<i class="glyphicon glyphicon-pencil" ng-if="!creating"></i>\n	<span>{{ \'field.link.text\' | translate }}</span>\n</button>'),$templateCache.put("/konga/views/raw-list-input.html",'<div class="padding-cero" ng-class="inLineClass.col1">\n	<label for="{{ fieldId }}">{{property.fieldLabel | translate:extra }}</label>\n</div>\n<div class="input-group" ng-class="inLineClass.col3">\n	<list-input fields="entityFields" list="value.list" eds-type="societe" disabled-ids="[]"></list-input>\n</div>\n<div class="row">\n	<div class="col-md-12">\n		<button class="btn btn-default" ng-click="openMultiSelect()" id="{{ fieldId }}-add">{{\'message.action.add\' | translate}}</button>\n	</div>\n</div>'),$templateCache.put("/konga/views/raw-number-input.html","<number-input></number-input>"),$templateCache.put("/konga/views/raw-number-range-input.html",'<div class="padding-cero">\n	<label>{{ \'field.number-range.comparator\' | translate }}</label>\n	<select name="comparator" ng-model="value.range.comparator"\n		class="form-control" ng-required="ngRequired" id="{{ fieldId }}-comparator">\n		<option value="LOWER_THAN">{{ \'field.number-range.LOWER_THAN\' | translate }}</option>\n		<option value="LOWER_EQUALS">{{ \'field.number-range.LOWER_EQUALS\' | translate }}</option>\n		<option value="EQUALS">{{ \'field.number-range.EQUALS\' | translate }}</option>\n		<option value="GREATER_EQUALS">{{ \'field.number-range.GREATER_EQUALS\' | translate }}</option>\n		<option value="GREATER_THAN">{{ \'field.number-range.GREATER_THAN\' | translate }}</option>\n		<option value="BETWEEN">{{ \'field.number-range.BETWEEN\' | translate }}</option>\n	</select>\n</div>\n<div class="padding-cero">\n	<label for="{{ fieldId }}-dateSince">{{ \'field.number-range.number\' | translate }}</label>\n	<input name="{{property.name }}" type="number" name="from" ng-model="value.range.from"\n		class="form-control" ng-required="ngRequired" id="{{ fieldId }}-dateSince"\n</div>\n<div class="padding-cero" ng-show="value.range.comparator == \'BETWEEN\'">\n	<label for="{{ fieldId }}-dateTo">{{ \'field.number-range.othernumber\' | translate }}</label>\n	<input name="{{property.name }}" type="number" name="to" ng-model="value.range.to"\n		class="form-control" ng-required="ngRequired" id="{{ fieldId }}-dateTo">\n</div>'),$templateCache.put("/konga/views/raw-option-input.html","<option-input></option-input>"),$templateCache.put("/konga/views/raw-password-input.html",'<input name="{{property.name }}"type="password" class="form-control konga-form-search-input" id="{{ fieldId }}" placeholder="" ng-model="value.text" ng-disabled="disableField(mode, property)" angular.module(\'konga\') ng-required="validation.required()" maxlength="{{ validation.maxlength() }}" autocomplete="off" ng-pattern="validation.pattern()">'),$templateCache.put("/konga/views/raw-pick_list-input.html",'<div ng-init="hideGlobalValidation()">\n	<list-input fields="value.fields" actions="property.actions"\n		list="value.entity" property="property" metadata="metadata"\n		disabled-ids="[]" dispatch-field-action=\'dispatchFieldAction\'></list-input>\n</div>'),$templateCache.put("/konga/views/raw-plain-input.html",'<input name="{{property.name }}" type="text" class="form-control konga-form-search-input" id="{{ fieldId }}" placeholder="" ng-model="value.text" ng-disabled="disableField(mode, property)" ng-required="validation.required()" maxlength="{{ validation.maxlength() }}" tabindex="{{ (index + 1) * 12 }}" ng-pattern="validation.pattern()">'),$templateCache.put("/konga/views/raw-price-input.html",'<price-input></price-input>\n<div class="validation">\n	<div class="validation-pattern btn-danger">\n		{{ \'message.field-validation.pattern\' | translate }}\n	</div>\n	<div class="validation-required btn-danger">\n		{{ \'message.field-validation.required\' | translate }}\n	</div>\n</div>'),$templateCache.put("/konga/views/raw-quantity-input.html","<quantity-input></quantity-input>"),$templateCache.put("/konga/views/raw-select-input.html",'<select-input></select-input>\n<div class="col-md-12" ng-if="mode === \'search\' && property.searchConf.multiplicity === \'MANY\' ">\n	<div class="row">\n		<button class="btn btn-default btn-xs" ng-repeat="item in value.entity" ng-click="removeItem($index)">\n			<i class="glyphicon glyphicon-remove"></i>\n			{{ item | mapField:labelField | shortify:15 }}\n'+"			{{ (item | mapField:labelField).length > 15 ? '...' : '' }}\n		</button>\n	</div>\n</div>"),$templateCache.put("/konga/views/raw-switch-input.html",'<span class="raw-switch-input">\n	<i class="fa" ng-class="{ \'fa-toggle-on text-success\': !!value.text, \'fa-toggle-off text-default\': !value.text }" ng-click="value.text = !value.text"></i>\n</span>'),$templateCache.put("/konga/views/raw-table-input.html",'<div class="col-md-12 padding-cero" ng-class="inLineClass.col1" ng-init="hideGlobalValidation()">\n	<label for="{{ fieldId }}">{{property.fieldLabel |\n		translate:extra }}</label>\n</div>\n<div class="col-md-12 padding-cero" ng-class="inLineClass.col3">\n	<table-input></table-input>\n</div>'),$templateCache.put("/konga/views/raw-textarea-input.html",'<textarea \n	type="text"\n	class="form-control konga-form-search-input konga-form-simple-search-input"\n	id="{{fieldId}}"\n	placeholder=""\n	ng-model="value.text"\n	ng-disabled="disableField(mode, property)"\n	angular.module(\'konga\')\n	ng-required="validation.required()"\n	rows="{{ property.validation.maxLength / 100 }}">\n</textarea>\n	<!-- TODO This is not working (yet) -->\n	<!-- ng-minlength="property.minLength"\n	ng-maxlength="property.maxLength" -->\n\n<div class="validation">\n	<div class="validation-pattern btn-danger">\n		{{ \'message.field-validation.pattern\' | translate }}\n	</div>\n	<div class="validation-required btn-danger">\n		{{ \'message.field-validation.required\' | translate }}\n	</div>\n</div>'),$templateCache.put("/konga/views/recursive-list-item.html",'<li>\n	<div>\n		<a href="" ng-click="click(item)">{{ item.label | translate }}</a>\n		<i class="text-success" ng-class="{ \'glyphicon glyphicon-ok\': item.selected && !item.children.length }"></i>\n		<recursive-list list="item.children" on-click-item="click"></recursive-list>\n	</div>\n</li>'),$templateCache.put("/konga/views/recursive-list.html",'<ul>\n	<recursive-list-item ng-repeat="item in list" item="item" on-click="clickItem"></recursive-list-item>\n</ul>'),$templateCache.put("/konga/views/result-table.html",'<div ng-include="contentUrl" ng-init="init()"></div>'),$templateCache.put("/konga/views/search-pane.html",'<div class="search-pane" ng-init="init()">\n	<div class="search-form">\n		<h3>{{ \'message.search-filters.title\' | translate }}</h3>\n		<form role="form">\n			<div ng-include="contentUrl"></div>\n			<div class="col-md-12 form-group mode-search">\n				<div class="text-right">\n					<button id="clear-search-pane.id" type="button" class="btn btn-default" ng-click="operations.clear()">\n						<i class="glyphicon glyphicon-remove"></i>\n						{{\'message.action.clean\' | translate}}\n					</button>\n					<button id="submit-search-pane.id" type="submit" class="btn btn-success" ng-click="operations.submit()">\n						<i class="glyphicon glyphicon-ok"></i>\n						{{\'message.action.search\' | translate}}\n					</button>\n				</div>\n			</div>\n		</form>\n	</div>\n</div>'),$templateCache.put("/konga/views/select-input.html","<div class=\"select-input {{(isExtended) ? 'extend' : 'non-extended'}}\" ng-class=\"{ disabled: disableSelect(property) }\" konga-select>\n	<div class=\"input-group {{ validation.required() ? 'required' : 'optional' }} {{ value.text.length ? 'valid' : 'invalid' }}\">\n"+'		<input name="{{property.name }}" type="text" class="konga-form-search-input form-control" id="{{ fieldId }}-input" ng-model="textinput" ng-disabled="disableField(mode, property)" angular.module(\'konga\') ng-required="validation.required()" ng-change="writeValue()" typeahead="item.label for item in getElements($viewValue)" typeahead-on-select="formatInput($item, $model, $label)" tabindex="{{ (index + 1) * 12 }}">\n		<div class="input-group-addon">\n			<button type="button" class="btn btn-link" ng-disabled="disableField(mode, property)"\n				ng-click="dispatchFieldAction(\'open-select\')" id="{{ fieldId }}-select">\n				<i class="glyphicon glyphicon-search"></i>\n			</button>\n			<!-- <button type="button" class="btn btn-link btn-bordered-left" ng-show="showRemove(property)" ng-click="removeField(property)" id="{{ fieldId }}-remove">\n				<i class="glyphicon glyphicon-remove"></i>\n			</button> -->\n		</div>\n	</div>\n	<div class="col-md-6 complex-label" ng-show="mode === \'update\'">\n		<span ng-show="label.length">{{ label }}&nbsp;</span>\n	</div>\n	<div class="validation">\n		<div class="validation-pattern btn-danger">{{\n			\'message.field-validation.pattern\' | translate }}</div>\n		<div class="validation-required btn-danger">{{\n			\'message.field-validation.required\' | translate }}</div>\n	</div>\n</div>'),
$templateCache.put("/konga/views/single-select-modal.html",'<single-select source-list="sourceList" model="modal.temp"></single-select>'),$templateCache.put("/konga/views/single-select.html",'<div class="single-select" ng-init="operations.init()">\n	<div class="modal-header" ng-show="true">\n		<!-- Close button -->\n		<button id="singleselectModal.cancelX.id" type="button" class="close" ng-click="singleselectModal.cancel()">&times;</button>\n\n		<!-- Filter -->\n		<!-- TODO Externalize -->\n	<div class="filter">\n			<div class="form-inline" ng-repeat="quickSearchItem in quickSearch">\n				<div class="form-group">\n					<!-- <label for="filter" class="control-label col-md-4">5 rsultats</label> -->\n					<div class="col-md-12">\n						<div class="input-group">\n						  <span class="input-group-addon">\n						  	&nbsp;\n						  	<i class="glyphicon glyphicon-filter"></i>\n						  	&nbsp;\n						  </span>\n						  <input  id="single-select-filter.id" type="text" class="form-control" name="filter" ng-model="quickSearchItem.value" placeholder="{{quickSearchItem.metadata.label | translate:quickSearchItem.extra }}" ng-change="executeQuickSearch()" />\n						</div>\n					</div>\n				</div>\n			</div>\n		</div>\n\n		<!-- Title -->\n		<h4 class="modal-title">{{ \'message.single-select.title\' | translate }}</h4>\n	</div>\n	<div class="multiselect-list list-group" scroll-watcher>\n		<a class="list-group-item"\n			ng-repeat="item in sourceList | filter:filter.value | orderBy: key"\n			ng-click="operations.toggle(item)"\n			ng-class="{selected: (item === selected)}">\n			<h5>\n				{{ item.key }} <small>{{ item.value }}</small>\n			</h5>\n		</a>\n		<div class="loading-data" ng-if="loading">&nbsp;</div>\n		<div class="no-results" ng-show="!loading && !sourceList.length">{{ \'field.searchResults.noresults\' | translate }}</div>\n	</div>\n	<div class="modal-footer">\n		<!-- Close button -->\n		<button  type="button" class="btn btn-success" ng-click="singleselectModal.save()" id="single-select-save">\n			<i class="glyphicon glyphicon-ok"></i>\n			{{ \'message.action.validate\' | translate }}\n		</button>\n		<button  type="button" class="btn btn-default" ng-click="singleselectModal.cancel()" id="single-select-cancel">\n			<i class="glyphicon glyphicon-remove"></i>\n			{{ \'message.action.cancel\' | translate }}\n		</button>\n		\n	</div>\n</div>'),$templateCache.put("/konga/views/tabbed-update-user.html",'<vertical-tabs>\n	<tab-content title="{{\'category.informations.principales\'| translate}}">\n		<raw-input \n			property="field"\n			vertical="true"\n			source-list="productCodes[field.name]"\n			ng-repeat="field in fields | updateParams:metadata:\'category.informations.principales\' | orderBy:\'+priority.update\'" \n			entity="entity" \n			on-update="onUpdate"\n			on-change="onChange"\n			metadata="metadata"\n			mode="update"\n			creating="creating">\n		</raw-input>\n	</tab-content>\n	<tab-content title="{{\'category.habilitations\'| translate}}">\n		<div>\n			<habilitations-user/>\n		</div>\n	</tab-content>\n</vertical-tabs>'),$templateCache.put("/konga/views/tabbed-update.html",'<vertical-tabs>\n	<tab-content ng-repeat="fs in fieldsets" title="{{fs.name | translate}}" is-show="true">\n		<raw-input \n			property="field"\n			vertical="true"\n			source-list="productCodes[field.name]"\n			ng-repeat="field in fields | filter:{ fieldSet: fs.name } | updateParams:metadata | orderBy:\'+priority.update\' | allowed:\'update\'" \n			entity="entity" \n			on-update="onUpdate"\n			on-change="onChange"\n			metadata="metadata"\n			mode="update"\n			creating="creating"\n			index="$index">\n		</raw-input>\n	</tab-content>\n</vertical-tabs>'),$templateCache.put("/konga/views/table-cell.html",'<div class="table-cell" ng-class="styles">\n	<span class="table-cell-content" ng-show="type === \'text\'"></span>\n	<img ng-src="{{ content }}" ng-if="type === \'image\'" width="{{ image.width }}" height="{{ image.height }}">\n	<div class="{{ field.name }} {{ content }}" ng-if="type === \'styling\'"></div>\n	<div ng-if="type === \'plain-filtered\'">\n		{{ content | customFilter:filter }}\n	</div>\n	<div class="custom-type" ng-if="type === \'custom\'">\n		<div ng-include="custom"></div>\n	</div>\n</div>'),$templateCache.put("/konga/views/table-header.html",'<div class="table-header {{ field.sortable ? \'sortable\' : \'\' }}" ng-class="styles">\n	<span class="header-label">{{ label | translate:{label: owner} }}</span>\n	<!-- <b ng-class="showSorting(field.sorting, true)"><b ng-class="showSorting(field.sorting, false)"></b></b> -->\n	<span class="sorting" ng-if="field.sortable" ng-hide="field.derived">\n		<i class="select-sorting sorting-asc glyphicon glyphicon-chevron-up" ng-click="sorting(\'asc\')" ng-class="{ active: sort === \'asc\' }"></i>\n		<i class="select-sorting sorting-desc glyphicon glyphicon-chevron-down" ng-click="sorting(\'desc\')" ng-class="{ active: sort === \'desc\' }"></i>\n	</span>\n</div>'),$templateCache.put("/konga/views/table-input.html",'<div class="table-input col-md-12 padding-cero">\n	<div ng-if="!rows || !columns || rows.length === 0 || columns.length === 0" class="col-md-12 text-center text-danger">{{ \'message.table-input.not-yet-configured\' | translate }}</div>\n	<table ng-if="rows.length > 0 && columns.length > 0">\n		<!-- Horizontal category -->\n		<tr>\n			<!-- Separator -->\n			<th class="table-input-category-separator">&nbsp;</th>\n\n			<!-- Horizontal category -->\n			<th class="table-input-category horizontal" colspan="{{ columns.length }}">{{ configuration.xAxisProperty.label | translate }}</th>\n		</tr>\n\n		<!-- Horizontal headers -->\n		<tr>\n			<!-- Vertical category -->\n			<th class="table-input-category vertical">{{ configuration.yAxisProperty.label | translate }}</th>\n\n			<th ng-repeat="column in columns" class="table-input-header horizontal">{{ column.value }}</th>\n		</tr>\n\n		<!-- Data rows -->\n		<tr ng-repeat="row in rows">			\n			<!-- Vertical header -->\n			<th class="table-input-header vertical">{{ row.value }}</th>\n\n			<!-- Data -->\n			<td class="table-input-content" ng-repeat="column in columns">\n				<input type="number" size="2" step="any" class="text-center hideArrows" ng-repeat="step in steps | filter:getQueryObj(row, column):true" ng-model="step[valueField]" ng-class="{ invalid: step.$invalid }" ng-change="updateValue(step)" />\n			</td>\n		</tr>\n\n	</table>\n</div>'),$templateCache.put("/konga/views/vertical-tabs-element.tp.html",'<div class="tab-pane" ng-show="selected" ng-class="active" ng-transclude></div>'),$templateCache.put("/konga/views/verticaltab.tp.html",'<div class="row tabbable">\n	<ul class="nav nav-pills nav-stacked konga-nav-vertical col-xs-12 col-sm-12 col-md-4 col-lg-3">\n		<li ng-repeat="tabContent in tabContentList" ng-class="{active:tabContent.selected}">\n			<a href="" ng-click="select(tabContent)">{{tabContent.title}}</a>\n		</li>\n	</ul>\n	<div class="tab-content col-xs-12 col-sm-12 col-md-8 col-lg-9" ng-transclude></div>\n</div>\n')}]);