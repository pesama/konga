<h1><code ng:non-bindable="">EntitySearchController</code>
<div><span class="hint">controller in module <code ng:non-bindable="">konga</code>
</span>
</div>
</h1>
<div><h2 id="description">Description</h2>
<div class="description"><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p>This controller handles all search operations for konga <a href="#/api/Standards.Forms"><code>standards</code></a>. It&#39;s opened once you request a new search form via <a href="#/api/Standards.Operations#methods_openentitysearch"><code>openEntitySearch()</code></a> operation. Once it opens it starts inner <code>directives</code> and engages all functionalities.</p>
<p><img src="/static/konga-entity-search-basic-flow.png" width="40%" class="center"></p>
<p>The <code>EntitySearchController</code> relies on two main directives to render its contents: <a href="#/api/konga.directive:searchPane"><code>searchPane</code></a> for managing the search form, and <a href="#/api/konga.directive:resultTable"><code>resultTable</code></a> for rendering the results. Furthermore, it includes access to the <a href="#/api/konga.controller:EntityUpdateController"><code>EntityUpdateController</code></a> to create new entities, if the metadata for the entity allows creation to user. </p>
<h3 id="description_search-flow">Search flow</h3>
<p>Once the <code>EntitySearchController</code> engages, it passes through several flows depending on the configuration, and on the user interaction with the available actions. Here you have an excerpt of the flows <code>EntitySearchController</code> moves through:</p>
<p><img src="/static/konga-search-flow.png" width="50%" class="center"></p>
<h4 id="description_search-flow_rendering">Rendering</h4>
<p>On <strong>rendering</strong> phase, the <code>EntitySearchController</code> reads the <code>metadata</code> and determines whether the search form is an allowed feature for the entity. If that&#39;s the case, it launches the directive <code>boot</code>, and stays idle while the directives work, listening for their requests, along with user interactions through them. See how <a href="#/api/konga.directive:searchPane"><code>searchPane</code></a> and <a href="#/api/konga.directive:resultTable"><code>resultTable</code></a> boot. </p>
<h4 id="description_search-flow_input">Input</h4>
<p>This is a <a href="#/api/konga.directive:searchPane"><code>searchPane</code></a> specific behavior, when users interact with the different fields. See the docs about how the <code>searchPane</code> handles <a href="#/api/konga.directive:searchPane#methods_updatefield"><code>field updation</code></a>.</p>
<h4 id="description_search-flow_submit">Submit</h4>
<p>This process is triggered by the <a href="#/api/konga.directive:searchPane"><code>searchPane</code></a> once the user clicks on &#39;submit&#39;. In this moment the <code>EntitySearchController</code> receives a &#39;submit&#39; action through its <a href="#/api/konga.controller:EntitySearchController#methods_dispatchsearchaction"><code>dispatchSearchAction()</code></a> method, who determines the action to dispatch. As you would see on the <a href="#/api/Action-Driven.Native#properties_search"><code>native search action</code></a>, the default procedure for searching is to launch <code>EntitySearchController</code> <a href="#/api/konga.controller:EntitySearchController#methods_submit"><code>submit</code></a> method.</p>
<h4 id="description_search-flow_reset">Reset</h4>
<p>This task is executed once the user clicks on the &#39;clear&#39; button. It&#39;s handled internally by the <a href="#/api/konga.directive:searchPane"><code>searchPane</code></a> through its <a href="#/api/konga.directive:searchpane#methods_clear"><code>clear</code></a> method. With this process all fields return to their initial state, and a new request is launched to update the results on the <a href="#/api/konga.directive:resultTable"><code>resultTable</code></a>.</p>
</div></div>
<h2 id="usage">Usage</h2>
<div class="usage"><pre class="prettyprint linenums">EntitySearchController($scope, api, $routeParams, common, $rootScope, $filter, scaffold, $timeout, permissionManager, util);</pre>
<h4 id="usage_parameters">Parameters</h4><table class="variables-matrix table table-bordered table-striped"><thead><tr><th>Param</th><th>Type</th><th>Details</th></tr></thead><tbody><tr><td>$scope</td><td><a href="" class="label type-hint type-hint-object">$scope</a></td><td><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p><code>EntitySearchController</code>&#39;s <code>$scope</code>. It contains all basic attributes and features for searching, and it provides information to the underlying directives. </p>
</div></td></tr><tr><td>api</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/konga.api"><code>api</code></a></span>
Service for performing the API calls for retrieving the results. By default any entity consumes the <a href="#/api/konga.standardApi"><code>standardApi</code></a>. However, controllers rely on the <a href="#/api/konga.api"><code>api</code></a> service, as it allows you to easily define a different API handler for each entity. See the <a href="#/api/konga.api"><code>api</code></a> documentation for more details.</p>
</div></td></tr><tr><td>$routeParams</td><td><a href="" class="label type-hint type-hint-object">$routeParams</a></td><td><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p>The <code>EntitySearchController</code> uses the <code>$routeParams</code> to retrieve information about the entities. As you have seen on the <a href="#/api/Standards.Apps">Apps</a> definition, there are two default <code>$routes</code> engaged into any Konga app. That <code>$routes</code> contain information about the <code>:entityName</code> (the entity metadata&#39;s name), used to retrieve the metadata using the <a href="#/api/Standards.Tools"><code>util</code></a> stystem. </p>
</div></td></tr><tr><td>common</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/konga.common"><code>common</code></a></span>
The storage is used internally to handle data-saving operations, mainly for tab management - you go out of this tab, come back, and everything is as you left it.</p>
</div></td></tr><tr><td>$rootScope</td><td><a href="" class="label type-hint type-hint-object">$rootScope</a></td><td><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p>Injected to access global <a href="#/api/Standards.Operations"><code>operations</code></a>.</p>
</div></td></tr><tr><td>$filter</td><td><a href="" class="label type-hint type-hint-object">$filter</a></td><td><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p>Used for filtering data - e.g. <a href="#/api/konga.filter:mapField"><code>field mapping</code></a> and other Angular native filtering.</p>
</div></td></tr><tr><td>scaffold</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/konga.scaffold"><code>scaffold</code></a></span>
Used for <a href="#/api/konga.scaffold"><code>scaffolding</code></a> new queries. </p>
</div></td></tr><tr><td>$timeout</td><td><a href="" class="label type-hint type-hint-object">$timeout</a></td><td><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p>Some inner methods and operations are executed delayed.</p>
</div></td></tr><tr><td>permissionManager</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/konga.permissionManager"><code>permissionManager</code></a></span>
Used to determine user permissions on the operations susceptible to be executed on the <code>search</code> and <code>results</code> functionalities.</p>
</div></td></tr><tr><td>util</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entitysearchcontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/Standards.Tools"><code>util</code></a></span>
Used to handle metadata easier via the <a href="#/api/Standards.Tools"><code>util</code></a> provided tools. </p>
</div></td></tr></tbody></table></div>
<div class="member method"><h2 id="methods">Methods</h2>
<ul class="methods"><li><h3 id="methods_dispatchsearchaction">dispatchSearchAction(action)</h3>
<div class="dispatchsearchaction"><div class="dispatchsearchaction-page"><p>Launches a custom action triggered within the <code>EntitySearchController</code>. This action will include the following parameters and values:
<pre class="prettyprint linenums">
{
query: $scope.query,
metadata: $scope.entityMetadata,
results: $scope.resultList,
self: $scope
}
</pre>
</div><h5 id="methods_dispatchsearchaction_parameters">Parameters</h5><table class="variables-matrix table table-bordered table-striped"><thead><tr><th>Param</th><th>Type</th><th>Details</th></tr></thead><tbody><tr><td>action</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="dispatchsearchaction-page"><p><span class="label type-hint type-hint-object"><a href="#/api/Metadata.Action">Action</a></span>
Action to be dispatched. This can be an object with a <code>name</code> attribute. Konga will find such name in the <a href="#/api/konga.customActions"><code>customActions</code></a> array</p>
</div></td></tr></tbody></table></div>
</li>
<li><h3 id="methods_executequicksearch">executeQuickSearch()</h3>
<div class="executequicksearch"><div class="executequicksearch-page"><p>Submits the query, along with the values input on the <code>quick search</code> section. This method is executed autommatically once a field on the <code>quick search</code> hook changes.</p>
</div></div>
</li>
<li><h3 id="methods_hidefilter">hideFilter()</h3>
<div class="hidefilter"><div class="hidefilter-page"><p>Hides the filters, leaving the result table occupying all the layout.</p>
</div></div>
</li>
<li><h3 id="methods_hidefilter">hideFilter()</h3>
<div class="hidefilter"><div class="hidefilter-page"><p>Hides the filters, leaving the result table occupying all the layout.</p>
</div></div>
</li>
<li><h3 id="methods_resetpaginationdata">resetPaginationData(pagingOnly)</h3>
<div class="resetpaginationdata"><div class="resetpaginationdata-page"><p>Resets the pagination data to the default values. This method is used when <code>resetting</code>, to setup original paging count, and to move to first page. </p>
</div><h5 id="methods_resetpaginationdata_parameters">Parameters</h5><table class="variables-matrix table table-bordered table-striped"><thead><tr><th>Param</th><th>Type</th><th>Details</th></tr></thead><tbody><tr><td>pagingOnly</td><td><a href="" class="label type-hint type-hint-boolean">Boolean</a></td><td><div class="resetpaginationdata-page"><p>If set to true, paging count - i.e. <code>limit</code> - won&#39;t be reset to defaults. </p>
</div></td></tr></tbody></table></div>
</li>
<li><h3 id="methods_submit">submit(query, sorting)</h3>
<div class="submit"><div class="submit-page"><p>Submits the query to the API and handles data returns, and exception management.</p>
</div><h5 id="methods_submit_parameters">Parameters</h5><table class="variables-matrix table table-bordered table-striped"><thead><tr><th>Param</th><th>Type</th><th>Details</th></tr></thead><tbody><tr><td>query</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="submit-page"><p><span class="label type-hint type-hint-object"><a href="#/api/Standards.Data%20types#properties_query">Query</a></span>
Query to submit to the API</p>
</div></td></tr><tr><td>sorting</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="submit-page"><p><span class="label type-hint type-hint-object"><a href="#/api/Metadata.Field">Field</a></span>
Configures the field to sort by</p>
</div> <p><em>(default: null)</em></p></td></tr></tbody></table></div>
</li>
<li><h3 id="methods_togglefilter">toggleFilter()</h3>
<div class="togglefilter"><div class="togglefilter-page"><p>Toggles filter visibility</p>
</div></div>
</li>
</ul>
</div>
<div class="member property"><h2 id="properties">Properties</h2>
<ul class="properties"><li><h3 id="properties_entitymetadata">entityMetadata</h3>
<div class="entitymetadata"><div class="entitymetadata-page"><p>Holds the metadata of the entity being managed. It&#39;s retrieved via <a href="#/api/konga.common"><code>common</code></a> -&gt; <a href="#/api/konga.common#methods_getmetadata"><code>getMetadata</code></a> method.</p>
</div></div>
</li>
<li><h3 id="properties_fieldsshowinresults">fieldsShowInResults</h3>
<div class="fieldsshowinresults"><div class="fieldsshowinresults-page"><p>Stores all the fields needed to be shown in <code>results</code>. The <a href="#/api/konga.filter:resultParams"><code>resultParams</code></a> filter handles this feature, by selecting all fields with metadata and permissions properly set to show in results. </p>
</div></div>
</li>
<li><h3 id="properties_pageitems">pageItems</h3>
<div class="pageitems"><div class="pageitems-page"><p>Stores a subset of the elements contained in <a href="#/api/konga.controller:EntitySearchController#properties_searchresults"><code>searchResults</code></a> array. .</p>
</div></div>
</li>
<li><h3 id="properties_query">query</h3>
<div class="query"><div class="query-page"><p>Stores the current query based on the search field&#39;s input.</p>
</div></div>
</li>
<li><h3 id="properties_quicksearch">quickSearch</h3>
<div class="quicksearch"><div class="quicksearch-page"><p>Determines the fields to be rendered in the <code>quick search</code> pane. It uses the <a href="#/api/konga.filter:quickSearch"><code>quickSearch</code></a> filter to get such fields based on metadata for the entity being managed. </p>
</div></div>
</li>
<li><h3 id="properties_quicksearchenabled">quickSearchEnabled</h3>
<div class="quicksearchenabled"><div class="quicksearchenabled-page"><p>Stores whether the entity supports <code>quick searching</code>.</p>
</div></div>
</li>
<li><h3 id="properties_searchresults">searchResults</h3>
<div class="searchresults"><div class="searchresults-page"><p>Stores all the search results that come from the api once requested a <a href="#/api/konga.controller:EntitySearchController#methods_submit"><code>submit</code></a> method.</p>
</div></div>
</li>
<li><h3 id="properties_searchresults">searchResults</h3>
<div class="searchresults"><div class="searchresults-page"><p>Stores whether the entity being managed allows creation. It leverages the <a href="#/api/konga.permissionManager"><code>permissionManager</code></a> -&gt; <a href="#/api/konga.permissionManager#methods_isallowed"><code>isAllowed</code></a> method to determine permissions.</p>
</div></div>
</li>
</ul>
</div>
<div class="member event"><h2 id="events">Events</h2>
<ul class="events"><li><h3 id="events_entity-search">entity-search</h3>
<div class="entity-search"><div class="entity-search-page"><p>When this event arrives to <code>EntitySearchController</code>, it launches a new search for the entity given on the params. This is useful to update results on any custom action you develop.</p>
<p>To successfully use this feature you <strong>need to send the <code>entity name</code> on the <code>data.type</code> attribute</strong>. </p>
</div><div class="inline"></div>
<div class="inline"></div>
</div>
</li>
</ul>
</div>
</div>
