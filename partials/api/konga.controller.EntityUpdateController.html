<h1><code ng:non-bindable="">EntityUpdateController</code>
<div><span class="hint">controller in module <code ng:non-bindable="">konga</code>
</span>
</div>
</h1>
<div><h2 id="description">Description</h2>
<div class="description"><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><h3 id="description_entityupdatecontroller">EntityUpdateController</h3>
<p>Responsible for handling updating - and creating - operations with entities, for Konga <a href="#/api/Standards.Forms"><code>standards</code></a>. Same as happens with search, this controller it&#39;s normally initialised once user requests an <a href="#/api/Standards.Operations#methods_openentityupdate"><code>openEntityUpdate()</code></a> - for updating an existing entity, or <a href="#/api/Standards.Operations#methods_openentitycreate"><code>openEntityCreate()</code></a> to create a new one.</p>
<p><img src="/static/konga-entity-update-basic-flow.png" width="40%" class="center"></p>
<p>The <code>EntityUpdateController</code>&#39;s responsibility is just for operation management, whilst the graphical - rendering, validating... - responsibility lays on the <a href="#/api/konga.directive:updateForm"><code>updateForm</code></a> directive. </p>
<h3 id="description_updation/creation-flow">Updation/Creation flow</h3>
<p>Once the <code>EntityUpdateController</code> engages, it passes through several flows depending on the configuration, and on the user interaction with the available actions. Here you have an excerpt of the flows <code>EntityUpdateController</code> moves through:</p>
<p><img src="/static/konga-update-flow.png" width="50%" class="center"></p>
<h4 id="description_updation/creation-flow_rendering">Rendering</h4>
<p>On <strong>rendering</strong> phase, the <code>EntityUpdateController</code> reads the <code>metadata</code> and determines whether the user can perform the operation rquested. After that, using the input the controller asks the <a href="#/api/konga.api"><code>api</code></a> to return the existing entity (for updating) or the <a href="#/api/konga.scaffold"><code>scaffold</code></a> service to craft a new one. This, along with entity deletion - which in <code>creation</code> mode it will never be enabled - is the only feature who makes updation and creation differ. </p>
<p>Once the permissions are dealt with, the entity got, and the mode resolved, the <code>EntityUpdateController</code> leaves the rendering responsibility to the <a href="#/api/konga.directive:updateForm"><code>updateForm</code></a>, who continues the process.</p>
<h4 id="description_updation/creation-flow_input">Input</h4>
<p>Every time a field&#39;s value changes, a process is launched. This process will handle validation, data mapping - to store the field&#39;s value within the entity, and any propagation or linking defined on the <a href="#/api/Metadata.Field">field&#39;s metadata</a>. On the <a href="#/api/konga.directive:rawInput"><code>rawInput</code></a> documentation there&#39;s the full guide on how changes are tracked and the validation and mapping processes work.</p>
<h4 id="description_updation/creation-flow_submit">Submit</h4>
<p>On submit, the <a href="#/api/Customisation.Action_Driven#properties_save"><code>save</code></a> action is launched. This action basically sends the entity to your API, letting you know the result via a <code>toastr</code>. If the operation went right, the view will close, coming back to where you were before.</p>
</div></div>
<h2 id="usage">Usage</h2>
<div class="usage"><pre class="prettyprint linenums">EntityUpdateController($scope, api, $routeParams, common, $rootScope, $filter, fieldMapper, scaffold, $timeout, permissionManager, util);</pre>
<h4 id="usage_parameters">Parameters</h4><table class="variables-matrix table table-bordered table-striped"><thead><tr><th>Param</th><th>Type</th><th>Details</th></tr></thead><tbody><tr><td>$scope</td><td><a href="" class="label type-hint type-hint-object">$scope</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p><code>EntityUpdateController</code>&#39;s <code>$scope</code>. It contains all basic attributes and features for searching, and it provides information to the underlying directives. </p>
</div></td></tr><tr><td>api</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/konga.api"><code>api</code></a></span>
Service for performing the API calls for retrieving the results. By default any entity consumes the <a href="#/api/konga.standardApi"><code>standardApi</code></a>. However, controllers rely on the <a href="#/api/konga.api"><code>api</code></a> service, as it allows you to easily define a different API handler for each entity. See the <a href="#/api/konga.api"><code>api</code></a> documentation for more details.</p>
</div></td></tr><tr><td>$routeParams</td><td><a href="" class="label type-hint type-hint-object">$routeParams</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p>The <code>EntityUpdateController</code> uses the <code>$routeParams</code> to retrieve information about the entities. As you have seen on the <a href="#/api/Standards.Apps">Apps</a> definition, there are two default <code>$routes</code> engaged into any Konga app. That <code>$routes</code> contain information about the <code>:entityName</code> (the entity metadata&#39;s name), used to retrieve the metadata using the <a href="#/api/Standards.Tools"><code>util</code></a> stystem. </p>
</div></td></tr><tr><td>common</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/konga.common"><code>common</code></a></span>
The storage is used internally to handle data-saving operations, mainly for tab management - you go out of this tab, come back, and everything is as you left it.</p>
</div></td></tr><tr><td>$rootScope</td><td><a href="" class="label type-hint type-hint-object">$rootScope</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p>Injected to access global <a href="#/api/Standards.Operations"><code>operations</code></a>.</p>
</div></td></tr><tr><td>$filter</td><td><a href="" class="label type-hint type-hint-object">$filter</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p>Used for filtering data - e.g. <a href="#/api/konga.filter:mapField"><code>field mapping</code></a> and other Angular native filtering.</p>
</div></td></tr><tr><td>fieldMapper</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/konga.fieldMapper"><code>fieldMapper</code></a></span>
Used to map input&#39;s value into the entity.</p>
</div></td></tr><tr><td>scaffold</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/konga.scaffold"><code>scaffold</code></a></span>
Used for <a href="#/api/konga.scaffold"><code>scaffolding</code></a> new queries. </p>
</div></td></tr><tr><td>$timeout</td><td><a href="" class="label type-hint type-hint-object">$timeout</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p>Some inner methods and operations are executed delayed.</p>
</div></td></tr><tr><td>permissionManager</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/konga.permissionManager"><code>permissionManager</code></a></span>
Used to determine user permissions on the operations susceptible to be executed on the <code>search</code> and <code>results</code> functionalities.</p>
</div></td></tr><tr><td>util</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="konga-controller-page konga-controller-entityupdatecontroller-page"><p><span class="label type-hint type-hint-object"><a href="#/api/Standards.Tools"><code>util</code></a></span>
Used to handle metadata easier via the <a href="#/api/Standards.Tools"><code>util</code></a> provided tools. </p>
</div></td></tr></tbody></table></div>
<div class="member method"><h2 id="methods">Methods</h2>
<ul class="methods"><li><h3 id="methods_updateentityfield">updateEntityField(metadata, value, entity, parentField, parentEntity)</h3>
<div class="updateentityfield"><div class="operations-updateentityfield-page"><p>Performs updates on the entity being managed once the system detects changes on a field. While this is not needed for plain fields - as the <a href="https://docs.angularjs.org/api/ng/directive/ngModel"><code>ngModel</code></a> directive does the trick - it&#39;s a cool feature for complex fields, as - by leveraging the <a href="#/api/konga.fieldMapper"><code>fieldMapper</code></a> - the metadata is used to determine data types, and the entities modified accordingly.</p>
</div><h5 id="methods_updateentityfield_parameters">Parameters</h5><table class="variables-matrix table table-bordered table-striped"><thead><tr><th>Param</th><th>Type</th><th>Details</th></tr></thead><tbody><tr><td>metadata</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="operations-updateentityfield-page"><p><span class="label type-hint type-hint-object"><a href="#/api/Metadata.Field"><code>Field</code></a></span>
The entity being managed by the form.</p>
</div></td></tr><tr><td>value</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="operations-updateentityfield-page"><p>The <code>value</code> object managed by the <a href="#/api/konga.directive:rawInput"><code>rawInput</code></a> directive.</p>
</div></td></tr><tr><td>entity</td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="operations-updateentityfield-page"><p>Your entity. This is the place where the field&#39;s value will be set.</p>
</div></td></tr><tr><td>parentField <div><em>(optional)</em></div></td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="operations-updateentityfield-page"><p><span class="label type-hint type-hint-object"><a href="#/api/Metadata.Field"><code>Field</code></a></span>
If you are dealing with a complex field - and the change origin was on an inner field - this parameter will contain the <code>root</code> field - i.e. the <code>complex</code> one.</p>
</div></td></tr><tr><td>parentEntity <div><em>(optional)</em></div></td><td><a href="" class="label type-hint type-hint-object">Object</a></td><td><div class="operations-updateentityfield-page"><p>If you are dealing with a complex field - and the change origin was on an inner field - contains the <code>root</code> entity.</p>
</div></td></tr></tbody></table></div>
</li>
</ul>
</div>
</div>
